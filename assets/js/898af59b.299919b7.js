"use strict";(globalThis.webpackChunkrouted=globalThis.webpackChunkrouted||[]).push([[5133],{511:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>d,contentTitle:()=>l,default:()=>u,frontMatter:()=>t,metadata:()=>r,toc:()=>a});const r=JSON.parse('{"id":"browser/troubleshooting","title":"Browser troubleshooting (CI, Linux deps, ports)","description":"Headless differences, missing dependencies, driver mismatch, proxy issues","source":"@site/docs/server-testing/browser/troubleshooting.mdx","sourceDirName":"browser","slug":"/server-testing/browser/troubleshooting","permalink":"/docs/server_testing/server-testing/browser/troubleshooting","draft":false,"unlisted":false,"editUrl":"https://github.com/kingwill101/routed/tree/main/docs/docs/server-testing/browser/troubleshooting.mdx","tags":[],"version":"current","frontMatter":{"id":"troubleshooting","title":"Browser troubleshooting (CI, Linux deps, ports)","description":"Headless differences, missing dependencies, driver mismatch, proxy issues","slug":"/server-testing/browser/troubleshooting"},"sidebar":"serverTestingSidebar","previous":{"title":"Screenshots & logs","permalink":"/docs/server_testing/browser/screenshots-and-logs"}}');var i=n(4848),o=n(8453);const t={id:"troubleshooting",title:"Browser troubleshooting (CI, Linux deps, ports)",description:"Headless differences, missing dependencies, driver mismatch, proxy issues",slug:"/server-testing/browser/troubleshooting"},l="Troubleshooting",d={},a=[];function c(e){const s={code:"code",h1:"h1",header:"header",li:"li",p:"p",ul:"ul",...(0,o.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(s.header,{children:(0,i.jsx)(s.h1,{id:"troubleshooting",children:"Troubleshooting"})}),"\n",(0,i.jsx)(s.p,{children:"SessionNotCreatedException: user-data-dir already in use"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Cause: multiple Chrome instances sharing a profile."}),"\n",(0,i.jsx)(s.li,{children:"Fix: server_testing launches Chromium with a unique temporary --user-data-dir. If you pass your own --user-data-dir, it is overridden per launch to a unique temp dir to avoid lock contention."}),"\n"]}),"\n",(0,i.jsx)(s.p,{children:"ChromeDriver is running but cannot connect (wrong port)"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Cause: driver not started or not yet listening."}),"\n",(0,i.jsx)(s.li,{children:"Fix: DriverManager picks a free port, starts the driver, and the launcher connects to that port."}),"\n"]}),"\n",(0,i.jsx)(s.p,{children:"Constant re-downloads of ChromeDriver/browser bundles"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Cause: setup re-downloaded every run."}),"\n",(0,i.jsx)(s.li,{children:"Fix: ChromeDriverManager.setup now skips download when an executable already exists, unless force reinstall is requested. Browser bundles also respect force and cache directories."}),"\n"]}),"\n",(0,i.jsx)(s.p,{children:"Headless vs headed"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Headless can render fonts differently or skip GPU paths. If visual diffs fail locally, try headless: false."}),"\n"]}),"\n",(0,i.jsx)(s.p,{children:"Missing dependencies (Linux)"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Ensure X libs and fonts are installed. Common packages: libX11, libXcomposite, libXcursor, libXi, libXtst, libnss3, libcups, libXrandr, libasound2, fonts-liberation."}),"\n",(0,i.jsx)(s.li,{children:"Use flags like --no-sandbox --disable-dev-shm-usage --use-gl=swiftshader in CI if sandbox/dev-shm is constrained."}),"\n"]}),"\n",(0,i.jsx)(s.p,{children:"Driver mismatch"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"If Chrome/Firefox fails to connect, the driver may not match. Use forceReinstall or pin a compatible revision via browsers.json."}),"\n"]}),"\n",(0,i.jsx)(s.p,{children:"Proxy"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Configure BrowserConfig.proxy. Verify your proxy allows localhost when using ephemeral servers."}),"\n"]}),"\n",(0,i.jsx)(s.p,{children:"Unknown Linux distro / CI image"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"server_testing defaults to Ubuntu-style Playwright downloads for Linux."}),"\n",(0,i.jsxs)(s.li,{children:["If your distro is not detected or uses a custom /etc/os-release, set:","\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:(0,i.jsx)(s.code,{children:"SERVER_TESTING_PLATFORM=linux"})}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"SERVER_TESTING_PLATFORM_ID=ubuntu22.04-x64"})," (adjust arch/version as needed)"]}),"\n"]}),"\n"]}),"\n"]})]})}function u(e={}){const{wrapper:s}={...(0,o.R)(),...e.components};return s?(0,i.jsx)(s,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}},8453:(e,s,n)=>{n.d(s,{R:()=>t,x:()=>l});var r=n(6540);const i={},o=r.createContext(i);function t(e){const s=r.useContext(o);return r.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function l(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:t(e.components),r.createElement(o.Provider,{value:s},e.children)}}}]);