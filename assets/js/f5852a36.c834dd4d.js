"use strict";(globalThis.webpackChunkrouted=globalThis.webpackChunkrouted||[]).push([[433],{12:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>d,default:()=>h,frontMatter:()=>s,metadata:()=>t,toc:()=>a});const t=JSON.parse('{"id":"fundamentals/engine","title":"Engine Lifecycle","description":"Understand how the Engine boots providers, when to call initialize, and the trade-offs between `Engine()` and `Engine.create()`.","source":"@site/docs/routed/fundamentals/engine.mdx","sourceDirName":"fundamentals","slug":"/fundamentals/engine","permalink":"/docs/routed/fundamentals/engine","draft":false,"unlisted":false,"editUrl":"https://github.com/kingwill101/routed/tree/main/docs/docs/routed/fundamentals/engine.mdx","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"title":"Engine Lifecycle","description":"Understand how the Engine boots providers, when to call initialize, and the trade-offs between `Engine()` and `Engine.create()`.","sidebar_position":2},"sidebar":"routedSidebar","previous":{"title":"Routing","permalink":"/docs/routed/fundamentals/routing"},"next":{"title":"Middleware","permalink":"/docs/routed/fundamentals/middleware"}}');var r=i(4848),o=i(8453);const s={title:"Engine Lifecycle",description:"Understand how the Engine boots providers, when to call initialize, and the trade-offs between `Engine()` and `Engine.create()`.",sidebar_position:2},d="Engine Lifecycle",c={},a=[{value:"<code>Engine()</code> \u2013 minimal constructor",id:"engine--minimal-constructor",level:2},{value:"<code>Engine.create()</code> \u2013 convenience helper",id:"enginecreate--convenience-helper",level:2},{value:"Choosing between them",id:"choosing-between-them",level:2},{value:"Minimal routing without provider boot",id:"minimal-routing-without-provider-boot",level:2}];function l(e){const n={code:"code",em:"em",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,o.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"engine-lifecycle",children:"Engine Lifecycle"})}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"Engine"})," owns the container, service providers, middleware stacks, and HTTP\nservers. You can spin it up manually with ",(0,r.jsx)(n.code,{children:"Engine()"})," or use the async helper\n",(0,r.jsx)(n.code,{children:"Engine.create()"}),". This guide explains what each path does so you can choose the\nright trade-off for your app or tests."]}),"\n",(0,r.jsxs)(n.h2,{id:"engine--minimal-constructor",children:[(0,r.jsx)(n.code,{children:"Engine()"})," \u2013 minimal constructor"]}),"\n",(0,r.jsxs)(n.p,{children:["Calling ",(0,r.jsx)(n.code,{children:"Engine()"})," returns a fully configured instance, but nothing has been\nbooted yet. You are responsible for:"]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"Registering custom providers (optional)."}),"\n",(0,r.jsxs)(n.li,{children:["Running ",(0,r.jsx)(n.code,{children:"await engine.initialize()"})," to boot built-in providers, rebuild\nmiddleware, and emit the ",(0,r.jsx)(n.code,{children:"ConfigLoaded"})," event."]}),"\n",(0,r.jsxs)(n.li,{children:["Calling ",(0,r.jsx)(n.code,{children:"await engine.close()"})," when you\u2019re done."]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-dart",metastring:'title="Manual lifecycle"',children:"final engine = Engine(\n  configItems: {'app': {'name': 'Manual Demo'}},\n);\n\nengine.registerProvider(MyFeatureProvider());\nawait engine.initialize();\n\n// ... register routes, handle requests, run tests ...\n\nawait engine.close();\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"When to prefer it"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Tests that want to register fake providers before boot."}),"\n",(0,r.jsx)(n.li,{children:"CLIs or scripts that need to tweak the container before any provider runs."}),"\n",(0,r.jsx)(n.li,{children:"Microbenchmarks where you want to skip config I/O until the last possible\nmoment."}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["There is almost zero overhead until you call ",(0,r.jsx)(n.code,{children:"initialize()"}),", so ",(0,r.jsx)(n.code,{children:"Engine()"})," is\nthe lightest entry point."]}),"\n",(0,r.jsxs)(n.h2,{id:"enginecreate--convenience-helper",children:[(0,r.jsx)(n.code,{children:"Engine.create()"})," \u2013 convenience helper"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"Engine.create()"})," wraps the pattern above: it constructs the engine (using the\nexact same constructor), applies options, boots providers by calling\n",(0,r.jsx)(n.code,{children:"initialize()"}),", rebuilds middleware, and returns the ready-to-serve instance."]}),"\n",(0,r.jsx)(n.p,{children:"In other words:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-dart",children:"final engine = Engine(/* params */);\nawait engine.initialize();\n"})}),"\n",(0,r.jsx)(n.p,{children:"is equivalent to:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-dart",children:"final engine = await Engine.create(/* params */);\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"create"})," just saves you from writing the boilerplate when you do want the full\nprovider boot sequence."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-dart",metastring:'title="Convenience helper"',children:"final engine = await Engine.create(\n  configOptions: ConfigLoaderOptions(\n    configDirectory: 'config',\n    watch: true,\n  ),\n  options: [\n    withTrustedProxies(['127.0.0.1']),\n  ],\n);\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"What it does in addition to the constructor"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Loads configuration via ",(0,r.jsx)(n.code,{children:"ConfigLoaderOptions"})," (including ",(0,r.jsx)(n.code,{children:".env"})," templating)."]}),"\n",(0,r.jsx)(n.li,{children:"Registers/boots all manifest providers immediately."}),"\n",(0,r.jsxs)(n.li,{children:["Starts config watchers when ",(0,r.jsx)(n.code,{children:"watch: true"})," (default for CLI/dev flows)."]}),"\n",(0,r.jsxs)(n.li,{children:["Publishes the ",(0,r.jsx)(n.code,{children:"ConfigLoaded"})," event right away."]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"When to prefer it"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"HTTP entrypoints that just need a ready-to-serve engine."}),"\n",(0,r.jsxs)(n.li,{children:["CLI commands (",(0,r.jsx)(n.code,{children:"routes"}),", ",(0,r.jsx)(n.code,{children:"dev"}),", etc.) that want consistent config loading."]}),"\n",(0,r.jsx)(n.li,{children:"Apps that rely on config watching without wiring it manually."}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["The trade-off is startup work: ",(0,r.jsx)(n.code,{children:"Engine.create()"})," performs disk I/O (reading\nconfig + ",(0,r.jsx)(n.code,{children:".env"}),"), provider registration, and optional filesystem watching before\nit returns."]}),"\n",(0,r.jsx)(n.h2,{id:"choosing-between-them",children:"Choosing between them"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Scenario"}),(0,r.jsx)(n.th,{children:"Recommended API"}),(0,r.jsx)(n.th,{children:"Notes"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Integration / production boot"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"Engine.create()"})}),(0,r.jsx)(n.td,{children:"Less boilerplate, config + providers boot automatically."})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Unit tests or scripts"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"Engine()"})}),(0,r.jsxs)(n.td,{children:["You control when providers boot, and can swap bindings before ",(0,r.jsx)(n.code,{children:"initialize()"}),"."]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Custom registry seeding before built-ins"}),(0,r.jsxs)(n.td,{children:[(0,r.jsx)(n.code,{children:"Engine(options: [...])"})," or ",(0,r.jsx)(n.code,{children:"Engine.create(options: [...])"})]}),(0,r.jsx)(n.td,{children:"Engine options run immediately after construction (before providers boot)."})]})]})]}),"\n",(0,r.jsxs)(n.p,{children:["Remember: both approaches end up with the same engine once ",(0,r.jsx)(n.code,{children:"initialize()"})," runs.\nPick the constructor that matches your lifecycle needs and adjust\n",(0,r.jsx)(n.code,{children:"ConfigLoaderOptions"})," (watching, directories, defaults) to control the associated\noverhead."]}),"\n",(0,r.jsx)(n.h2,{id:"minimal-routing-without-provider-boot",children:"Minimal routing without provider boot"}),"\n",(0,r.jsxs)(n.p,{children:["If you only need raw routing (for example, a tiny service without caching,\nviews, sessions, etc.) you can skip ",(0,r.jsx)(n.code,{children:"initialize()"})," and even opt out of the\ndefault providers entirely:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-dart",children:"final engine = Engine(includeDefaultProviders: false);\nengine.get('/ping', (ctx) => ctx.text('pong'));\n\nawait engine.serve(address: '127.0.0.1', port: 8080);\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Built-in providers that you ",(0,r.jsx)(n.em,{children:"do"})," register typically defer connection/setup work\nuntil their bindings are resolved, so the base engine stays cheap. Reach for\n",(0,r.jsx)(n.code,{children:"initialize()"})," only when you need the middleware registry, config watchers, or\nprovider boot hooks. For tiny scripts or benchmarks, staying on the bare engine\nkeeps startup overhead close to zero."]}),"\n",(0,r.jsxs)(n.p,{children:["You can also provide configuration manually through the ",(0,r.jsx)(n.code,{children:"configItems"})," argument\nwhen constructing the engine. Most built-in providers simply merge defaults into\nthe engine config, so if you already know the values you need (",(0,r.jsx)(n.code,{children:"app.locale"}),",\n",(0,r.jsx)(n.code,{children:"http.middleware"}),", etc.), pass them directly and skip the provider entirely:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-dart",children:"final engine = Engine(\n  includeDefaultProviders: false,\n  configItems: {\n    'app': {'locale': 'en'},\n    'http': {'middleware': []},\n  },\n);\n"})}),"\n",(0,r.jsx)(n.p,{children:"This pattern is handy for tests where you need predictable config without\nbooting the real providers."})]})}function h(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(l,{...e})}):l(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>s,x:()=>d});var t=i(6540);const r={},o=t.createContext(r);function s(e){const n=t.useContext(o);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:s(e.components),t.createElement(o.Provider,{value:n},e.children)}}}]);