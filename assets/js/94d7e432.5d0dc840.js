"use strict";(globalThis.webpackChunkrouted=globalThis.webpackChunkrouted||[]).push([[3707],{2332:(e,n,l)=>{l.r(n),l.d(n,{assets:()=>t,contentTitle:()=>c,default:()=>h,frontMatter:()=>d,metadata:()=>i,toc:()=>o});const i=JSON.parse('{"id":"docker","title":"Docker Deployment Guide for Routed","description":"This guide explains how to containerize and deploy your Routed backend application.","source":"@site/docs/routed/docker.md","sourceDirName":".","slug":"/docker","permalink":"/docs/routed/docker","draft":false,"unlisted":false,"editUrl":"https://github.com/kingwill101/routed/tree/main/docs/docs/routed/docker.md","tags":[],"version":"current","frontMatter":{},"sidebar":"routedSidebar","previous":{"title":"Uploads","permalink":"/docs/routed/uploads"}}');var r=l(4848),s=l(8453);const d={},c="Docker Deployment Guide for Routed",t={},o=[{value:"Quick Start",id:"quick-start",level:2},{value:"Files Overview",id:"files-overview",level:2},{value:"Dockerfile Stages",id:"dockerfile-stages",level:2},{value:"Stage 1: Dependencies",id:"stage-1-dependencies",level:3},{value:"Stage 2: Build",id:"stage-2-build",level:3},{value:"Stage 3: Runtime",id:"stage-3-runtime",level:3},{value:"Configuration",id:"configuration",level:2},{value:"Build Arguments",id:"build-arguments",level:3},{value:"Environment Variables",id:"environment-variables",level:3},{value:"Runtime Configuration",id:"runtime-configuration",level:3},{value:"Health Checks",id:"health-checks",level:2},{value:"Production Best Practices",id:"production-best-practices",level:2},{value:"1. Security",id:"1-security",level:3},{value:"2. Performance",id:"2-performance",level:3},{value:"3. Persistence",id:"3-persistence",level:3},{value:"4. Secrets",id:"4-secrets",level:3},{value:"Development Workflow",id:"development-workflow",level:2},{value:"Local Development (without Docker)",id:"local-development-without-docker",level:3},{value:"Development with Docker",id:"development-with-docker",level:3},{value:"Adding Services",id:"adding-services",level:2},{value:"PostgreSQL Database",id:"postgresql-database",level:3},{value:"Redis Cache",id:"redis-cache",level:3},{value:"Deployment Examples",id:"deployment-examples",level:2},{value:"Docker Swarm",id:"docker-swarm",level:3},{value:"Kubernetes",id:"kubernetes",level:3},{value:"Cloud Platforms",id:"cloud-platforms",level:3},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Container won&#39;t start",id:"container-wont-start",level:3},{value:"Health check failing",id:"health-check-failing",level:3},{value:"Build fails",id:"build-fails",level:3},{value:"Image too large",id:"image-too-large",level:3}];function a(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"docker-deployment-guide-for-routed",children:"Docker Deployment Guide for Routed"})}),"\n",(0,r.jsx)(n.p,{children:"This guide explains how to containerize and deploy your Routed backend application."}),"\n",(0,r.jsx)(n.h2,{id:"quick-start",children:"Quick Start"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Build the image\ndocker build -t my-routed-app .\n\n# Run the container\ndocker run -p 8080:8080 my-routed-app\n\n# Or use docker-compose\ndocker compose up -d\n"})}),"\n",(0,r.jsx)(n.h2,{id:"files-overview",children:"Files Overview"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"File"}),(0,r.jsx)(n.th,{children:"Purpose"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"Dockerfile"})}),(0,r.jsx)(n.td,{children:"Multi-stage production build"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:".dockerignore"})}),(0,r.jsx)(n.td,{children:"Excludes unnecessary files from build"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"docker-compose.yml"})}),(0,r.jsx)(n.td,{children:"Orchestration for local dev/prod"})]})]})]}),"\n",(0,r.jsx)(n.h2,{id:"dockerfile-stages",children:"Dockerfile Stages"}),"\n",(0,r.jsx)(n.h3,{id:"stage-1-dependencies",children:"Stage 1: Dependencies"}),"\n",(0,r.jsxs)(n.p,{children:["Caches ",(0,r.jsx)(n.code,{children:"pubspec.yaml"})," and ",(0,r.jsx)(n.code,{children:"pubspec.lock"})," to speed up rebuilds when only source code changes."]}),"\n",(0,r.jsx)(n.h3,{id:"stage-2-build",children:"Stage 2: Build"}),"\n",(0,r.jsx)(n.p,{children:"Compiles the Dart application to a native AOT executable for optimal performance:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Faster cold starts (~50ms vs ~500ms for JIT)"}),"\n",(0,r.jsx)(n.li,{children:"Lower memory footprint"}),"\n",(0,r.jsx)(n.li,{children:"No runtime dependency on Dart SDK"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"stage-3-runtime",children:"Stage 3: Runtime"}),"\n",(0,r.jsx)(n.p,{children:"Minimal Debian image with only essential runtime dependencies:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"ca-certificates"})," - HTTPS support"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"tzdata"})," - Timezone support"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"curl"})," - Health checks"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"configuration",children:"Configuration"}),"\n",(0,r.jsx)(n.h3,{id:"build-arguments",children:"Build Arguments"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"docker build \\\n  --build-arg DART_VERSION=3.9 \\\n  --build-arg APP_NAME=server \\\n  -t my-app .\n"})}),"\n",(0,r.jsx)(n.h3,{id:"environment-variables",children:"Environment Variables"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Variable"}),(0,r.jsx)(n.th,{children:"Default"}),(0,r.jsx)(n.th,{children:"Description"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"APP_ENV"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"production"})}),(0,r.jsx)(n.td,{children:"Application environment"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"APP_DEBUG"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"false"})}),(0,r.jsx)(n.td,{children:"Enable debug mode"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"HOST"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"0.0.0.0"})}),(0,r.jsx)(n.td,{children:"Server bind address"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"PORT"})}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"8080"})}),(0,r.jsx)(n.td,{children:"Server port"})]})]})]}),"\n",(0,r.jsx)(n.h3,{id:"runtime-configuration",children:"Runtime Configuration"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"docker run -p 8080:8080 \\\n  -e APP_ENV=staging \\\n  -e APP_DEBUG=true \\\n  my-routed-app\n"})}),"\n",(0,r.jsx)(n.h2,{id:"health-checks",children:"Health Checks"}),"\n",(0,r.jsx)(n.p,{children:"The container includes a built-in health check:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-dockerfile",children:"HEALTHCHECK --interval=30s --timeout=10s --start-period=5s --retries=3 \\\n    CMD curl -f http://localhost:8080/health || exit 1\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Ensure your app exposes a ",(0,r.jsx)(n.code,{children:"/health"})," endpoint:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-dart",children:"engine.get('/health', (ctx) async {\n  return ctx.json({\n    'status': 'healthy',\n    'timestamp': DateTime.now().toIso8601String(),\n  });\n});\n"})}),"\n",(0,r.jsx)(n.h2,{id:"production-best-practices",children:"Production Best Practices"}),"\n",(0,r.jsx)(n.h3,{id:"1-security",children:"1. Security"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Runs as non-root user (",(0,r.jsx)(n.code,{children:"appuser"}),")"]}),"\n",(0,r.jsx)(n.li,{children:"Minimal base image reduces attack surface"}),"\n",(0,r.jsx)(n.li,{children:"No unnecessary tools installed"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"2-performance",children:"2. Performance"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"AOT compilation for fast startup"}),"\n",(0,r.jsx)(n.li,{children:"Multi-stage build keeps final image small (~50MB)"}),"\n",(0,r.jsx)(n.li,{children:"Layer caching for faster rebuilds"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"3-persistence",children:"3. Persistence"}),"\n",(0,r.jsx)(n.p,{children:"Mount volumes for data that needs to persist:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"volumes:\n  - app-storage:/app/storage\n"})}),"\n",(0,r.jsx)(n.h3,{id:"4-secrets",children:"4. Secrets"}),"\n",(0,r.jsx)(n.p,{children:"Use environment variables or Docker secrets:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"environment:\n  - DB_PASSWORD=${DB_PASSWORD}\n"})}),"\n",(0,r.jsx)(n.p,{children:"Or with Docker secrets:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"secrets:\n  - db_password\n"})}),"\n",(0,r.jsx)(n.h2,{id:"development-workflow",children:"Development Workflow"}),"\n",(0,r.jsx)(n.h3,{id:"local-development-without-docker",children:"Local Development (without Docker)"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"dart run routed dev\n"})}),"\n",(0,r.jsx)(n.h3,{id:"development-with-docker",children:"Development with Docker"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Build and run with live logs\ndocker compose up --build\n\n# Run in background\ndocker compose up -d\n\n# View logs\ndocker compose logs -f app\n\n# Stop\ndocker compose down\n"})}),"\n",(0,r.jsx)(n.h2,{id:"adding-services",children:"Adding Services"}),"\n",(0,r.jsx)(n.h3,{id:"postgresql-database",children:"PostgreSQL Database"}),"\n",(0,r.jsxs)(n.p,{children:["Uncomment in ",(0,r.jsx)(n.code,{children:"docker-compose.yml"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"services:\n  db:\n    image: postgres:16-alpine\n    environment:\n      POSTGRES_DB: ${DB_DATABASE:-app}\n      POSTGRES_USER: ${DB_USERNAME:-postgres}\n      POSTGRES_PASSWORD: ${DB_PASSWORD:-secret}\n    volumes:\n      - postgres-data:/var/lib/postgresql/data\n"})}),"\n",(0,r.jsx)(n.h3,{id:"redis-cache",children:"Redis Cache"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"services:\n  redis:\n    image: redis:7-alpine\n    command: redis-server --appendonly yes\n    volumes:\n      - redis-data:/data\n"})}),"\n",(0,r.jsx)(n.h2,{id:"deployment-examples",children:"Deployment Examples"}),"\n",(0,r.jsx)(n.h3,{id:"docker-swarm",children:"Docker Swarm"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"docker stack deploy -c docker-compose.yml my-app\n"})}),"\n",(0,r.jsx)(n.h3,{id:"kubernetes",children:"Kubernetes"}),"\n",(0,r.jsx)(n.p,{children:"Convert to K8s manifests:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"kompose convert -f docker-compose.yml\n"})}),"\n",(0,r.jsx)(n.h3,{id:"cloud-platforms",children:"Cloud Platforms"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Google Cloud Run:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"gcloud run deploy my-app \\\n  --image gcr.io/PROJECT/my-app \\\n  --port 8080\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"AWS ECS/Fargate:"}),"\nUse the Dockerfile with your ECS task definition."]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Fly.io:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"fly launch\nfly deploy\n"})}),"\n",(0,r.jsx)(n.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,r.jsx)(n.h3,{id:"container-wont-start",children:"Container won't start"}),"\n",(0,r.jsxs)(n.p,{children:["Check logs: ",(0,r.jsx)(n.code,{children:"docker logs <container_id>"})]}),"\n",(0,r.jsx)(n.h3,{id:"health-check-failing",children:"Health check failing"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["Ensure ",(0,r.jsx)(n.code,{children:"/health"})," endpoint exists"]}),"\n",(0,r.jsxs)(n.li,{children:["Check if app binds to ",(0,r.jsx)(n.code,{children:"0.0.0.0"})," (not ",(0,r.jsx)(n.code,{children:"127.0.0.1"}),")"]}),"\n",(0,r.jsx)(n.li,{children:"Verify PORT environment variable"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"build-fails",children:"Build fails"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"Check Dart version compatibility"}),"\n",(0,r.jsxs)(n.li,{children:["Ensure all dependencies resolve: ",(0,r.jsx)(n.code,{children:"dart pub get"})]}),"\n",(0,r.jsxs)(n.li,{children:["Verify ",(0,r.jsx)(n.code,{children:"bin/server.dart"})," exists"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"image-too-large",children:"Image too large"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["Ensure ",(0,r.jsx)(n.code,{children:".dockerignore"})," is present"]}),"\n",(0,r.jsx)(n.li,{children:"Check for large files in build context"}),"\n",(0,r.jsxs)(n.li,{children:["Use ",(0,r.jsx)(n.code,{children:"docker image history"})," to find large layers"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(a,{...e})}):a(e)}},8453:(e,n,l)=>{l.d(n,{R:()=>d,x:()=>c});var i=l(6540);const r={},s=i.createContext(r);function d(e){const n=i.useContext(s);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:d(e.components),i.createElement(s.Provider,{value:n},e.children)}}}]);