"use strict";(globalThis.webpackChunkrouted=globalThis.webpackChunkrouted||[]).push([[4162],{2038:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>i,default:()=>d,frontMatter:()=>a,metadata:()=>r,toc:()=>l});const r=JSON.parse('{"id":"examples/custom-money-generator","title":"Custom Money Generator","description":"Sometimes you need domain-specific values with tailored shrinking. This example demonstrates how to write a MoneyGenerator that favours round amounts and shrinks toward $0.00.","source":"@site/docs/property-testing/examples/custom-money-generator.mdx","sourceDirName":"examples","slug":"/examples/custom-money-generator","permalink":"/docs/property_testing/examples/custom-money-generator","draft":false,"unlisted":false,"editUrl":"https://github.com/kingwill101/routed/tree/main/docs/docs/property-testing/examples/custom-money-generator.mdx","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"title":"Custom Money Generator","sidebar_position":2},"sidebar":"propertyTestingSidebar","previous":{"title":"List Sorting Invariants","permalink":"/docs/property_testing/examples/list-sorting-invariants"},"next":{"title":"Stateful Counter Invariant","permalink":"/docs/property_testing/examples/stateful-counter-invariant"}}');var o=t(4848),s=t(8453);const a={title:"Custom Money Generator",sidebar_position:2},i=void 0,c={},l=[];function u(e){const n={code:"code",p:"p",pre:"pre",...(0,s.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(n.p,{children:["Sometimes you need domain-specific values with tailored shrinking. This example demonstrates how to write a ",(0,o.jsx)(n.code,{children:"MoneyGenerator"})," that favours round amounts and shrinks toward ",(0,o.jsx)(n.code,{children:"$0.00"}),"."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-dart",children:"import 'dart:math';\n\nimport 'package:property_testing/property_testing.dart';\nimport 'package:test/test.dart';\n\nclass Money {\n  final String currency;\n  final int cents;\n\n  const Money(this.currency, this.cents);\n\n  @override\n  String toString() => '$currency ${(cents / 100).toStringAsFixed(2)}';\n}\n\nclass MoneyGenerator extends Generator<Money> {\n  final List<String> currencies;\n\n  MoneyGenerator({this.currencies = const ['USD', 'EUR', 'GBP']});\n\n  @override\n  ShrinkableValue<Money> generate(Random random) {\n    final currency = currencies[random.nextInt(currencies.length)];\n    final cents = random.nextInt(20_000); // up to 200.00 in smallest unit\n    final money = Money(currency, cents);\n\n    return ShrinkableValue(money, () sync* {\n      // Prefer whole dollars first.\n      if (money.cents % 100 != 0) {\n        yield ShrinkableValue.leaf(Money(currency, money.cents - money.cents % 100));\n      }\n\n      // Halve towards zero for finer shrinking.\n      var current = money.cents;\n      while (current > 0) {\n        current ~/= 2;\n        yield ShrinkableValue.leaf(Money(currency, current));\n      }\n\n      yield ShrinkableValue.leaf(Money(currency, 0));\n    });\n  }\n}\n\nMoney applyDiscount(Money money) {\n  final discountedCents = max(0, money.cents - 1500); // clamp at zero\n  return Money(money.currency, discountedCents);\n}\n\nvoid main() {\n  test('discount never produces negative money', () async {\n    final moneyGen = MoneyGenerator();\n\n    final runner = PropertyTestRunner(\n      moneyGen,\n      (money) {\n        final discounted = applyDiscount(money);\n        expect(discounted.cents, greaterThanOrEqualTo(0),\n            reason: 'Negative result for $money');\n        expect(discounted.cents, lessThanOrEqualTo(money.cents),\n            reason: 'Discount increased value for $money');\n      },\n      PropertyConfig(numTests: 200),\n    );\n\n    final result = await runner.run();\n    expect(result.success, isTrue, reason: result.report);\n  });\n}\n"})}),"\n",(0,o.jsx)(n.p,{children:"The custom shrinker first drops cents to the nearest dollar and then halves the value repeatedly, so failing cases quickly converge on the smallest problematic amount."})]})}function d(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(u,{...e})}):u(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>a,x:()=>i});var r=t(6540);const o={},s=r.createContext(o);function a(e){const n=r.useContext(s);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:a(e.components),r.createElement(s.Provider,{value:n},e.children)}}}]);