"use strict";(globalThis.webpackChunkrouted=globalThis.webpackChunkrouted||[]).push([[7724],{748:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>u,frontMatter:()=>d,metadata:()=>i,toc:()=>a});const i=JSON.parse('{"id":"security/auth-providers","title":"Auth Providers & Adapters","description":"Configure built-in providers and build custom auth integrations","source":"@site/docs/routed/security/auth-providers.mdx","sourceDirName":"security","slug":"/security/auth-providers","permalink":"/docs/routed/security/auth-providers","draft":false,"unlisted":false,"editUrl":"https://github.com/kingwill101/routed/tree/main/docs/docs/routed/security/auth-providers.mdx","tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"title":"Auth Providers & Adapters","description":"Configure built-in providers and build custom auth integrations","authors":"routed","sidebar_position":4},"sidebar":"routedSidebar","previous":{"title":"Securing file uploads","permalink":"/docs/routed/security/upload-hardening"},"next":{"title":"Testing Routed Apps","permalink":"/docs/routed/testing/overview"}}');var t=r(4848),s=r(8453);const d={title:"Auth Providers & Adapters",description:"Configure built-in providers and build custom auth integrations",authors:"routed",sidebar_position:4},o="Auth Providers & Adapters",l={},a=[{value:"Built-in Providers (routed_auth)",id:"built-in-providers-routed_auth",level:2},{value:"Installation",id:"installation",level:3},{value:"Available Providers",id:"available-providers",level:3},{value:"Quick Start",id:"quick-start",level:3},{value:"Typed Profiles",id:"typed-profiles",level:3},{value:"Config-Driven Registration",id:"config-driven-registration",level:3},{value:"Custom userInfoRequest",id:"custom-userinforequest",level:2},{value:"CallbackProvider for Non-OAuth Flows",id:"callbackprovider-for-non-oauth-flows",level:2},{value:"Registering Custom Providers",id:"registering-custom-providers",level:2},{value:"Building Custom Adapters",id:"building-custom-adapters",level:2},{value:"Adapter Tips",id:"adapter-tips",level:2}];function c(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"auth-providers--adapters",children:"Auth Providers & Adapters"})}),"\n",(0,t.jsxs)(n.p,{children:["This page documents how auth providers are configured, registered, and wired into the\n",(0,t.jsx)(n.code,{children:"AuthManager"}),", plus how to implement a custom ",(0,t.jsx)(n.code,{children:"AuthAdapter"})," for persistence."]}),"\n",(0,t.jsx)(n.h2,{id:"built-in-providers-routed_auth",children:"Built-in Providers (routed_auth)"}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.code,{children:"routed_auth"})," package provides pre-built OAuth providers following the NextAuth.js pattern."]}),"\n",(0,t.jsx)(n.h3,{id:"installation",children:"Installation"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",metastring:'title="pubspec.yaml"',children:"dependencies:\n  routed:\n    git:\n      url: https://github.com/kingwill101/routed.git\n      path: packages/routed\n  routed_auth:\n    git:\n      url: https://github.com/kingwill101/routed.git\n      path: packages/routed_auth\n"})}),"\n",(0,t.jsx)(n.h3,{id:"available-providers",children:"Available Providers"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Category"}),(0,t.jsx)(n.th,{children:"Provider"}),(0,t.jsx)(n.th,{children:"Factory"}),(0,t.jsx)(n.th,{children:"Options Class"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"Social"})}),(0,t.jsx)(n.td,{children:"Google"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"googleProvider()"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"GoogleProviderOptions"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{}),(0,t.jsx)(n.td,{children:"Discord"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"discordProvider()"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"DiscordProviderOptions"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{}),(0,t.jsx)(n.td,{children:"Twitter/X"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"twitterProvider()"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"TwitterProviderOptions"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{}),(0,t.jsx)(n.td,{children:"Facebook"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"facebookProvider()"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"FacebookProviderOptions"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"Enterprise"})}),(0,t.jsx)(n.td,{children:"Microsoft Entra"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"microsoftEntraProvider()"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"MicrosoftEntraProviderOptions"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{}),(0,t.jsx)(n.td,{children:"Apple"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"appleProvider()"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"AppleProviderOptions"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"Developer"})}),(0,t.jsx)(n.td,{children:"GitLab"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"gitlabProvider()"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"GitLabProviderOptions"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{}),(0,t.jsx)(n.td,{children:"Dropbox"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"dropboxProvider()"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"DropboxProviderOptions"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"Business"})}),(0,t.jsx)(n.td,{children:"Slack"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"slackProvider()"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"SlackProviderOptions"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{}),(0,t.jsx)(n.td,{children:"LinkedIn"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"linkedInProvider()"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"LinkedInProviderOptions"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"Entertainment"})}),(0,t.jsx)(n.td,{children:"Spotify"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"spotifyProvider()"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"SpotifyProviderOptions"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{}),(0,t.jsx)(n.td,{children:"Twitch"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"twitchProvider()"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"TwitchProviderOptions"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"Messaging"})}),(0,t.jsx)(n.td,{children:"Telegram"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"telegramProvider()"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"TelegramProviderOptions"})})]})]})]}),"\n",(0,t.jsx)(n.h3,{id:"quick-start",children:"Quick Start"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-dart",children:"import 'package:routed/routed.dart';\nimport 'package:routed_auth/routed_auth.dart';\n\nfinal engine = await Engine.create(\n  providers: [\n    ...Engine.builtins,\n    AuthServiceProvider(\n      AuthOptions(\n        providers: [\n          googleProvider(GoogleProviderOptions(\n            clientId: env('GOOGLE_CLIENT_ID'),\n            clientSecret: env('GOOGLE_CLIENT_SECRET'),\n            redirectUri: 'https://example.com/auth/callback/google',\n          )),\n          discordProvider(DiscordProviderOptions(\n            clientId: env('DISCORD_CLIENT_ID'),\n            clientSecret: env('DISCORD_CLIENT_SECRET'),\n            redirectUri: 'https://example.com/auth/callback/discord',\n          )),\n        ],\n      ),\n    ),\n  ],\n);\n"})}),"\n",(0,t.jsx)(n.h3,{id:"typed-profiles",children:"Typed Profiles"}),"\n",(0,t.jsx)(n.p,{children:"Each provider includes a typed profile class with full field coverage:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-dart",children:"final provider = googleProvider(options);\n\n// Access typed fields from the profile\nfinal profile = GoogleProfile.fromJson(rawData);\nprint(profile.email);\nprint(profile.name);\nprint(profile.picture);\nprint(profile.emailVerified);\n"})}),"\n",(0,t.jsx)(n.h3,{id:"config-driven-registration",children:"Config-Driven Registration"}),"\n",(0,t.jsx)(n.p,{children:"For config-driven setups, register providers with the registry:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-dart",children:"import 'package:routed_auth/routed_auth.dart';\n\n// Register all providers at once\nregisterAllAuthProviders(AuthProviderRegistry.instance);\n\n// Or register individual providers\nregisterGoogleAuthProvider(AuthProviderRegistry.instance);\nregisterDiscordAuthProvider(AuthProviderRegistry.instance);\n"})}),"\n",(0,t.jsx)(n.p,{children:"Then configure via YAML:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",metastring:'title="config/auth.yaml"',children:"providers:\n  google:\n    enabled: true\n    client_id: \"{{ env.GOOGLE_CLIENT_ID | default: '' }}\"\n    client_secret: \"{{ env.GOOGLE_CLIENT_SECRET | default: '' }}\"\n    redirect_uri: \"{{ env.GOOGLE_REDIRECT_URI | default: '' }}\"\n  discord:\n    enabled: true\n    client_id: \"{{ env.DISCORD_CLIENT_ID | default: '' }}\"\n    client_secret: \"{{ env.DISCORD_CLIENT_SECRET | default: '' }}\"\n    redirect_uri: \"{{ env.DISCORD_REDIRECT_URI | default: '' }}\"\n"})}),"\n",(0,t.jsx)(n.h2,{id:"custom-userinforequest",children:"Custom userInfoRequest"}),"\n",(0,t.jsxs)(n.p,{children:["Some OAuth providers require non-standard userinfo requests (e.g., POST instead of GET).\nUse the ",(0,t.jsx)(n.code,{children:"userInfoRequest"})," callback:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-dart",children:"OAuthProvider<MyProfile>(\n  id: 'custom',\n  name: 'Custom Provider',\n  clientId: clientId,\n  clientSecret: clientSecret,\n  authorizationEndpoint: Uri.parse('https://api.example.com/oauth/authorize'),\n  tokenEndpoint: Uri.parse('https://api.example.com/oauth/token'),\n  userInfoEndpoint: Uri.parse('https://api.example.com/userinfo'),\n  redirectUri: redirectUri,\n  // Custom userinfo request for POST-based endpoints\n  userInfoRequest: (token, httpClient, endpoint) async {\n    final response = await httpClient.post(\n      endpoint,\n      headers: {\n        'Authorization': 'Bearer ${token.accessToken}',\n        'Content-Type': 'application/json',\n      },\n      body: '{}',\n    );\n    return json.decode(response.body) as Map<String, dynamic>;\n  },\n  profile: (data) => AuthUser(\n    id: data['id'].toString(),\n    email: data['email']?.toString(),\n  ),\n);\n"})}),"\n",(0,t.jsxs)(n.p,{children:["The Dropbox provider in ",(0,t.jsx)(n.code,{children:"routed_auth"})," demonstrates this pattern."]}),"\n",(0,t.jsx)(n.h2,{id:"callbackprovider-for-non-oauth-flows",children:"CallbackProvider for Non-OAuth Flows"}),"\n",(0,t.jsxs)(n.p,{children:["For providers that don't follow standard OAuth (like Telegram's widget-based login),\nuse the ",(0,t.jsx)(n.code,{children:"CallbackProvider"})," mixin:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-dart",children:"class TelegramProvider extends AuthProvider with CallbackProvider {\n  TelegramProvider({\n    required this.botToken,\n    required this.redirectUri,\n  }) : super(id: 'telegram', name: 'Telegram', type: AuthProviderType.oauth);\n\n  final String botToken;\n  final String redirectUri;\n\n  @override\n  Future<CallbackResult> handleCallback(\n    EngineContext ctx,\n    Map<String, String> params,\n  ) async {\n    // Verify HMAC signature from Telegram\n    if (!_verifyTelegramHash(params, botToken)) {\n      return CallbackResult.failure('invalid_signature');\n    }\n\n    final user = AuthUser(\n      id: params['id']!,\n      name: '${params['first_name']} ${params['last_name'] ?? ''}'.trim(),\n      image: params['photo_url'],\n    );\n\n    return CallbackResult.success(user, redirect: '/dashboard');\n  }\n}\n"})}),"\n",(0,t.jsx)(n.h2,{id:"registering-custom-providers",children:"Registering Custom Providers"}),"\n",(0,t.jsxs)(n.p,{children:["Custom providers register a schema plus a builder that turns config into an\n",(0,t.jsx)(n.code,{children:"AuthProvider"}),". The builder should return ",(0,t.jsx)(n.code,{children:"null"})," when the provider is disabled."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-dart",children:"class ExampleProviderOptions {\n  const ExampleProviderOptions({\n    required this.clientId,\n    required this.clientSecret,\n    required this.redirectUri,\n  });\n\n  final String clientId;\n  final String clientSecret;\n  final String redirectUri;\n}\n\nAuthProviderRegistration exampleRegistration() {\n  return AuthProviderRegistration(\n    id: 'example',\n    schema: ConfigSchema.object(\n      description: 'Example OAuth provider settings.',\n      properties: {\n        'enabled': ConfigSchema.boolean(defaultValue: false),\n        'client_id': ConfigSchema.string(),\n        'client_secret': ConfigSchema.string(),\n        'redirect_uri': ConfigSchema.string(),\n      },\n    ),\n    builder: (config) {\n      final enabled =\n          parseBoolLike(config['enabled'], context: 'auth.providers.example.enabled') ??\n          false;\n      if (!enabled) return null;\n\n      final clientId = _requireString(\n        config['client_id'],\n        'auth.providers.example.client_id',\n      );\n      final clientSecret = _requireString(\n        config['client_secret'],\n        'auth.providers.example.client_secret',\n      );\n      final redirectUri = _requireString(\n        config['redirect_uri'],\n        'auth.providers.example.redirect_uri',\n      );\n\n      return OAuthProvider(\n        id: 'example',\n        name: 'Example',\n        clientId: clientId,\n        clientSecret: clientSecret,\n        authorizationEndpoint: Uri.parse('https://example.com/oauth/authorize'),\n        tokenEndpoint: Uri.parse('https://example.com/oauth/token'),\n        userInfoEndpoint: Uri.parse('https://example.com/me'),\n        redirectUri: redirectUri,\n        profile: (profile) => AuthUser(\n          id: profile['id'].toString(),\n          email: profile['email']?.toString(),\n          name: profile['name']?.toString(),\n          attributes: profile,\n        ),\n      );\n    },\n  );\n}\n\nvoid registerExampleProvider() {\n  AuthProviderRegistry.instance.register(exampleRegistration());\n}\n\nString _requireString(Object? value, String context) {\n  final resolved = parseStringLike(\n    value,\n    context: context,\n    allowEmpty: true,\n    throwOnInvalid: true,\n  );\n  if (resolved == null || resolved.trim().isEmpty) {\n    throw ProviderConfigException('$context is required');\n  }\n  return resolved.trim();\n}\n"})}),"\n",(0,t.jsx)(n.h2,{id:"building-custom-adapters",children:"Building Custom Adapters"}),"\n",(0,t.jsxs)(n.p,{children:["Adapters persist users, accounts, sessions, and verification tokens. The base\n",(0,t.jsx)(n.code,{children:"AuthAdapter"})," is a no-op implementation; override the methods your flow needs."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-dart",children:"class MyAuthAdapter extends AuthAdapter {\n  @override\n  Future<AuthUser?> getUserByEmail(String email) async {\n    return db.users.findByEmail(email);\n  }\n\n  @override\n  Future<AuthUser> createUser(AuthUser user) async {\n    return db.users.insert(user);\n  }\n\n  @override\n  Future<AuthAccount?> getAccount(\n    String providerId,\n    String providerAccountId,\n  ) async {\n    return db.accounts.find(providerId, providerAccountId);\n  }\n\n  @override\n  Future<void> linkAccount(AuthAccount account) async {\n    await db.accounts.insert(account);\n  }\n\n  @override\n  Future<AuthSession?> getSession(String sessionToken) async {\n    return db.sessions.findByToken(sessionToken);\n  }\n\n  @override\n  Future<AuthSession> createSession(AuthSession session) async {\n    return db.sessions.insert(session);\n  }\n\n  @override\n  Future<void> deleteSession(String sessionToken) async {\n    await db.sessions.delete(sessionToken);\n  }\n\n  @override\n  Future<void> saveVerificationToken(AuthVerificationToken token) async {\n    await db.verificationTokens.upsert(token);\n  }\n\n  @override\n  Future<AuthVerificationToken?> useVerificationToken(\n    String identifier,\n    String token,\n  ) async {\n    return db.verificationTokens.consume(identifier, token);\n  }\n\n  @override\n  Future<void> deleteVerificationTokens(String identifier) async {\n    await db.verificationTokens.deleteForIdentifier(identifier);\n  }\n}\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Register the adapter in ",(0,t.jsx)(n.code,{children:"AuthOptions"})," or the container:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-dart",children:"engine.container.instance<AuthOptions>(\n  AuthOptions(adapter: MyAuthAdapter()),\n);\n"})}),"\n",(0,t.jsx)(n.h2,{id:"adapter-tips",children:"Adapter Tips"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Implement ",(0,t.jsx)(n.code,{children:"verifyCredentials"})," and ",(0,t.jsx)(n.code,{children:"registerCredentials"})," for credentials flows."]}),"\n",(0,t.jsxs)(n.li,{children:["Implement ",(0,t.jsx)(n.code,{children:"saveVerificationToken"}),"/",(0,t.jsx)(n.code,{children:"useVerificationToken"}),"/",(0,t.jsx)(n.code,{children:"deleteVerificationTokens"}),"\nfor email magic links."]}),"\n",(0,t.jsx)(n.li,{children:"Implement account/session methods when using OAuth + session strategy."}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>d,x:()=>o});var i=r(6540);const t={},s=i.createContext(t);function d(e){const n=i.useContext(s);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:d(e.components),i.createElement(s.Provider,{value:n},e.children)}}}]);