"use strict";(globalThis.webpackChunkrouted=globalThis.webpackChunkrouted||[]).push([[7487],{8453:(e,n,t)=>{t.d(n,{R:()=>l,x:()=>d});var r=t(6540);const s={},i=r.createContext(s);function l(e){const n=r.useContext(i);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:l(e.components),r.createElement(i.Provider,{value:n},e.children)}},8698:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>d,default:()=>h,frontMatter:()=>l,metadata:()=>r,toc:()=>a});const r=JSON.parse('{"id":"fundamentals/observability","title":"Observability","description":"Enable tracing, metrics, health endpoints, and error observers","source":"@site/docs/routed/fundamentals/observability.mdx","sourceDirName":"fundamentals","slug":"/fundamentals/observability","permalink":"/docs/routed/fundamentals/observability","draft":false,"unlisted":false,"editUrl":"https://github.com/kingwill101/routed/tree/main/docs/docs/routed/fundamentals/observability.mdx","tags":[],"version":"current","sidebarPosition":12,"frontMatter":{"title":"Observability","description":"Enable tracing, metrics, health endpoints, and error observers","sidebar_position":12},"sidebar":"routedSidebar","previous":{"title":"Contracts","permalink":"/docs/routed/fundamentals/contracts"},"next":{"title":"Routed CLI Reference","permalink":"/docs/routed/fundamentals/cli"}}');var s=t(4848),i=t(8453);const l={title:"Observability",description:"Enable tracing, metrics, health endpoints, and error observers",sidebar_position:12},d="Observability",c={},a=[{value:"OpenTelemetry tracing",id:"opentelemetry-tracing",level:2},{value:"Prometheus metrics",id:"prometheus-metrics",level:2},{value:"Sample dashboards",id:"sample-dashboards",level:3},{value:"Health and readiness endpoints",id:"health-and-readiness-endpoints",level:2},{value:"Error observers",id:"error-observers",level:2},{value:"Sentry integration",id:"sentry-integration",level:2},{value:"Logging defaults",id:"logging-defaults",level:2},{value:"Events",id:"events",level:2},{value:"Publishing and Subscribing",id:"publishing-and-subscribing",level:3},{value:"Built-in Event Types",id:"built-in-event-types",level:3},{value:"Request Lifecycle",id:"request-lifecycle",level:4},{value:"Routing",id:"routing",level:4},{value:"System",id:"system",level:4},{value:"Cache",id:"cache",level:4},{value:"Rate Limiting",id:"rate-limiting",level:4},{value:"Custom Events",id:"custom-events",level:3},{value:"Signals",id:"signals",level:2},{value:"<code>SignalHub</code>",id:"signalhub",level:3},{value:"Available Signals",id:"available-signals",level:3},{value:"Disconnecting",id:"disconnecting",level:3},{value:"Zone Access",id:"zone-access",level:3},{value:"Putting it together",id:"putting-it-together",level:2}];function o(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"observability",children:"Observability"})}),"\n",(0,s.jsx)(n.p,{children:"Routed ships with an observability service provider that wires together tracing, metrics, health endpoints, and error observers. The provider is enabled by default and exposes configuration switches so you can opt into the pieces you need without touching application code."}),"\n",(0,s.jsxs)(n.p,{children:["The defaults live under the ",(0,s.jsx)(n.code,{children:"observability"})," section of your configuration:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",metastring:'title="config/app.yaml"',children:"observability:\n  enabled: true\n  tracing:\n    enabled: false\n    exporter: none          # none, console, or otlp\n    service_name: routed-service\n    endpoint: null          # OTLP collector URI when exporter=otlp\n    headers: {}             # Optional OTLP headers (for auth tokens, etc.)\n  metrics:\n    enabled: false\n    path: /metrics\n    buckets: [0.01, 0.05, 0.1, 0.25, 0.5, 1.0, 2.0, 5.0]\n  health:\n    enabled: true\n    readiness_path: /readyz\n    liveness_path: /livez\n  errors:\n    enabled: false          # Reserve for future error reporter hooks\n  sentry:\n    enabled: false\n    dsn: null               # Sentry DSN\n    send_default_pii: false\n    traces_sample_rate: 0.0\n"})}),"\n",(0,s.jsxs)(n.p,{children:["When the provider boots it automatically registers tracing and metrics middleware, attaches Prometheus-style routes, and exposes a health service you can extend at runtime. Toggle the granular ",(0,s.jsx)(n.code,{children:"observability.*.enabled"})," flags (for example ",(0,s.jsx)(n.code,{children:"observability.tracing.enabled: true"}),") to switch individual features on or off."]}),"\n",(0,s.jsx)(n.h2,{id:"opentelemetry-tracing",children:"OpenTelemetry tracing"}),"\n",(0,s.jsxs)(n.p,{children:["Set ",(0,s.jsx)(n.code,{children:"observability.tracing.enabled: true"})," to instrument request spans with the ",(0,s.jsx)(n.a,{href:"https://opentelemetry.io/",children:"OpenTelemetry"})," SDK. Routed extracts incoming W3C Trace Context headers and creates server spans named after HTTP method and route label. Each span includes attributes for method, route, target, and status code, and records exceptions automatically."]}),"\n",(0,s.jsx)(n.p,{children:"Supported exporters:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"none"})," (default): disables span export while keeping request handling cheap."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"console"}),": prints spans to stdout, useful for local debugging."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"otlp"}),": sends spans to an OTLP collector. Provide ",(0,s.jsx)(n.code,{children:"observability.tracing.endpoint"})," (for example, ",(0,s.jsx)(n.code,{children:"http://collector:4318/v1/traces"}),") and optional ",(0,s.jsx)(n.code,{children:"headers"})," for authentication."]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",metastring:'title="config/app.yaml"',children:"observability:\n  tracing:\n    enabled: true\n    exporter: otlp\n    service_name: checkout-api\n    endpoint: https://otel.example.com/v1/traces\n    headers:\n      authorization: Bearer ${OTEL_TOKEN}\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Routed injects the tracing middleware ahead of other middleware so handlers and downstream middleware all see the active span. If you need to customise ordering, override ",(0,s.jsx)(n.code,{children:"http.middleware_sources.routed.observability.global"})," and reorder the generated IDs (",(0,s.jsx)(n.code,{children:"routed.observability.tracing"}),", ",(0,s.jsx)(n.code,{children:"routed.observability.metrics"}),", ",(0,s.jsx)(n.code,{children:"routed.observability.health"}),")."]}),"\n",(0,s.jsx)(n.h2,{id:"prometheus-metrics",children:"Prometheus metrics"}),"\n",(0,s.jsxs)(n.p,{children:["Enable ",(0,s.jsx)(n.code,{children:"observability.metrics.enabled"})," to expose an HTTP ",(0,s.jsx)(n.code,{children:"/metrics"})," endpoint that emits Prometheus exposition format. Metrics collected out of the box:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"routed_requests_total{method,route,status}"})," \u2013 counter of completed requests."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"routed_request_duration_seconds_bucket|sum|count{method,route,status}"})," \u2013 histogram timing data using the configured buckets."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"routed_active_requests"})," \u2013 gauge of in-flight requests."]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",metastring:'title="config/app.yaml"',children:"observability:\n  metrics:\n    enabled: true\n    path: /metrics   # customise the exposure path\n    buckets: [0.05, 0.1, 0.25, 0.5, 1, 2]  # seconds\n"})}),"\n",(0,s.jsxs)(n.p,{children:["The metrics middleware runs before handlers, recording timings even when a request throws. You can register additional metrics by pulling the ",(0,s.jsx)(n.code,{children:"MetricsService"})," out of the container during boot."]}),"\n",(0,s.jsx)(n.h3,{id:"sample-dashboards",children:"Sample dashboards"}),"\n",(0,s.jsx)(n.p,{children:"Start with these PromQL snippets when wiring Grafana:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Request throughput:"})," ",(0,s.jsx)(n.code,{children:"sum(rate(routed_requests_total[5m])) by (route)"})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Latency percentiles:"})," ",(0,s.jsx)(n.code,{children:"histogram_quantile(0.95, sum(rate(routed_request_duration_seconds_bucket[5m])) by (le, route))"})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Error rate:"})," ",(0,s.jsx)(n.code,{children:'sum(rate(routed_requests_total{status=~"5.."}[5m])) / sum(rate(routed_requests_total[5m]))'})]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["Adjust the range window (",(0,s.jsx)(n.code,{children:"[5m]"}),") to match your traffic profile."]}),"\n",(0,s.jsx)(n.h2,{id:"health-and-readiness-endpoints",children:"Health and readiness endpoints"}),"\n",(0,s.jsx)(n.p,{children:"The health service exposes two JSON endpoints:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"GET /readyz"})," (readiness) \u2013 returns ",(0,s.jsx)(n.code,{children:"503"})," until registered checks report healthy."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"GET /livez"})," (liveness) \u2013 returns ",(0,s.jsx)(n.code,{children:"200"})," by default unless you register failing checks."]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["Register extra checks at runtime via ",(0,s.jsx)(n.code,{children:"HealthService"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-dart",children:"final health = engine.container.make<HealthService>();\nhealth.registerReadinessCheck('database', () async {\n  final ok = await db.isHealthy();\n  return ok\n      ? HealthCheckResult.ok({'pong': true})\n      : HealthCheckResult.failure({'error': 'timeout'});\n});\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Each check name becomes a key inside the JSON payload, and failures automatically flip the response status to ",(0,s.jsx)(n.code,{children:"503 Service Unavailable"}),". Adjust paths with ",(0,s.jsx)(n.code,{children:"observability.health.readiness_path"})," and ",(0,s.jsx)(n.code,{children:"observability.health.liveness_path"})," when you need to comply with platform probes."]}),"\n",(0,s.jsx)(n.h2,{id:"error-observers",children:"Error observers"}),"\n",(0,s.jsxs)(n.p,{children:["The provider exposes an ",(0,s.jsx)(n.code,{children:"ErrorObserverRegistry"})," you can use to forward unhandled request errors to external systems (error trackers, paging tools, etc.). Observers receive the ",(0,s.jsx)(n.code,{children:"EngineContext"}),", error, and stack trace so they can enrich reports with request metadata."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-dart",children:"class SentryObserver implements ErrorObserver {\n  @override\n  Future<void> onError(\n    EngineContext context,\n    Object error,\n    StackTrace stackTrace,\n  ) async {\n    await sentry.captureException(\n      error,\n      stackTrace: stackTrace,\n      withScope: (scope) {\n        scope.setContext('request', context.loggerContext);\n      },\n    );\n  }\n}\n\nengine.container.make<ErrorObserverRegistry>().addObserver(SentryObserver());\n"})}),"\n",(0,s.jsx)(n.p,{children:"Observer failures are swallowed so they never break the request pipeline\u2014log them internally if you need to monitor integration health."}),"\n",(0,s.jsx)(n.h2,{id:"sentry-integration",children:"Sentry integration"}),"\n",(0,s.jsxs)(n.p,{children:["Enable ",(0,s.jsx)(n.code,{children:"observability.sentry.enabled"})," to initialize the Sentry SDK and forward routing errors automatically. This is wired through the observability provider, so you only need to supply the DSN and (optionally) enable tracing."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",metastring:'title="config/app.yaml"',children:"observability:\n  sentry:\n    enabled: true\n    dsn: https://examplePublicKey@o0.ingest.sentry.io/0\n    send_default_pii: true\n    traces_sample_rate: 0.2\n"})}),"\n",(0,s.jsxs)(n.p,{children:["When enabled, routed will call ",(0,s.jsx)(n.code,{children:"Sentry.captureException"})," for ",(0,s.jsx)(n.code,{children:"RoutingErrorEvent"})," failures. Use ",(0,s.jsx)(n.code,{children:"traces_sample_rate"})," to enable Sentry performance sampling if you want transaction visibility."]}),"\n",(0,s.jsx)(n.h2,{id:"logging-defaults",children:"Logging defaults"}),"\n",(0,s.jsxs)(n.p,{children:["When ",(0,s.jsx)(n.code,{children:"observability.logging.format"})," is ",(0,s.jsx)(n.code,{children:"json"})," (the default), the provider configures ",(0,s.jsx)(n.code,{children:"RoutedLogger"})," to emit JSON across the application. Switch to ",(0,s.jsx)(n.code,{children:"text"})," for local development or attach your own logger factory for custom sinks."]}),"\n",(0,s.jsx)(n.p,{children:"Combine log formatting with tracing and metrics so each request yields structured telemetry alongside spans and Prometheus counters. All components read from the same configuration scope, making it easy to toggle behaviour per environment (for example, JSON logs with OTLP spans in production, plain text with console spans locally)."}),"\n",(0,s.jsx)(n.h2,{id:"events",children:"Events"}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"EventManager"})," is a lightweight pub/sub bus built on top of Dart streams. The observability provider subscribes to events automatically, but you can also use it directly for application-level concerns."]}),"\n",(0,s.jsx)(n.h3,{id:"publishing-and-subscribing",children:"Publishing and Subscribing"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-dart",children:"final events = engine.container.make<EventManager>();\n\n// Subscribe to a specific event type\nevents.listen<RequestFinishedEvent>((event) {\n  print('Request completed: ${event.context.path}');\n});\n\n// Or get a stream for more control\nevents.on<RouteMatchedEvent>().where((e) => e.route.path.startsWith('/api')).listen((e) {\n  // Track API-specific metrics\n});\n\n// Publish a custom event\nevents.publish(MyCustomEvent(data: 'hello'));\n"})}),"\n",(0,s.jsx)(n.h3,{id:"built-in-event-types",children:"Built-in Event Types"}),"\n",(0,s.jsx)(n.h4,{id:"request-lifecycle",children:"Request Lifecycle"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Event"}),(0,s.jsx)(n.th,{children:"When"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"RequestStartedEvent(context)"})}),(0,s.jsx)(n.td,{children:"Request context has been initialized"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"RequestFinishedEvent(context)"})}),(0,s.jsx)(n.td,{children:"After the full request pipeline completes"})]})]})]}),"\n",(0,s.jsx)(n.h4,{id:"routing",children:"Routing"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Event"}),(0,s.jsx)(n.th,{children:"When"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"BeforeRoutingEvent(context)"})}),(0,s.jsx)(n.td,{children:"Before route matching begins"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"RouteMatchedEvent(context, route)"})}),(0,s.jsx)(n.td,{children:"A route was successfully matched"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"RouteNotFoundEvent(context)"})}),(0,s.jsx)(n.td,{children:"No matching route was found"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"AfterRoutingEvent(context, {route?, error?})"})}),(0,s.jsx)(n.td,{children:"After the handler completes (success or failure)"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"RoutingErrorEvent(context, route?, error, stackTrace)"})}),(0,s.jsx)(n.td,{children:"The handler threw an error"})]})]})]}),"\n",(0,s.jsx)(n.h4,{id:"system",children:"System"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Event"}),(0,s.jsx)(n.th,{children:"When"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"ProviderRegisteredEvent(provider)"})}),(0,s.jsx)(n.td,{children:"A service provider was registered"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"ProviderBootedEvent(provider)"})}),(0,s.jsx)(n.td,{children:"A service provider finished booting"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"RequestContainerCreatedEvent(containerId)"})}),(0,s.jsx)(n.td,{children:"A scoped request container was created"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"RequestContainerDisposedEvent(containerId)"})}),(0,s.jsx)(n.td,{children:"A scoped request container was disposed"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"SystemErrorEvent(error, stackTrace?)"})}),(0,s.jsx)(n.td,{children:"A system-level error occurred"})]})]})]}),"\n",(0,s.jsx)(n.h4,{id:"cache",children:"Cache"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Event"}),(0,s.jsx)(n.th,{children:"When"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"CacheHitEvent(store, key)"})}),(0,s.jsx)(n.td,{children:"A cache lookup returned a value"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"CacheMissEvent(store, key)"})}),(0,s.jsx)(n.td,{children:"A cache lookup missed"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"CacheWriteEvent(store, key, {ttl?})"})}),(0,s.jsx)(n.td,{children:"A value was written to cache"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"CacheForgetEvent(store, key)"})}),(0,s.jsx)(n.td,{children:"A value was removed from cache"})]})]})]}),"\n",(0,s.jsx)(n.h4,{id:"rate-limiting",children:"Rate Limiting"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Event"}),(0,s.jsx)(n.th,{children:"When"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"RateLimitAllowedEvent(policy, strategy, identity, remaining)"})}),(0,s.jsx)(n.td,{children:"A request passed the rate limiter"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"RateLimitBlockedEvent(policy, strategy, identity, remaining, {retryAfter})"})}),(0,s.jsx)(n.td,{children:"A request was blocked by the rate limiter"})]})]})]}),"\n",(0,s.jsx)(n.h3,{id:"custom-events",children:"Custom Events"}),"\n",(0,s.jsxs)(n.p,{children:["Create custom events by extending the ",(0,s.jsx)(n.code,{children:"Event"})," base class:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-dart",children:"class OrderPlacedEvent extends Event {\n  final String orderId;\n  final double total;\n  OrderPlacedEvent({required this.orderId, required this.total});\n}\n\n// Publish\nevents.publish(OrderPlacedEvent(orderId: '123', total: 99.99));\n\n// Subscribe\nevents.listen<OrderPlacedEvent>((e) {\n  print('Order ${e.orderId} placed for \\$${e.total}');\n});\n"})}),"\n",(0,s.jsxs)(n.p,{children:["All events inherit a ",(0,s.jsx)(n.code,{children:"timestamp"})," field (",(0,s.jsx)(n.code,{children:"DateTime"}),") that is set automatically at creation time."]}),"\n",(0,s.jsx)(n.h2,{id:"signals",children:"Signals"}),"\n",(0,s.jsx)(n.p,{children:"Signals provide a Django-like pattern for request lifecycle hooks with sender filtering. Unlike raw events, signals support:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Sender filtering"})," \u2014 only fire when the signal comes from a specific context or route"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Keyed handlers"})," \u2014 de-duplicate subscriptions by key"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Sequential dispatch"})," \u2014 handlers run one at a time (not concurrent)"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"signalhub",children:(0,s.jsx)(n.code,{children:"SignalHub"})}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"SignalHub"})," wraps ",(0,s.jsx)(n.code,{children:"EventManager"})," and exposes five request signals:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-dart",children:"final signalHub = engine.container.make<SignalHub>();\n\n// Connect to the \"request started\" signal\nsignalHub.requestSignals.started.connect((event) {\n  print('New request: ${event.context.path}');\n});\n\n// Connect with sender filtering \u2014 only fires for a specific route\nsignalHub.requestSignals.routeMatched.connect(\n  (event) => print('API route matched'),\n  sender: myApiRoute,  // Only fires for this specific route\n);\n"})}),"\n",(0,s.jsx)(n.h3,{id:"available-signals",children:"Available Signals"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Signal"}),(0,s.jsx)(n.th,{children:"Event Type"}),(0,s.jsx)(n.th,{children:"When"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"requestSignals.started"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"RequestStartedEvent"})}),(0,s.jsx)(n.td,{children:"Request begins"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"requestSignals.finished"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"RequestFinishedEvent"})}),(0,s.jsx)(n.td,{children:"Request completes"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"requestSignals.routeMatched"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"RouteMatchedEvent"})}),(0,s.jsx)(n.td,{children:"Route matched"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"requestSignals.routingError"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"RoutingErrorEvent"})}),(0,s.jsx)(n.td,{children:"Handler error"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"requestSignals.afterRouting"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"AfterRoutingEvent"})}),(0,s.jsx)(n.td,{children:"After handler runs"})]})]})]}),"\n",(0,s.jsx)(n.h3,{id:"disconnecting",children:"Disconnecting"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-dart",children:"final sub = signalHub.requestSignals.started.connect(myHandler);\nsub.cancel(); // Disconnect this handler\n\n// Or disconnect by handler reference\nsignalHub.requestSignals.started.disconnect(myHandler);\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Signal handler exceptions are caught and re-published as ",(0,s.jsx)(n.code,{children:"UnhandledSignalError"})," events \u2014 they never crash the request pipeline."]}),"\n",(0,s.jsx)(n.h3,{id:"zone-access",children:"Zone Access"}),"\n",(0,s.jsxs)(n.p,{children:["Signals are also available via ",(0,s.jsx)(n.code,{children:"AppZone.signals"})," when running inside an engine zone:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-dart",children:"AppZone.signals.requestSignals.finished.connect((event) {\n  // ...\n});\n"})}),"\n",(0,s.jsx)(n.h2,{id:"putting-it-together",children:"Putting it together"}),"\n",(0,s.jsx)(n.p,{children:"Most deployments start with:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["Enable tracing with either ",(0,s.jsx)(n.code,{children:"console"})," or ",(0,s.jsx)(n.code,{children:"otlp"})," exporter."]}),"\n",(0,s.jsx)(n.li,{children:"Turn on metrics and point your Prometheus scraper at the exposed path."}),"\n",(0,s.jsx)(n.li,{children:"Register readiness checks for backing services (databases, queues, external APIs)."}),"\n",(0,s.jsx)(n.li,{children:"Add an error observer that forwards critical errors to your alerting stack."}),"\n",(0,s.jsx)(n.li,{children:"Subscribe to events or signals for application-level cross-cutting concerns (audit logs, analytics, notifications)."}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Because the provider reacts to configuration reloads, you can change options (for example, toggling tracing or metrics) without recreating the engine\u2014handy during incident response when you need deeper visibility temporarily."})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(o,{...e})}):o(e)}}}]);