"use strict";(globalThis.webpackChunkrouted=globalThis.webpackChunkrouted||[]).push([[6793],{7196:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>s,default:()=>u,frontMatter:()=>o,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"advanced/http2","title":"HTTP/2 support","description":"Enable HTTP/2 in Routed, understand negotiation, fallback behaviour, and TLS requirements.","source":"@site/docs/routed/advanced/http2.mdx","sourceDirName":"advanced","slug":"/advanced/http2","permalink":"/docs/routed/advanced/http2","draft":false,"unlisted":false,"editUrl":"https://github.com/kingwill101/routed/tree/main/docs/docs/routed/advanced/http2.mdx","tags":[],"version":"current","sidebarPosition":9,"frontMatter":{"id":"http2","title":"HTTP/2 support","sidebar_position":9,"description":"Enable HTTP/2 in Routed, understand negotiation, fallback behaviour, and TLS requirements."},"sidebar":"routedSidebar","previous":{"title":"Rate limiting design notes","permalink":"/docs/routed/advanced/rate-limiting-design"},"next":{"title":"Localization","permalink":"/docs/routed/advanced/localization"}}');var r=n(4848),a=n(8453);const o={id:"http2",title:"HTTP/2 support",sidebar_position:9,description:"Enable HTTP/2 in Routed, understand negotiation, fallback behaviour, and TLS requirements."},s=void 0,l={},d=[{value:"Enable HTTP/2",id:"enable-http2",level:2},{value:"Streaming and middleware behaviour",id:"streaming-and-middleware-behaviour",level:2},{value:"Graceful shutdown",id:"graceful-shutdown",level:2},{value:"Testing and tooling",id:"testing-and-tooling",level:2},{value:"Troubleshooting",id:"troubleshooting",level:2}];function c(e){const t={code:"code",h2:"h2",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.p,{children:"Routed ships built-in HTTP/2 support when you enable it in the engine configuration. The server negotiates HTTP/2 via ALPN and automatically falls back to HTTP/1.1 for clients that do not support it. Existing middleware, routing, and streaming handlers continue to work transparently."}),"\n",(0,r.jsx)(t.h2,{id:"enable-http2",children:"Enable HTTP/2"}),"\n",(0,r.jsx)(t.p,{children:"HTTP/2 requires TLS. Provide your certificate and enable the feature flag either in configuration manifests or programmatically:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",metastring:'title="config/http.yaml"',children:"http:\n  http2:\n    enabled: true\n    allow_cleartext: false\n    max_concurrent_streams: 256\n    idle_timeout: 30s\n  tls:\n    certificate_path: cert.pem\n    key_path: key.pem\n"})}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-dart",metastring:'title="main.dart"',children:"final engine = Engine(\n  config: EngineConfig(\n    http2: const Http2Config(\n      enabled: true,\n      allowCleartext: false,\n      maxConcurrentStreams: 256,\n      idleTimeout: Duration(seconds: 30),\n    ),\n  ),\n)..get('/', (ctx) => ctx.string('Hello, HTTP/2!'));\n\nawait engine.serveSecure(\n  address: '0.0.0.0',\n  port: 8443,\n  certificatePath: 'cert.pem', // optional when http.tls.* is configured\n  keyPath: 'key.pem',\n);\n"})}),"\n",(0,r.jsxs)(t.p,{children:["Routed registers ALPN protocols ",(0,r.jsx)(t.code,{children:'["h2", "http/1.1"]'}),". HTTP/2-capable clients receive multiplexed responses; others transparently downgrade to HTTP/1.1."]}),"\n",(0,r.jsx)(t.h2,{id:"streaming-and-middleware-behaviour",children:"Streaming and middleware behaviour"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:"Middleware, routing, SSE, and file downloads continue to operate over HTTP/2 streams."}),"\n",(0,r.jsx)(t.li,{children:"Response compression, request logging, and sessions work without modification."}),"\n",(0,r.jsx)(t.li,{children:"WebSockets remain an HTTP/1.1-only feature; clients attempting to upgrade over HTTP/2 will receive the documented error."}),"\n"]}),"\n",(0,r.jsx)(t.h2,{id:"graceful-shutdown",children:"Graceful shutdown"}),"\n",(0,r.jsx)(t.p,{children:"The existing shutdown controller drains active HTTP/2 streams before closing the listener. Fallback to HTTP/1.1 is handled automatically\u2014no additional steps are required in deployment scripts."}),"\n",(0,r.jsx)(t.h2,{id:"testing-and-tooling",children:"Testing and tooling"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:["Use ",(0,r.jsx)(t.code,{children:"curl --http2"})," or ",(0,r.jsx)(t.code,{children:"h2load"})," to verify multiplexer behaviour."]}),"\n",(0,r.jsxs)(t.li,{children:["The example application at ",(0,r.jsx)(t.code,{children:"examples/http2/"})," includes self-signed certificates for local testing (see the README in that directory for regeneration and curl verification steps)."]}),"\n",(0,r.jsxs)(t.li,{children:["Add your CA bundle to the client ",(0,r.jsx)(t.code,{children:"SecurityContext"})," when writing integration tests (see ",(0,r.jsx)(t.code,{children:"packages/routed/test/engine/http2_server_test.dart"}),")."]}),"\n"]}),"\n",(0,r.jsx)(t.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:"Handshake falls back to HTTP/1.1:"})," ensure the certificate and ALPN configuration include ",(0,r.jsx)(t.code,{children:'"h2"'}),", and that the client advertises support."]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:"Self-signed certificates:"})," developers must trust the certificate in their client context; otherwise the TLS handshake will fail."]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:"Proxy termination:"})," when a reverse proxy terminates TLS, HTTP/2 must be negotiated at the proxy layer. Routed will run in HTTP/1.1 mode behind the proxy."]}),"\n"]})]})}function u(e={}){const{wrapper:t}={...(0,a.R)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}},8453:(e,t,n)=>{n.d(t,{R:()=>o,x:()=>s});var i=n(6540);const r={},a=i.createContext(r);function o(e){const t=i.useContext(a);return i.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function s(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),i.createElement(a.Provider,{value:t},e.children)}}}]);