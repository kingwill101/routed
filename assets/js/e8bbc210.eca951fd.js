"use strict";(self.webpackChunkrouted=self.webpackChunkrouted||[]).push([[7724],{4085:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>a,contentTitle:()=>d,default:()=>l,frontMatter:()=>o,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"routed/security/auth-providers","title":"Auth Providers & Adapters","description":"Configure built-in providers and build custom auth integrations","source":"@site/docs/routed/security/auth-providers.mdx","sourceDirName":"routed/security","slug":"/routed/security/auth-providers","permalink":"/docs/routed/security/auth-providers","draft":false,"unlisted":false,"editUrl":"https://github.com/kingwill101/routed/tree/main/docs/docs/routed/security/auth-providers.mdx","tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"title":"Auth Providers & Adapters","description":"Configure built-in providers and build custom auth integrations","authors":"routed","sidebar_position":4},"sidebar":"tutorialSidebar","previous":{"title":"Securing file uploads","permalink":"/docs/routed/security/upload-hardening"},"next":{"title":"Testing Routed Apps","permalink":"/docs/routed/testing/overview"}}');var t=r(4848),s=r(8453);const o={title:"Auth Providers & Adapters",description:"Configure built-in providers and build custom auth integrations",authors:"routed",sidebar_position:4},d="Auth Providers & Adapters",a={},c=[{value:"Built-in providers",id:"built-in-providers",level:2},{value:"Registering custom providers",id:"registering-custom-providers",level:2},{value:"Wiring provider config",id:"wiring-provider-config",level:2},{value:"Building custom adapters",id:"building-custom-adapters",level:2},{value:"Adapter tips",id:"adapter-tips",level:2}];function u(e){const n={code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"auth-providers--adapters",children:"Auth Providers & Adapters"})}),"\n",(0,t.jsxs)(n.p,{children:["This page documents how auth providers are configured, registered, and wired into the\n",(0,t.jsx)(n.code,{children:"AuthManager"}),", plus how to implement a custom ",(0,t.jsx)(n.code,{children:"AuthAdapter"})," for persistence."]}),"\n",(0,t.jsx)(n.h2,{id:"built-in-providers",children:"Built-in providers"}),"\n",(0,t.jsx)(n.p,{children:"Routed ships with a GitHub OAuth provider. Configuration is registry-driven and only\nregistered providers are loaded from config."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",metastring:'title="config/auth.yaml"',children:"providers:\n  github:\n    enabled: true\n    client_id: \"{{ env.GITHUB_CLIENT_ID | default: '' }}\"\n    client_secret: \"{{ env.GITHUB_CLIENT_SECRET | default: '' }}\"\n    redirect_uri: \"{{ env.GITHUB_REDIRECT_URI | default: '' }}\"\n    scopes:\n      - read:user\n      - user:email\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Providers are registered at boot (for example, ",(0,t.jsx)(n.code,{children:"registerGitHubAuthProvider"}),"), and the\nregistry contributes defaults and schema metadata to your config docs."]}),"\n",(0,t.jsx)(n.h2,{id:"registering-custom-providers",children:"Registering custom providers"}),"\n",(0,t.jsxs)(n.p,{children:["Custom providers register a schema plus a builder that turns config into an\n",(0,t.jsx)(n.code,{children:"AuthProvider"}),". The builder should return ",(0,t.jsx)(n.code,{children:"null"})," when the provider is disabled."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-dart",children:"class ExampleProviderOptions {\n  const ExampleProviderOptions({\n    required this.clientId,\n    required this.clientSecret,\n    required this.redirectUri,\n  });\n\n  final String clientId;\n  final String clientSecret;\n  final String redirectUri;\n}\n\nAuthProviderRegistration exampleRegistration() {\n  return AuthProviderRegistration(\n    id: 'example',\n    schema: ConfigSchema.object(\n      description: 'Example OAuth provider settings.',\n      properties: {\n        'enabled': ConfigSchema.boolean(defaultValue: false),\n        'client_id': ConfigSchema.string(),\n        'client_secret': ConfigSchema.string(),\n        'redirect_uri': ConfigSchema.string(),\n      },\n    ),\n    builder: (config) {\n      final enabled =\n          parseBoolLike(config['enabled'], context: 'auth.providers.example.enabled') ??\n          false;\n      if (!enabled) return null;\n\n      final clientId = _requireString(\n        config['client_id'],\n        'auth.providers.example.client_id',\n      );\n      final clientSecret = _requireString(\n        config['client_secret'],\n        'auth.providers.example.client_secret',\n      );\n      final redirectUri = _requireString(\n        config['redirect_uri'],\n        'auth.providers.example.redirect_uri',\n      );\n\n      return OAuthProvider(\n        id: 'example',\n        name: 'Example',\n        clientId: clientId,\n        clientSecret: clientSecret,\n        authorizationEndpoint: Uri.parse('https://example.com/oauth/authorize'),\n        tokenEndpoint: Uri.parse('https://example.com/oauth/token'),\n        userInfoEndpoint: Uri.parse('https://example.com/me'),\n        redirectUri: redirectUri,\n        profile: (profile) => AuthUser(\n          id: profile['id'].toString(),\n          email: profile['email']?.toString(),\n          name: profile['name']?.toString(),\n          attributes: profile,\n        ),\n      );\n    },\n  );\n}\n\nvoid registerExampleProvider() {\n  AuthProviderRegistry.instance.register(exampleRegistration());\n}\n\nString _requireString(Object? value, String context) {\n  final resolved = parseStringLike(\n    value,\n    context: context,\n    allowEmpty: true,\n    throwOnInvalid: true,\n  );\n  if (resolved == null || resolved.trim().isEmpty) {\n    throw ProviderConfigException('$context is required');\n  }\n  return resolved.trim();\n}\n"})}),"\n",(0,t.jsx)(n.h2,{id:"wiring-provider-config",children:"Wiring provider config"}),"\n",(0,t.jsxs)(n.p,{children:["Provider config lives under ",(0,t.jsx)(n.code,{children:"auth.providers"}),". Each registered provider contributes its\nschema and defaults, and only registered providers are constructed at runtime."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",metastring:'title="config/auth.yaml"',children:"providers:\n  example:\n    enabled: true\n    client_id: \"{{ env.EXAMPLE_CLIENT_ID | default: '' }}\"\n    client_secret: \"{{ env.EXAMPLE_CLIENT_SECRET | default: '' }}\"\n    redirect_uri: \"{{ env.EXAMPLE_REDIRECT_URI | default: '' }}\"\n"})}),"\n",(0,t.jsx)(n.h2,{id:"building-custom-adapters",children:"Building custom adapters"}),"\n",(0,t.jsxs)(n.p,{children:["Adapters persist users, accounts, sessions, and verification tokens. The base\n",(0,t.jsx)(n.code,{children:"AuthAdapter"})," is a no-op implementation; override the methods your flow needs."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-dart",children:"class MyAuthAdapter extends AuthAdapter {\n  @override\n  Future<AuthUser?> getUserByEmail(String email) async {\n    return db.users.findByEmail(email);\n  }\n\n  @override\n  Future<AuthUser> createUser(AuthUser user) async {\n    return db.users.insert(user);\n  }\n\n  @override\n  Future<AuthAccount?> getAccount(\n    String providerId,\n    String providerAccountId,\n  ) async {\n    return db.accounts.find(providerId, providerAccountId);\n  }\n\n  @override\n  Future<void> linkAccount(AuthAccount account) async {\n    await db.accounts.insert(account);\n  }\n\n  @override\n  Future<AuthSession?> getSession(String sessionToken) async {\n    return db.sessions.findByToken(sessionToken);\n  }\n\n  @override\n  Future<AuthSession> createSession(AuthSession session) async {\n    return db.sessions.insert(session);\n  }\n\n  @override\n  Future<void> deleteSession(String sessionToken) async {\n    await db.sessions.delete(sessionToken);\n  }\n\n  @override\n  Future<void> saveVerificationToken(AuthVerificationToken token) async {\n    await db.verificationTokens.upsert(token);\n  }\n\n  @override\n  Future<AuthVerificationToken?> useVerificationToken(\n    String identifier,\n    String token,\n  ) async {\n    return db.verificationTokens.consume(identifier, token);\n  }\n\n  @override\n  Future<void> deleteVerificationTokens(String identifier) async {\n    await db.verificationTokens.deleteForIdentifier(identifier);\n  }\n}\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Register the adapter in ",(0,t.jsx)(n.code,{children:"AuthOptions"})," or the container:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-dart",children:"engine.container.instance<AuthOptions>(\n  AuthOptions(adapter: MyAuthAdapter()),\n);\n"})}),"\n",(0,t.jsx)(n.h2,{id:"adapter-tips",children:"Adapter tips"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Implement ",(0,t.jsx)(n.code,{children:"verifyCredentials"})," and ",(0,t.jsx)(n.code,{children:"registerCredentials"})," for credentials flows."]}),"\n",(0,t.jsxs)(n.li,{children:["Implement ",(0,t.jsx)(n.code,{children:"saveVerificationToken"}),"/",(0,t.jsx)(n.code,{children:"useVerificationToken"}),"/",(0,t.jsx)(n.code,{children:"deleteVerificationTokens"}),"\nfor email magic links."]}),"\n",(0,t.jsx)(n.li,{children:"Implement account/session methods when using OAuth + session strategy."}),"\n"]})]})}function l(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(u,{...e})}):u(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>o,x:()=>d});var i=r(6540);const t={},s=i.createContext(t);function o(e){const n=i.useContext(s);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:o(e.components),i.createElement(s.Provider,{value:n},e.children)}}}]);