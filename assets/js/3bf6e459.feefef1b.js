"use strict";(globalThis.webpackChunkrouted=globalThis.webpackChunkrouted||[]).push([[7321],{5740:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>o,contentTitle:()=>d,default:()=>u,frontMatter:()=>i,metadata:()=>t,toc:()=>l});const t=JSON.parse('{"id":"fundamentals/requests","title":"Request Handling","description":"Access query strings, forms, files, and request metadata","source":"@site/docs/routed/fundamentals/requests.mdx","sourceDirName":"fundamentals","slug":"/fundamentals/requests","permalink":"/docs/routed/fundamentals/requests","draft":false,"unlisted":false,"editUrl":"https://github.com/kingwill101/routed/tree/main/docs/docs/routed/fundamentals/requests.mdx","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"title":"Request Handling","description":"Access query strings, forms, files, and request metadata","sidebar_position":3},"sidebar":"routedSidebar","previous":{"title":"Middleware","permalink":"/docs/routed/fundamentals/middleware"},"next":{"title":"Responses","permalink":"/docs/routed/fundamentals/responses"}}');var a=r(4848),s=r(8453);const i={title:"Request Handling",description:"Access query strings, forms, files, and request metadata",sidebar_position:3},d="Request Handling",o={},l=[{value:"Query parameters",id:"query-parameters",level:2},{value:"Forms and multipart data",id:"forms-and-multipart-data",level:2},{value:"File uploads",id:"file-uploads",level:3},{value:"JSON and raw bodies",id:"json-and-raw-bodies",level:2},{value:"Request metadata",id:"request-metadata",level:2},{value:"Trusted proxies",id:"trusted-proxies",level:2}];function c(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"request-handling",children:"Request Handling"})}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.code,{children:"EngineContext"})," exposes concise helpers for query strings, forms, file uploads, and request bodies (with content-type aware parsing)."]}),"\n",(0,a.jsx)(n.h2,{id:"query-parameters",children:"Query parameters"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-dart",children:"router.get('/search', (ctx) async {\n  final term = ctx.defaultQuery('q', '');\n  final page = ctx.defaultQuery('page', '1');\n  final tags = ctx.queryArray('tag');\n\n  final (sort, hasSort) = ctx.getQueryMap('sort_');\n\n  return ctx.json({\n    'term': term,\n    'page': page,\n    'tags': tags,\n    'sort': sort,\n    'hasSort': hasSort,\n  });\n});\n"})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"query(key)"})," returns the first value for a parameter."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"defaultQuery(key, fallback)"})," returns a fallback when the value is missing."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"queryArray(key)"})," yields all values for a repeated key."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"getQueryMap(prefix)"})," returns a (Map, bool) pair of matching entries and whether any were found."]}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"forms-and-multipart-data",children:"Forms and multipart data"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-dart",children:"router.post('/contact', (ctx) async {\n  final name = await ctx.postForm('name');\n  final age = await ctx.defaultPostForm('age', '0');\n  final interests = await ctx.postFormArray('interest');\n  final form = await ctx.form();\n  final grouped = Map<String, dynamic>.fromEntries(\n    form.entries.where((entry) => entry.key.startsWith('pref_')),\n  );\n\n  return ctx.json({'name': name, 'age': age, 'interests': interests, 'prefs': grouped});\n});\n"})}),"\n",(0,a.jsxs)(n.p,{children:["Use ",(0,a.jsx)(n.code,{children:"ctx.form()"})," when you need to inspect all fields and apply your own grouping logic. Files are read separately via ",(0,a.jsx)(n.code,{children:"ctx.formFile"}),"/",(0,a.jsx)(n.code,{children:"ctx.formFiles"}),"."]}),"\n",(0,a.jsx)(n.h3,{id:"file-uploads",children:"File uploads"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-dart",children:"router.post('/upload', (ctx) async {\n  final upload = await ctx.formFile('document');\n  if (upload != null) {\n    await ctx.saveUploadedFile(upload, 'uploads/${upload.filename}');\n  }\n\n  return ctx.json({\n    'filename': upload?.filename,\n    'size': upload?.size,\n    'contentType': upload?.contentType,\n  });\n});\n"})}),"\n",(0,a.jsxs)(n.p,{children:["Configure size and extension limits via ",(0,a.jsx)(n.code,{children:"EngineConfig.multipart"})," or the ",(0,a.jsx)(n.code,{children:"withMultipart"})," option:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-dart",children:"final engine = Engine(\n  config: EngineConfig(\n    multipart: MultipartConfig(\n      maxFileSize: 10 * 1024 * 1024,\n      maxMemory: 32 * 1024 * 1024,\n      allowedExtensions: {'.jpg', '.png', '.pdf'},\n    ),\n  ),\n);\n"})}),"\n",(0,a.jsxs)(n.p,{children:["If you prefer configuration files, describe the same limits under ",(0,a.jsx)(n.code,{children:"uploads.*"})," so the uploads provider applies them:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",metastring:'title="config/http.yaml"',children:"uploads:\n  max_memory: 33554432         # bytes\n  max_file_size: 10485760\n  allowed_extensions: ['jpg', 'png', 'pdf']\n  directory: uploads\n  file_permissions: 493        # 0755\n"})}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.code,{children:"routed.uploads"}),' validates these values (types; for extensions use ".ext" in code and "ext" in config \u2014 Routed normalizes both) and feeds them into ',(0,a.jsx)(n.code,{children:"EngineConfig"}),". Run ",(0,a.jsx)(n.code,{children:"dart run routed provider:list --config"})," to review the effective settings and catch malformed overrides."]}),"\n",(0,a.jsx)(n.h2,{id:"json-and-raw-bodies",children:"JSON and raw bodies"}),"\n",(0,a.jsx)(n.p,{children:"Use the binding helpers when you want to map JSON to a map or object:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-dart",children:"router.post('/api/users', (ctx) async {\n  final payload = <String, dynamic>{};\n  await ctx.bindJSON(payload); // or ctx.bind(payload) for auto detection\n\n  // Optionally validate fields after binding\n  await ctx.shouldBind(payload);\n\n  return ctx.json({'received': payload});\n});\n"})}),"\n",(0,a.jsx)(n.p,{children:"Or access the body directly from the request. For large payloads, prefer streaming over buffering the entire body:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-dart",children:"router.post('/raw', (ctx) async {\n  final text = await ctx.request.body();      // UTF-8 string\n  final bytes = await ctx.request.bytes;      // Uint8List\n\n  return ctx.data('text/plain', text.codeUnits);\n});\n"})}),"\n",(0,a.jsx)(n.h2,{id:"request-metadata",children:"Request metadata"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-dart",children:"router.get('/info', (ctx) {\n  final method = ctx.request.method;\n  final uri = ctx.request.uri;\n  final clientIP = ctx.request.clientIP;\n  final userAgent = ctx.requestHeader('User-Agent');\n  final headers = ctx.request.headers;\n\n  return ctx.json({\n    'method': method,\n    'uri': uri.toString(),\n    'clientIP': clientIP,\n    'userAgent': userAgent,\n    'headers': headers.value('accept'),\n  });\n});\n"})}),"\n",(0,a.jsx)(n.h2,{id:"trusted-proxies",children:"Trusted proxies"}),"\n",(0,a.jsxs)(n.p,{children:["If your app runs behind a proxy/load balancer, enable proxy support so ",(0,a.jsx)(n.code,{children:"clientIP"})," honors trusted forwarding headers:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-dart",children:"final engine = Engine(\n  config: EngineConfig(\n    features: const EngineFeatures(enableProxySupport: true),\n    forwardedByClientIP: true,\n    remoteIPHeaders: ['X-Forwarded-For', 'X-Real-IP'],\n  ),\n  options: [withTrustedProxies(['10.0.0.0/8'])],\n);\n"})}),"\n",(0,a.jsx)(n.p,{children:"The security provider exposes the same knobs via configuration:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",metastring:'title="config/http.yaml"',children:"security:\n  trusted_proxies:\n    enabled: true\n    forward_client_ip: true\n    proxies: ['10.0.0.0/8', '::/0']\n    headers: ['X-Forwarded-For', 'X-Real-IP']\n    platform_header: CF-Connecting-IP\n"})}),"\n",(0,a.jsxs)(n.p,{children:["Validation occurs during boot\u2014invalid proxies or header lists trigger a ",(0,a.jsx)(n.code,{children:"ProviderConfigException"}),". Check the CLI output (",(0,a.jsx)(n.code,{children:"provider:list --config"}),") to verify your proxy settings."]}),"\n",(0,a.jsxs)(n.p,{children:["See ",(0,a.jsx)(n.a,{href:"/docs/routed/security/proxy",children:"proxy support"})," for more details."]})]})}function u(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(c,{...e})}):c(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>i,x:()=>d});var t=r(6540);const a={},s=t.createContext(a);function i(e){const n=t.useContext(s);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:i(e.components),t.createElement(s.Provider,{value:n},e.children)}}}]);