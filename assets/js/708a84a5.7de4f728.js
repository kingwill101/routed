"use strict";(globalThis.webpackChunkrouted=globalThis.webpackChunkrouted||[]).push([[4429],{7716:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>d,contentTitle:()=>o,default:()=>h,frontMatter:()=>a,metadata:()=>r,toc:()=>l});const r=JSON.parse('{"id":"tutorial","title":"Tutorial: Build a Contacts App","description":"Build a full-stack Contacts app with dart:io, Inertia.js, React, and Vite -- no framework required","source":"@site/docs/inertia_dart/tutorial.mdx","sourceDirName":".","slug":"/tutorial","permalink":"/docs/inertia_dart/tutorial","draft":false,"unlisted":false,"editUrl":"https://github.com/kingwill101/routed/tree/main/docs/docs/inertia_dart/tutorial.mdx","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"title":"Tutorial: Build a Contacts App","description":"Build a full-stack Contacts app with dart:io, Inertia.js, React, and Vite -- no framework required","sidebar_position":1},"sidebar":"inertiaDartSidebar","previous":{"title":"Inertia Dart","permalink":"/docs/inertia_dart/"}}');var s=n(4848),i=n(8453);const a={title:"Tutorial: Build a Contacts App",description:"Build a full-stack Contacts app with dart:io, Inertia.js, React, and Vite -- no framework required",sidebar_position:1},o="Tutorial: Build a Contacts App",d={},l=[{value:"1. Create the project",id:"1-create-the-project",level:2},{value:"2. Scaffold the React client",id:"2-scaffold-the-react-client",level:2},{value:"3. Project structure",id:"3-project-structure",level:2},{value:"4. Configure Vite",id:"4-configure-vite",level:2},{value:"5. Write the server",id:"5-write-the-server",level:2},{value:"Walkthrough",id:"walkthrough",level:3},{value:"6. Update the entry point",id:"6-update-the-entry-point",level:2},{value:"7. Build the React pages",id:"7-build-the-react-pages",level:2},{value:"Client entry",id:"client-entry",level:3},{value:"Home page",id:"home-page",level:3},{value:"Contacts page",id:"contacts-page",level:3},{value:"8. Build and run",id:"8-build-and-run",level:2},{value:"Development",id:"development",level:3},{value:"Production",id:"production",level:3},{value:"Compiling a native binary",id:"compiling-a-native-binary",level:3},{value:"Deploying",id:"deploying",level:3},{value:"9. How it works",id:"9-how-it-works",level:2},{value:"The key types",id:"the-key-types",level:3},{value:"10. Prop helpers",id:"10-prop-helpers",level:2},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Manifest entry key mismatch",id:"manifest-entry-key-mismatch",level:3},{value:"Stale hot file",id:"stale-hot-file",level:3},{value:"Assets 404 in production",id:"assets-404-in-production",level:3},{value:"DELETE returns 302 instead of 303",id:"delete-returns-302-instead-of-303",level:3},{value:"Next steps",id:"next-steps",level:2}];function c(e){const t={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.header,{children:(0,s.jsx)(t.h1,{id:"tutorial-build-a-contacts-app",children:"Tutorial: Build a Contacts App"})}),"\n",(0,s.jsxs)(t.p,{children:["This tutorial walks you through building a server-driven Contacts application\nusing ",(0,s.jsxs)(t.strong,{children:[(0,s.jsx)(t.code,{children:"dart:io"})," HttpServer"]}),", ",(0,s.jsx)(t.strong,{children:"inertia_dart"}),", ",(0,s.jsx)(t.strong,{children:"React"}),", and ",(0,s.jsx)(t.strong,{children:"Vite"}),". No\nweb framework required -- just the Dart standard library and the Inertia\nprotocol."]}),"\n",(0,s.jsx)(t.p,{children:"You will create a two-page app -- a home page and a contacts list with add and\ndelete -- to see how the Inertia protocol works at the lowest level."}),"\n",(0,s.jsx)(t.p,{children:"By the end you will have:"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:["A ",(0,s.jsx)(t.code,{children:"dart:io"})," HTTP server that speaks the Inertia protocol"]}),"\n",(0,s.jsx)(t.li,{children:"A React frontend scaffolded with Vite"}),"\n",(0,s.jsx)(t.li,{children:"Automatic dev/production asset switching via the hot file bridge"}),"\n",(0,s.jsxs)(t.li,{children:["An understanding of how ",(0,s.jsx)(t.code,{children:"InertiaRequest"}),", ",(0,s.jsx)(t.code,{children:"PropertyContext"}),", and ",(0,s.jsx)(t.code,{children:"InertiaResponseFactory"})," fit together"]}),"\n"]}),"\n",(0,s.jsx)(t.h2,{id:"1-create-the-project",children:"1. Create the project"}),"\n",(0,s.jsxs)(t.p,{children:["Create a new Dart project and add ",(0,s.jsx)(t.code,{children:"inertia_dart"}),":"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-bash",children:"mkdir contacts_app && cd contacts_app\ndart create -t console .\ndart pub add inertia_dart\n"})}),"\n",(0,s.jsx)(t.h2,{id:"2-scaffold-the-react-client",children:"2. Scaffold the React client"}),"\n",(0,s.jsxs)(t.p,{children:["Use the ",(0,s.jsx)(t.code,{children:"inertia_dart"})," CLI to generate a Vite + React client:"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-bash",children:"dart run inertia_dart:inertia create client --framework react --package-manager npm\n"})}),"\n",(0,s.jsxs)(t.p,{children:["This creates a ",(0,s.jsx)(t.code,{children:"client/"})," directory with a Vite project, React, and the Inertia\nclient adapter pre-installed."]}),"\n",(0,s.jsx)(t.p,{children:"Install the client dependencies:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-bash",children:"cd client && npm install && cd ..\n"})}),"\n",(0,s.jsx)(t.h2,{id:"3-project-structure",children:"3. Project structure"}),"\n",(0,s.jsx)(t.p,{children:"After setup, the project looks like this:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-text",children:"contacts_app/\n  bin/\n    contacts_app.dart       # Entry point (generated by dart create)\n  lib/\n    contacts_app.dart       # Server logic (we will rewrite this)\n  client/\n    src/\n      main.jsx              # Inertia client entry\n      ssr.jsx               # SSR entry (generated, not used here)\n      Pages/\n        Home.jsx            # Home page (generated)\n    index.html              # Vite HTML entry\n    vite.config.js          # Vite config\n    inertia_hot_file.js     # Hot file bridge plugin\n    package.json\n  pubspec.yaml\n"})}),"\n",(0,s.jsx)(t.h2,{id:"4-configure-vite",children:"4. Configure Vite"}),"\n",(0,s.jsxs)(t.p,{children:["The scaffolded ",(0,s.jsx)(t.code,{children:"vite.config.js"})," should already include the ",(0,s.jsx)(t.code,{children:"inertiaHotFile"}),"\nplugin. Verify it looks like this:"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-js",metastring:'title="client/vite.config.js"',children:"import { defineConfig } from 'vite'\nimport react from '@vitejs/plugin-react'\nimport { inertiaHotFile } from './inertia_hot_file.js'\n\nexport default defineConfig({\n  plugins: [react(), inertiaHotFile()],\n  server: {\n    port: 5173,\n    strictPort: true,\n  },\n  build: {\n    outDir: 'dist',\n    assetsDir: 'assets',\n    manifest: true,\n  },\n})\n"})}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:(0,s.jsx)(t.code,{children:"manifest: true"})})," generates ",(0,s.jsx)(t.code,{children:".vite/manifest.json"})," mapping source entries to\nhashed filenames for production."]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:(0,s.jsx)(t.code,{children:"inertiaHotFile()"})})," writes ",(0,s.jsx)(t.code,{children:"public/hot"})," when the dev server starts\n(containing the dev server URL like ",(0,s.jsx)(t.code,{children:"http://localhost:5173"}),") and deletes it on\nshutdown. The Dart server reads this file to decide between dev and production\nmode."]}),"\n"]}),"\n",(0,s.jsx)(t.h2,{id:"5-write-the-server",children:"5. Write the server"}),"\n",(0,s.jsxs)(t.p,{children:["Replace the contents of ",(0,s.jsx)(t.code,{children:"lib/contacts_app.dart"})," with the full server. We will\nwalk through each piece below."]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-dart",metastring:'title="lib/contacts_app.dart"',children:"import 'dart:convert';\nimport 'dart:io';\n\nimport 'package:inertia_dart/inertia_dart.dart';\n\n// ---------------------------------------------------------------------------\n// In-memory contact store\n// ---------------------------------------------------------------------------\n\nclass ContactStore {\n  int _nextId = 4;\n  final List<Map<String, dynamic>> _contacts = [\n    {'id': 1, 'name': 'Ada Lovelace', 'email': 'ada@example.com'},\n    {'id': 2, 'name': 'Grace Hopper', 'email': 'grace@example.com'},\n    {'id': 3, 'name': 'Alan Turing', 'email': 'alan@example.com'},\n  ];\n\n  List<Map<String, dynamic>> all() =>\n      _contacts.map((c) => Map<String, dynamic>.from(c)).toList();\n\n  void add(String name, String email) {\n    _contacts.add({'id': _nextId++, 'name': name, 'email': email});\n  }\n\n  void remove(int id) {\n    _contacts.removeWhere((c) => c['id'] == id);\n  }\n}\n\n// ---------------------------------------------------------------------------\n// Server\n// ---------------------------------------------------------------------------\n\nconst String _version = 'dev';\nconst String _clientEntry = 'index.html';\nconst String _manifestPath = 'client/dist/.vite/manifest.json';\nconst String _hotFile = 'client/public/hot';\n\nFuture<void> serve({String address = '127.0.0.1', int port = 8080}) async {\n  final store = ContactStore();\n  final server = await HttpServer.bind(address, port);\n  stdout.writeln('Contacts app listening on http://$address:$port');\n\n  await for (final httpRequest in server) {\n    try {\n      await _handleRequest(httpRequest, store);\n    } catch (e, st) {\n      stderr.writeln('Error handling ${httpRequest.uri}: $e\\n$st');\n      httpRequest.response.statusCode = HttpStatus.internalServerError;\n      httpRequest.response.write('Internal Server Error');\n      await httpRequest.response.close();\n    }\n  }\n}\n\nFuture<void> _handleRequest(HttpRequest httpRequest, ContactStore store) async {\n  // Serve static assets first\n  if (await _tryServeStatic(httpRequest)) return;\n\n  final method = httpRequest.method;\n  final path = httpRequest.uri.path;\n\n  // Parse the Inertia request\n  final request = inertiaRequestFromHttp(httpRequest);\n  final context = request.createContext();\n\n  // Route: GET /\n  if (method == 'GET' && path == '/') {\n    final page = await InertiaResponseFactory().buildPageDataAsync(\n      component: 'Home',\n      props: {'title': 'Contacts App', 'subtitle': 'inertia_dart + dart:io'},\n      url: _requestUrl(httpRequest.uri),\n      context: context,\n      version: _version,\n    );\n    await _respond(httpRequest, request, page);\n    return;\n  }\n\n  // Route: GET /contacts\n  if (method == 'GET' && path == '/contacts') {\n    final page = await InertiaResponseFactory().buildPageDataAsync(\n      component: 'Contacts',\n      props: {'title': 'Contacts', 'contacts': store.all()},\n      url: _requestUrl(httpRequest.uri),\n      context: context,\n      version: _version,\n    );\n    await _respond(httpRequest, request, page);\n    return;\n  }\n\n  // Route: POST /contacts\n  if (method == 'POST' && path == '/contacts') {\n    final body = await _readJsonBody(httpRequest);\n    final name = (body['name'] as String?)?.trim() ?? '';\n    final email = (body['email'] as String?)?.trim() ?? '';\n    if (name.isNotEmpty && email.isNotEmpty) {\n      store.add(name, email);\n    }\n    _redirect(httpRequest, '/contacts');\n    return;\n  }\n\n  // Route: DELETE /contacts/{id}\n  final deleteMatch = RegExp(r'^/contacts/(\\d+)$').firstMatch(path);\n  if (method == 'DELETE' && deleteMatch != null) {\n    final id = int.parse(deleteMatch.group(1)!);\n    store.remove(id);\n    // Rewrite 302 -> 303 for DELETE (Inertia protocol requirement)\n    _redirect(httpRequest, '/contacts', status: HttpStatus.seeOther);\n    return;\n  }\n\n  // 404\n  httpRequest.response.statusCode = HttpStatus.notFound;\n  httpRequest.response.write('Not Found');\n  await httpRequest.response.close();\n}\n\n// ---------------------------------------------------------------------------\n// Response helpers\n// ---------------------------------------------------------------------------\n\n/// Sends an Inertia JSON response for XHR visits, or a full HTML page for\n/// initial loads.\nFuture<void> _respond(\n  HttpRequest httpRequest,\n  InertiaRequest request,\n  PageData page,\n) async {\n  if (request.isInertia) {\n    await writeInertiaResponse(httpRequest.response, InertiaResponse.json(page));\n    return;\n  }\n\n  final html = await _renderHtml(page);\n  await writeInertiaResponse(\n    httpRequest.response,\n    InertiaResponse.html(page, html),\n  );\n}\n\n/// Redirects. For PUT/PATCH/DELETE, Inertia requires 303 so the browser\n/// follows the redirect as GET.\nvoid _redirect(\n  HttpRequest httpRequest,\n  String location, {\n  int status = HttpStatus.found,\n}) {\n  httpRequest.response.statusCode = status;\n  httpRequest.response.headers.set(HttpHeaders.locationHeader, location);\n  httpRequest.response.close();\n}\n\n/// Reads a JSON request body into a Map.\nFuture<Map<String, dynamic>> _readJsonBody(HttpRequest request) async {\n  final raw = await utf8.decoder.bind(request).join();\n  if (raw.isEmpty) return {};\n  try {\n    return jsonDecode(raw) as Map<String, dynamic>;\n  } catch (_) {\n    return {};\n  }\n}\n\n// ---------------------------------------------------------------------------\n// HTML rendering\n// ---------------------------------------------------------------------------\n\n/// Renders the HTML shell with Vite asset tags and the Inertia page object.\nFuture<String> _renderHtml(PageData page) async {\n  final assets = InertiaViteAssets(\n    entry: _clientEntry,\n    manifestPath: _manifestPath,\n    hotFile: _hotFile,\n    includeReactRefresh: true,\n  );\n  final tags = await assets.resolve();\n  final pageJson = jsonEncode(page.toJson());\n  final escaped = escapeInertiaHtml(pageJson);\n\n  return '''<!doctype html>\n<html lang=\"en\">\n  <head>\n    <meta charset=\"utf-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\n    <title>Contacts App</title>\n    ${tags.renderStyles()}\n  </head>\n  <body>\n    <div id=\"app\" data-page=\"$escaped\"></div>\n    ${tags.renderScripts()}\n  </body>\n</html>\n''';\n}\n\n// ---------------------------------------------------------------------------\n// Static file serving\n// ---------------------------------------------------------------------------\n\n/// Serves production assets from client/dist/assets/.\nFuture<bool> _tryServeStatic(HttpRequest request) async {\n  if (request.method != 'GET' && request.method != 'HEAD') return false;\n  final path = request.uri.path;\n  if (!path.startsWith('/assets/')) return false;\n\n  final relative = path.startsWith('/') ? path.substring(1) : path;\n  final file = File('client/dist/$relative');\n  if (!file.existsSync()) return false;\n\n  request.response.headers.contentType = _contentTypeForPath(path);\n  await request.response.addStream(file.openRead());\n  await request.response.close();\n  return true;\n}\n\nContentType _contentTypeForPath(String path) {\n  if (path.endsWith('.js')) return ContentType('application', 'javascript');\n  if (path.endsWith('.css')) return ContentType('text', 'css');\n  if (path.endsWith('.svg')) return ContentType('image', 'svg+xml');\n  if (path.endsWith('.png')) return ContentType('image', 'png');\n  if (path.endsWith('.woff2')) return ContentType('font', 'woff2');\n  return ContentType.binary;\n}\n\nString _requestUrl(Uri uri) {\n  final path = uri.path.isEmpty ? '/' : uri.path;\n  return uri.hasQuery ? '$path?${uri.query}' : path;\n}\n"})}),"\n",(0,s.jsx)(t.h3,{id:"walkthrough",children:"Walkthrough"}),"\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.strong,{children:"Contact store"})," -- a simple in-memory list. In a real app, replace this with\na database."]}),"\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.strong,{children:"Request handling"})," -- each route does four things:"]}),"\n",(0,s.jsxs)(t.ol,{children:["\n",(0,s.jsxs)(t.li,{children:["Parse the HTTP request with ",(0,s.jsx)(t.code,{children:"inertiaRequestFromHttp(httpRequest)"})," to get an ",(0,s.jsx)(t.code,{children:"InertiaRequest"})]}),"\n",(0,s.jsxs)(t.li,{children:["Build a ",(0,s.jsx)(t.code,{children:"PropertyContext"})," with ",(0,s.jsx)(t.code,{children:"request.createContext()"})," -- this reads Inertia headers for partial reloads, deferred groups, etc."]}),"\n",(0,s.jsxs)(t.li,{children:["Build the page data with ",(0,s.jsx)(t.code,{children:"InertiaResponseFactory().buildPageDataAsync()"})," -- this resolves props through the property helpers"]}),"\n",(0,s.jsxs)(t.li,{children:["Return either JSON (for Inertia XHR visits) or HTML (for initial page loads) using ",(0,s.jsx)(t.code,{children:"writeInertiaResponse()"})]}),"\n"]}),"\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.strong,{children:"Redirect rewriting"})," -- the Inertia protocol requires 303 (See Other) instead\nof 302 for DELETE/PUT/PATCH so the browser follows the redirect as GET. We\nhandle this manually here; the Routed framework does it automatically via\nmiddleware."]}),"\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.strong,{children:"HTML rendering"})," -- ",(0,s.jsx)(t.code,{children:"InertiaViteAssets"})," reads the hot file (dev mode) or the\nVite manifest (production) and generates the correct ",(0,s.jsx)(t.code,{children:"<script>"})," and ",(0,s.jsx)(t.code,{children:"<link>"}),"\ntags. The ",(0,s.jsx)(t.code,{children:"data-page"})," attribute contains the Inertia page object as\nHTML-escaped JSON, which the React client reads to hydrate the app."]}),"\n",(0,s.jsx)(t.h2,{id:"6-update-the-entry-point",children:"6. Update the entry point"}),"\n",(0,s.jsxs)(t.p,{children:["Replace ",(0,s.jsx)(t.code,{children:"bin/contacts_app.dart"}),":"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-dart",metastring:'title="bin/contacts_app.dart"',children:"import 'dart:io';\n\nimport 'package:contacts_app/contacts_app.dart' as app;\n\nFuture<void> main(List<String> args) async {\n  final host = Platform.environment['HOST'] ?? '127.0.0.1';\n  final port = int.tryParse(Platform.environment['PORT'] ?? '8080') ?? 8080;\n  await app.serve(address: host, port: port);\n}\n"})}),"\n",(0,s.jsx)(t.h2,{id:"7-build-the-react-pages",children:"7. Build the React pages"}),"\n",(0,s.jsx)(t.h3,{id:"client-entry",children:"Client entry"}),"\n",(0,s.jsxs)(t.p,{children:["The scaffolded ",(0,s.jsx)(t.code,{children:"client/src/main.jsx"})," should already bootstrap Inertia. Verify\nit looks like this:"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-jsx",metastring:'title="client/src/main.jsx"',children:"import { createInertiaApp } from '@inertiajs/react'\nimport { createRoot } from 'react-dom/client'\nimport './index.css'\n\ncreateInertiaApp({\n  resolve: (name) => {\n    const pages = import.meta.glob('./Pages/**/*.jsx', { eager: true })\n    return pages[`./Pages/${name}.jsx`]\n  },\n  setup({ el, App, props }) {\n    createRoot(el).render(<App {...props} />)\n  },\n})\n"})}),"\n",(0,s.jsx)(t.h3,{id:"home-page",children:"Home page"}),"\n",(0,s.jsxs)(t.p,{children:["Update ",(0,s.jsx)(t.code,{children:"client/src/Pages/Home.jsx"}),":"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-jsx",metastring:'title="client/src/Pages/Home.jsx"',children:"import { Link } from '@inertiajs/react'\n\nexport default function Home({ title = 'Contacts App', subtitle }) {\n  return (\n    <main style={{ padding: '2rem', fontFamily: 'system-ui, sans-serif',\n                    maxWidth: 600, margin: '0 auto' }}>\n      <nav style={{ marginBottom: '1.5rem' }}>\n        <Link href=\"/\">Home</Link>\n        <Link href=\"/contacts\" style={{ marginLeft: '1rem' }}>Contacts</Link>\n      </nav>\n\n      <h1>{title}</h1>\n      {subtitle && <p style={{ color: '#888' }}>{subtitle}</p>}\n      <p>\n        This app uses <code>inertia_dart</code> with a plain{' '}\n        <code>dart:io</code> HttpServer. No framework required.\n      </p>\n    </main>\n  )\n}\n"})}),"\n",(0,s.jsx)(t.h3,{id:"contacts-page",children:"Contacts page"}),"\n",(0,s.jsxs)(t.p,{children:["Create ",(0,s.jsx)(t.code,{children:"client/src/Pages/Contacts.jsx"}),":"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-jsx",metastring:'title="client/src/Pages/Contacts.jsx"',children:"import { Link, useForm, router } from '@inertiajs/react'\n\nexport default function Contacts({ title = 'Contacts', contacts = [] }) {\n  const { data, setData, post, processing, reset } = useForm({\n    name: '',\n    email: '',\n  })\n\n  const addContact = (e) => {\n    e.preventDefault()\n    if (!data.name.trim() || !data.email.trim()) return\n    post('/contacts', {\n      onSuccess: () => reset(),\n    })\n  }\n\n  const removeContact = (id) => {\n    router.delete(`/contacts/${id}`)\n  }\n\n  return (\n    <main style={{ padding: '2rem', fontFamily: 'system-ui, sans-serif',\n                    maxWidth: 600, margin: '0 auto' }}>\n      <nav style={{ marginBottom: '1.5rem' }}>\n        <Link href=\"/\">Home</Link>\n        <Link href=\"/contacts\" style={{ marginLeft: '1rem' }}>Contacts</Link>\n      </nav>\n\n      <h1>{title}</h1>\n      <p style={{ color: '#888' }}>{contacts.length} contact{contacts.length !== 1 ? 's' : ''}</p>\n\n      <form onSubmit={addContact}\n            style={{ display: 'flex', flexDirection: 'column', gap: '0.5rem',\n                     marginBottom: '1.5rem' }}>\n        <div style={{ display: 'flex', gap: '0.5rem' }}>\n          <input\n            type=\"text\"\n            value={data.name}\n            onChange={(e) => setData('name', e.target.value)}\n            placeholder=\"Name\"\n            disabled={processing}\n            style={{ flex: 1, padding: '0.6em 1em', borderRadius: 8,\n                     border: '1px solid #444', background: 'transparent',\n                     color: 'inherit', fontSize: '1em' }}\n          />\n          <input\n            type=\"email\"\n            value={data.email}\n            onChange={(e) => setData('email', e.target.value)}\n            placeholder=\"Email\"\n            disabled={processing}\n            style={{ flex: 1, padding: '0.6em 1em', borderRadius: 8,\n                     border: '1px solid #444', background: 'transparent',\n                     color: 'inherit', fontSize: '1em' }}\n          />\n          <button type=\"submit\" disabled={processing}>Add</button>\n        </div>\n      </form>\n\n      <ul style={{ listStyle: 'none', padding: 0 }}>\n        {contacts.map((contact) => (\n          <li key={contact.id}\n              style={{ display: 'flex', alignItems: 'center', gap: '0.75rem',\n                       padding: '0.5rem 0', borderBottom: '1px solid #333' }}>\n            <span style={{ flex: 1 }}>\n              <strong>{contact.name}</strong>\n              <span style={{ color: '#888', marginLeft: '0.5rem' }}>\n                {contact.email}\n              </span>\n            </span>\n            <button onClick={() => removeContact(contact.id)}\n                    style={{ padding: '0.3em 0.6em', fontSize: '0.85em' }}>\n              Remove\n            </button>\n          </li>\n        ))}\n      </ul>\n\n      {contacts.length === 0 && (\n        <p style={{ textAlign: 'center', color: '#666', marginTop: '2rem' }}>\n          No contacts yet. Add one above!\n        </p>\n      )}\n    </main>\n  )\n}\n"})}),"\n",(0,s.jsx)(t.p,{children:"Key patterns:"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:(0,s.jsx)(t.code,{children:"useForm"})})," manages form state. ",(0,s.jsx)(t.code,{children:"post('/contacts', ...)"})," sends a POST with\nJSON body. On success, ",(0,s.jsx)(t.code,{children:"reset()"})," clears both fields."]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:(0,s.jsx)(t.code,{children:"router.delete"})})," sends a DELETE visit. The server removes the contact and\nredirects back to ",(0,s.jsx)(t.code,{children:"/contacts"}),". Inertia follows the redirect and re-renders\nwith fresh data."]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"No client-side state for the contacts list."})," The ",(0,s.jsx)(t.code,{children:"contacts"})," array comes\nfrom the server as a prop on every render."]}),"\n"]}),"\n",(0,s.jsx)(t.h2,{id:"8-build-and-run",children:"8. Build and run"}),"\n",(0,s.jsx)(t.h3,{id:"development",children:"Development"}),"\n",(0,s.jsx)(t.p,{children:"Run both servers for hot module replacement:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-bash",children:"# Terminal 1 -- Vite dev server\ncd client && npm run dev\n\n# Terminal 2 -- Dart server\ndart run bin/contacts_app.dart\n"})}),"\n",(0,s.jsxs)(t.p,{children:["When Vite starts, the ",(0,s.jsx)(t.code,{children:"inertiaHotFile"})," plugin writes ",(0,s.jsx)(t.code,{children:"client/public/hot"})," with\nthe dev server URL. ",(0,s.jsx)(t.code,{children:"InertiaViteAssets"})," reads this file and emits ",(0,s.jsx)(t.code,{children:"<script>"}),"\ntags pointing to Vite instead of the production manifest. Changes to ",(0,s.jsx)(t.code,{children:".jsx"}),"\nfiles appear instantly."]}),"\n",(0,s.jsx)(t.h3,{id:"production",children:"Production"}),"\n",(0,s.jsx)(t.p,{children:"Build the client, remove the hot file, and start the server:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-bash",children:"cd client && npm run build && cd ..\nrm -f client/public/hot\ndart run bin/contacts_app.dart\n"})}),"\n",(0,s.jsxs)(t.p,{children:["Visit ",(0,s.jsx)(t.a,{href:"http://127.0.0.1:8080/",children:"http://127.0.0.1:8080/"}),". The server reads the\nVite manifest at ",(0,s.jsx)(t.code,{children:"client/dist/.vite/manifest.json"})," and serves hashed assets from\n",(0,s.jsx)(t.code,{children:"client/dist/assets/"}),"."]}),"\n",(0,s.jsx)(t.h3,{id:"compiling-a-native-binary",children:"Compiling a native binary"}),"\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.code,{children:"dart run"})," starts a JIT-compiled process that takes several seconds to warm up.\nFor production, compile to a native binary:"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-bash",children:"dart compile exe bin/contacts_app.dart -o build/server\n"})}),"\n",(0,s.jsx)(t.p,{children:"The resulting binary starts instantly and needs no Dart SDK on the target\nmachine. Run it the same way:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-bash",children:"rm -f client/public/hot\nPORT=8080 ./build/server\n"})}),"\n",(0,s.jsx)(t.h3,{id:"deploying",children:"Deploying"}),"\n",(0,s.jsxs)(t.p,{children:["The server uses relative paths (",(0,s.jsx)(t.code,{children:"client/dist/.vite/manifest.json"}),",\n",(0,s.jsx)(t.code,{children:"client/dist/assets/"}),") so it must be started from a working directory that\ncontains the ",(0,s.jsx)(t.code,{children:"client/dist/"})," folder. A minimal deployment bundle looks like this:"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{children:"contacts_app/\n  server                              # compiled binary\n  client/\n    dist/\n      .vite/manifest.json             # Vite manifest\n      assets/\n        index-DQ3P1g1z.css            # hashed CSS\n        index-Dw6mcTQA.js             # hashed JS\n"})}),"\n",(0,s.jsx)(t.p,{children:"To build that bundle:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-bash",children:"# 1. Build the client\ncd client && npm run build && cd ..\n\n# 2. Compile the server\ndart compile exe bin/contacts_app.dart -o build/server\n\n# 3. Assemble the deployment directory\nmkdir -p deploy/client\ncp build/server deploy/\ncp -r client/dist deploy/client/\n\n# 4. Remove the hot file (if present)\nrm -f deploy/client/public/hot\n"})}),"\n",(0,s.jsx)(t.p,{children:"On the target machine, start the server from the deployment directory:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-bash",children:"cd deploy\nHOST=0.0.0.0 PORT=8080 ./server\n"})}),"\n",(0,s.jsxs)(t.p,{children:["The ",(0,s.jsx)(t.code,{children:"HOST"})," and ",(0,s.jsx)(t.code,{children:"PORT"})," environment variables are read by ",(0,s.jsx)(t.code,{children:"bin/contacts_app.dart"}),".\nSet ",(0,s.jsx)(t.code,{children:"HOST=0.0.0.0"})," to accept connections from outside localhost."]}),"\n",(0,s.jsx)(t.h2,{id:"9-how-it-works",children:"9. How it works"}),"\n",(0,s.jsx)(t.p,{children:"The request lifecycle at the protocol level:"}),"\n",(0,s.jsxs)(t.ol,{children:["\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.strong,{children:"First visit"})," -- the browser sends a normal GET to ",(0,s.jsx)(t.code,{children:"/contacts"}),". The server\nbuilds the page object (",(0,s.jsx)(t.code,{children:'{component: "Contacts", props: {...}, url: "/contacts", version: "dev"}'}),")\nand wraps it in an HTML shell with the page JSON in ",(0,s.jsx)(t.code,{children:"data-page"}),". React\nhydrates from this attribute."]}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.strong,{children:"Client-side navigation"})," -- clicking a ",(0,s.jsx)(t.code,{children:"<Link>"})," sends an XHR with\n",(0,s.jsx)(t.code,{children:"X-Inertia: true"}),". The server detects ",(0,s.jsx)(t.code,{children:"request.isInertia == true"})," and\nreturns the page object as JSON (no HTML shell). The Inertia client swaps\nthe component without a full page reload."]}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.strong,{children:"Form submission"})," -- ",(0,s.jsx)(t.code,{children:"useForm.post()"})," sends an XHR POST with JSON body.\nThe server processes it, calls ",(0,s.jsx)(t.code,{children:"_redirect('/contacts')"}),", and returns a 302.\nInertia follows the redirect, receives fresh props, and re-renders."]}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.strong,{children:"DELETE with 303"})," -- ",(0,s.jsx)(t.code,{children:"router.delete()"})," sends an XHR DELETE. The server\nredirects with 303 (not 302) so the browser follows as GET. This is an\nInertia protocol requirement for non-GET methods."]}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.strong,{children:"Version checking"})," -- on Inertia visits, the client sends\n",(0,s.jsx)(t.code,{children:"X-Inertia-Version"}),". If the server's version differs (e.g. after a deploy),\nit can respond with 409 to force a full page reload. This tutorial uses a\nstatic version string, but in production you would derive it from your asset\nhash."]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(t.h3,{id:"the-key-types",children:"The key types"}),"\n",(0,s.jsxs)(t.table,{children:[(0,s.jsx)(t.thead,{children:(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.th,{children:"Type"}),(0,s.jsx)(t.th,{children:"Role"})]})}),(0,s.jsxs)(t.tbody,{children:[(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:(0,s.jsx)(t.code,{children:"inertiaRequestFromHttp()"})}),(0,s.jsxs)(t.td,{children:["Extracts headers from ",(0,s.jsx)(t.code,{children:"dart:io"})," ",(0,s.jsx)(t.code,{children:"HttpRequest"})," into an ",(0,s.jsx)(t.code,{children:"InertiaRequest"})]})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:(0,s.jsx)(t.code,{children:"InertiaRequest"})}),(0,s.jsxs)(t.td,{children:["Parsed request wrapper. Exposes ",(0,s.jsx)(t.code,{children:"isInertia"}),", ",(0,s.jsx)(t.code,{children:"version"}),", ",(0,s.jsx)(t.code,{children:"partialData"}),", etc."]})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:(0,s.jsx)(t.code,{children:"InertiaRequest.createContext()"})}),(0,s.jsxs)(t.td,{children:["Builds a ",(0,s.jsx)(t.code,{children:"PropertyContext"})," from the request headers"]})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:(0,s.jsx)(t.code,{children:"PropertyContext"})}),(0,s.jsx)(t.td,{children:"Decides which props resolve (partial reloads, deferred groups, once-prop exclusions)"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:(0,s.jsx)(t.code,{children:"InertiaResponseFactory"})}),(0,s.jsxs)(t.td,{children:["Resolves props through property helpers and builds a ",(0,s.jsx)(t.code,{children:"PageData"})," object"]})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:(0,s.jsx)(t.code,{children:"PageData"})}),(0,s.jsx)(t.td,{children:"The Inertia page object: component name, resolved props, URL, version"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:(0,s.jsx)(t.code,{children:"InertiaResponse.json()"})}),(0,s.jsx)(t.td,{children:"JSON response for XHR visits"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:(0,s.jsx)(t.code,{children:"InertiaResponse.html()"})}),(0,s.jsx)(t.td,{children:"HTML response for initial page loads"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:(0,s.jsx)(t.code,{children:"writeInertiaResponse()"})}),(0,s.jsxs)(t.td,{children:["Writes an ",(0,s.jsx)(t.code,{children:"InertiaResponse"})," to a ",(0,s.jsx)(t.code,{children:"dart:io"})," ",(0,s.jsx)(t.code,{children:"HttpResponse"})]})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:(0,s.jsx)(t.code,{children:"InertiaViteAssets"})}),(0,s.jsx)(t.td,{children:"Resolves Vite asset tags (dev hot file or production manifest)"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:(0,s.jsx)(t.code,{children:"escapeInertiaHtml()"})}),(0,s.jsxs)(t.td,{children:["HTML-escapes JSON for safe embedding in ",(0,s.jsx)(t.code,{children:"data-page"})]})]})]})]}),"\n",(0,s.jsx)(t.h2,{id:"10-prop-helpers",children:"10. Prop helpers"}),"\n",(0,s.jsx)(t.p,{children:"The tutorial above uses plain values as props. For real apps, use prop helpers\nto control resolution:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-dart",children:"final page = await InertiaResponseFactory().buildPageDataAsync(\n  component: 'Contacts',\n  props: {\n    // Always included, even on partial reloads\n    'user': AlwaysProp(() => getCurrentUser()),\n\n    // Only resolved when the client requests it via partial reload\n    'auditLog': LazyProp(() => loadAuditLog()),\n\n    // Auto-fetched by the client after initial render\n    'recentActivity': DeferredProp(\n      () => loadRecentActivity(),\n      group: 'sidebar',\n    ),\n\n    // Merged into existing client state instead of replacing\n    'contacts': MergeProp(() => fetchContactsPage(page)),\n\n    // Standard props -- always included on initial visit\n    'title': 'Contacts',\n  },\n  url: '/contacts',\n  context: context,\n  version: _version,\n);\n"})}),"\n",(0,s.jsx)(t.p,{children:"On the client, trigger a partial reload to fetch lazy props:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-js",children:"// Fetch only the auditLog prop\nrouter.reload({ only: ['auditLog'] })\n"})}),"\n",(0,s.jsxs)(t.p,{children:["See the ",(0,s.jsx)(t.a,{href:"/docs/inertia_dart/#props",children:"prop helpers reference"})," for the full list."]}),"\n",(0,s.jsx)(t.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,s.jsx)(t.h3,{id:"manifest-entry-key-mismatch",children:"Manifest entry key mismatch"}),"\n",(0,s.jsxs)(t.p,{children:["The ",(0,s.jsx)(t.code,{children:"entry"})," value passed to ",(0,s.jsx)(t.code,{children:"InertiaViteAssets"})," must exactly match a key in the\nVite manifest at ",(0,s.jsx)(t.code,{children:"client/dist/.vite/manifest.json"}),". Vite 7 uses ",(0,s.jsx)(t.code,{children:'"index.html"'}),"\nas the entry key. If the key does not match, asset resolution silently fails and\npages load without CSS or JS."]}),"\n",(0,s.jsx)(t.p,{children:"Check your manifest after building:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-bash",children:"cat client/dist/.vite/manifest.json\n"})}),"\n",(0,s.jsx)(t.h3,{id:"stale-hot-file",children:"Stale hot file"}),"\n",(0,s.jsxs)(t.p,{children:["If you kill the Vite dev server without a clean shutdown, the ",(0,s.jsx)(t.code,{children:"client/public/hot"}),"\nfile persists. The Dart server will try to proxy assets to a dead dev server.\nDelete it before running in production:"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-bash",children:"rm -f client/public/hot\n"})}),"\n",(0,s.jsx)(t.h3,{id:"assets-404-in-production",children:"Assets 404 in production"}),"\n",(0,s.jsxs)(t.p,{children:["Make sure you built the client (",(0,s.jsx)(t.code,{children:"npm run build"})," in ",(0,s.jsx)(t.code,{children:"client/"}),") and that\n",(0,s.jsx)(t.code,{children:"_tryServeStatic"})," correctly maps ",(0,s.jsx)(t.code,{children:"/assets/"})," to ",(0,s.jsx)(t.code,{children:"client/dist/assets/"}),". Check\nthat the files exist:"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-bash",children:"ls client/dist/assets/\n"})}),"\n",(0,s.jsx)(t.h3,{id:"delete-returns-302-instead-of-303",children:"DELETE returns 302 instead of 303"}),"\n",(0,s.jsxs)(t.p,{children:["The Inertia protocol requires 303 for non-GET redirects. If you use 302 for\nDELETE/PUT/PATCH, some browsers will replay the original method on the redirect.\nAlways use ",(0,s.jsx)(t.code,{children:"HttpStatus.seeOther"})," (303) for mutation redirects."]}),"\n",(0,s.jsx)(t.h2,{id:"next-steps",children:"Next steps"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:["Read the ",(0,s.jsx)(t.a,{href:"/docs/inertia_dart/",children:"Inertia Dart reference"})," for the full API"]}),"\n",(0,s.jsxs)(t.li,{children:["See the ",(0,s.jsx)(t.a,{href:"/docs/routed_inertia/",children:"Routed Inertia integration"})," if you want a\nframework with config-driven providers, middleware, templates, and routing"]}),"\n",(0,s.jsxs)(t.li,{children:["Explore ",(0,s.jsx)(t.a,{href:"https://inertiajs.com",children:"Inertia.js docs"})," for client-side features\nlike shared data, remember state, and scroll management"]}),"\n"]})]})}function h(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},8453:(e,t,n)=>{n.d(t,{R:()=>a,x:()=>o});var r=n(6540);const s={},i=r.createContext(s);function a(e){const t=r.useContext(i);return r.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),r.createElement(i.Provider,{value:t},e.children)}}}]);