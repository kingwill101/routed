"use strict";(globalThis.webpackChunkrouted=globalThis.webpackChunkrouted||[]).push([[612],{6625:(e,r,t)=>{t.r(r),t.d(r,{assets:()=>c,contentTitle:()=>i,default:()=>a,frontMatter:()=>o,metadata:()=>s,toc:()=>l});const s=JSON.parse('{"id":"requests-responses","title":"Requests & Responses","description":"Turbo adds specific HTTP headers to requests to identify their origin (Drive navigation, Frame, or Stream). Routed Hotwire provides helpers to inspect these headers and send responses with the correct content types.","source":"@site/docs/routed_hotwire/requests-responses.mdx","sourceDirName":".","slug":"/requests-responses","permalink":"/docs/routed_hotwire/requests-responses","draft":false,"unlisted":false,"editUrl":"https://github.com/kingwill101/routed/tree/main/docs/docs/routed_hotwire/requests-responses.mdx","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"title":"Requests & Responses","sidebar_position":2},"sidebar":"routedHotwireSidebar","previous":{"title":"Turbo Streams","permalink":"/docs/routed_hotwire/turbo-streams"},"next":{"title":"WebSocket Hub","permalink":"/docs/routed_hotwire/websocket-hub"}}');var n=t(4848),d=t(8453);const o={title:"Requests & Responses",sidebar_position:2},i="Turbo Requests & Responses",c={},l=[{value:"Inspecting Requests",id:"inspecting-requests",level:2},{value:"<code>ctx.turbo</code>",id:"ctxturbo",level:3},{value:"<code>TurboRequestInfo</code> Properties",id:"turborequestinfo-properties",level:3},{value:"<code>TurboRequestKind</code>",id:"turborequestkind",level:3},{value:"Standalone Usage",id:"standalone-usage",level:3},{value:"Sending Responses",id:"sending-responses",level:2},{value:"Context Extension Methods",id:"context-extension-methods",level:3},{value:"Static Methods",id:"static-methods",level:3},{value:"Example: Form Submission with Validation",id:"example-form-submission-with-validation",level:3},{value:"Response Behavior",id:"response-behavior",level:3}];function h(e){const r={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,d.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(r.header,{children:(0,n.jsx)(r.h1,{id:"turbo-requests--responses",children:"Turbo Requests & Responses"})}),"\n",(0,n.jsx)(r.p,{children:"Turbo adds specific HTTP headers to requests to identify their origin (Drive navigation, Frame, or Stream). Routed Hotwire provides helpers to inspect these headers and send responses with the correct content types."}),"\n",(0,n.jsx)(r.h2,{id:"inspecting-requests",children:"Inspecting Requests"}),"\n",(0,n.jsx)(r.h3,{id:"ctxturbo",children:(0,n.jsx)(r.code,{children:"ctx.turbo"})}),"\n",(0,n.jsxs)(r.p,{children:["The ",(0,n.jsx)(r.code,{children:"TurboContextExtensions"})," extension adds a ",(0,n.jsx)(r.code,{children:"turbo"})," getter to ",(0,n.jsx)(r.code,{children:"EngineContext"})," that returns a ",(0,n.jsx)(r.code,{children:"TurboRequestInfo"})," object. The result is cached on the context so repeated access is free."]}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-dart",children:"engine.post('/comments', (ctx) async {\n  final info = ctx.turbo;\n\n  if (info.isStreamRequest) {\n    // Client accepts Turbo Stream \u2014 return a stream fragment\n    return ctx.turboStream(\n      turboStreamAppend(target: 'comments', html: '<p>New comment</p>'),\n    );\n  }\n\n  // Standard request \u2014 redirect back\n  return ctx.turboSeeOther('/posts/1');\n});\n"})}),"\n",(0,n.jsxs)(r.p,{children:["Accessing ",(0,n.jsx)(r.code,{children:"ctx.turbo"})," also enriches the request logger context with Hotwire metadata (",(0,n.jsx)(r.code,{children:"hotwire.kind"}),", ",(0,n.jsx)(r.code,{children:"hotwire.frame_id"}),", ",(0,n.jsx)(r.code,{children:"hotwire.stream_request"}),", etc.)."]}),"\n",(0,n.jsxs)(r.h3,{id:"turborequestinfo-properties",children:[(0,n.jsx)(r.code,{children:"TurboRequestInfo"})," Properties"]}),"\n",(0,n.jsxs)(r.table,{children:[(0,n.jsx)(r.thead,{children:(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.th,{children:"Property"}),(0,n.jsx)(r.th,{children:"Type"}),(0,n.jsx)(r.th,{children:"Description"})]})}),(0,n.jsxs)(r.tbody,{children:[(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"method"})}),(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"String"})}),(0,n.jsx)(r.td,{children:"HTTP method (uppercased)"})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"kind"})}),(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"TurboRequestKind"})}),(0,n.jsxs)(r.td,{children:["Classification: ",(0,n.jsx)(r.code,{children:"standard"}),", ",(0,n.jsx)(r.code,{children:"frame"}),", or ",(0,n.jsx)(r.code,{children:"stream"})]})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"isStreamRequest"})}),(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"bool"})}),(0,n.jsxs)(r.td,{children:[(0,n.jsx)(r.code,{children:"true"})," if ",(0,n.jsx)(r.code,{children:"Accept"})," header includes ",(0,n.jsx)(r.code,{children:"text/vnd.turbo-stream.html"})]})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"isFrameRequest"})}),(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"bool"})}),(0,n.jsxs)(r.td,{children:[(0,n.jsx)(r.code,{children:"true"})," if a ",(0,n.jsx)(r.code,{children:"Turbo-Frame"})," header is present"]})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"isTurboVisit"})}),(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"bool"})}),(0,n.jsxs)(r.td,{children:[(0,n.jsx)(r.code,{children:"true"})," if ",(0,n.jsx)(r.code,{children:"Turbo-Visit: true"})," header is set"]})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"frameId"})}),(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"String?"})}),(0,n.jsxs)(r.td,{children:["Value of the ",(0,n.jsx)(r.code,{children:"Turbo-Frame"})," header"]})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"requestId"})}),(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"String?"})}),(0,n.jsxs)(r.td,{children:["Value of the ",(0,n.jsx)(r.code,{children:"X-Turbo-Request-Id"})," header"]})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"header(name)"})}),(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"String?"})}),(0,n.jsx)(r.td,{children:"Raw header value lookup"})]})]})]}),"\n",(0,n.jsx)(r.h3,{id:"turborequestkind",children:(0,n.jsx)(r.code,{children:"TurboRequestKind"})}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-dart",children:"enum TurboRequestKind {\n  standard,  // No Turbo-specific headers\n  frame,     // Turbo-Frame header present\n  stream,    // Accept: text/vnd.turbo-stream.html\n}\n"})}),"\n",(0,n.jsxs)(r.p,{children:["The ",(0,n.jsx)(r.code,{children:"kind"})," getter checks stream first, then frame, then falls back to standard. This means a request that is both a frame request and a stream request will be classified as ",(0,n.jsx)(r.code,{children:"stream"}),"."]}),"\n",(0,n.jsx)(r.h3,{id:"standalone-usage",children:"Standalone Usage"}),"\n",(0,n.jsxs)(r.p,{children:["You can also construct ",(0,n.jsx)(r.code,{children:"TurboRequestInfo"})," from raw headers for testing or tooling:"]}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-dart",children:"final info = TurboRequestInfo.fromHeaders({\n  'accept': ['text/vnd.turbo-stream.html'],\n  'turbo-frame': ['my-frame'],\n}, method: 'POST');\n\nprint(info.kind);           // TurboRequestKind.stream\nprint(info.frameId);        // my-frame\nprint(info.isStreamRequest); // true\n"})}),"\n",(0,n.jsx)(r.h2,{id:"sending-responses",children:"Sending Responses"}),"\n",(0,n.jsx)(r.h3,{id:"context-extension-methods",children:"Context Extension Methods"}),"\n",(0,n.jsxs)(r.p,{children:["The ",(0,n.jsx)(r.code,{children:"TurboResponseContext"})," extension provides shorthand methods on ",(0,n.jsx)(r.code,{children:"EngineContext"}),":"]}),"\n",(0,n.jsxs)(r.table,{children:[(0,n.jsx)(r.thead,{children:(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.th,{children:"Method"}),(0,n.jsx)(r.th,{children:"Content Type"}),(0,n.jsx)(r.th,{children:"Default Status"}),(0,n.jsx)(r.th,{children:"Description"})]})}),(0,n.jsxs)(r.tbody,{children:[(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"ctx.turboHtml(html)"})}),(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"text/html"})}),(0,n.jsx)(r.td,{children:"200"}),(0,n.jsx)(r.td,{children:"Full-page HTML (Turbo Drive)"})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"ctx.turboFrame(html)"})}),(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"text/html"})}),(0,n.jsx)(r.td,{children:"200"}),(0,n.jsx)(r.td,{children:"HTML fragment for a Turbo Frame"})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"ctx.turboStream(body)"})}),(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"text/vnd.turbo-stream.html"})}),(0,n.jsx)(r.td,{children:"200"}),(0,n.jsx)(r.td,{children:"Turbo Stream payload"})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"ctx.turboSeeOther(url)"})}),(0,n.jsx)(r.td,{children:"\u2014"}),(0,n.jsx)(r.td,{children:"303"}),(0,n.jsx)(r.td,{children:"Redirect (Turbo Drive follows automatically)"})]}),(0,n.jsxs)(r.tr,{children:[(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"ctx.turboUnprocessable(html)"})}),(0,n.jsx)(r.td,{children:(0,n.jsx)(r.code,{children:"text/html"})}),(0,n.jsx)(r.td,{children:"422"}),(0,n.jsx)(r.td,{children:"Validation error page"})]})]})]}),"\n",(0,n.jsxs)(r.p,{children:["All methods accept optional ",(0,n.jsx)(r.code,{children:"headers"})," and (except ",(0,n.jsx)(r.code,{children:"turboSeeOther"})," and ",(0,n.jsx)(r.code,{children:"turboUnprocessable"}),") an optional ",(0,n.jsx)(r.code,{children:"statusCode"}),"."]}),"\n",(0,n.jsx)(r.h3,{id:"static-methods",children:"Static Methods"}),"\n",(0,n.jsxs)(r.p,{children:["The same helpers are available as static methods on ",(0,n.jsx)(r.code,{children:"TurboResponse"})," if you prefer explicit context passing:"]}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-dart",children:"return TurboResponse.stream(ctx, fragment);\nreturn TurboResponse.html(ctx, '<h1>Hello</h1>');\nreturn TurboResponse.seeOther(ctx, '/dashboard');\nreturn TurboResponse.unprocessable(ctx, '<p>Email is required</p>');\n"})}),"\n",(0,n.jsx)(r.h3,{id:"example-form-submission-with-validation",children:"Example: Form Submission with Validation"}),"\n",(0,n.jsx)(r.pre,{children:(0,n.jsx)(r.code,{className:"language-dart",children:"engine.post('/contacts', (ctx) async {\n  final name = ctx.input('name');\n  final email = ctx.input('email');\n\n  if (name.isEmpty || email.isEmpty) {\n    // Return 422 so Turbo re-renders the form with errors\n    return ctx.turboUnprocessable(\n      '<form id=\"contact-form\">..errors..</form>',\n    );\n  }\n\n  // Success \u2014 append the new contact and clear the form\n  if (ctx.turbo.isStreamRequest) {\n    return ctx.turboStream(joinTurboStreams([\n      turboStreamAppend(\n        target: 'contacts',\n        html: '<li>$name ($email)</li>',\n      ),\n      turboStreamUpdate(\n        target: 'contact-form',\n        html: '<form id=\"contact-form\">..blank form..</form>',\n      ),\n    ]));\n  }\n\n  // Non-Turbo fallback \u2014 redirect\n  return ctx.turboSeeOther('/contacts');\n});\n"})}),"\n",(0,n.jsx)(r.h3,{id:"response-behavior",children:"Response Behavior"}),"\n",(0,n.jsxs)(r.ul,{children:["\n",(0,n.jsxs)(r.li,{children:[(0,n.jsx)(r.strong,{children:(0,n.jsx)(r.code,{children:"turboStream"})})," accepts either a ",(0,n.jsx)(r.code,{children:"String"})," or an ",(0,n.jsx)(r.code,{children:"Iterable<String>"})," as the body. It calls ",(0,n.jsx)(r.code,{children:"normalizeTurboStreamBody()"})," internally to coerce the input."]}),"\n",(0,n.jsxs)(r.li,{children:[(0,n.jsx)(r.strong,{children:(0,n.jsx)(r.code,{children:"turboSeeOther"})})," sets the ",(0,n.jsx)(r.code,{children:"Location"})," header and a 303 status. Turbo Drive automatically follows 303 redirects."]}),"\n",(0,n.jsxs)(r.li,{children:[(0,n.jsx)(r.strong,{children:(0,n.jsx)(r.code,{children:"turboUnprocessable"})})," returns a 422 status with ",(0,n.jsx)(r.code,{children:"text/html"}),". Turbo treats 422 responses as form validation errors and re-renders the response content."]}),"\n",(0,n.jsxs)(r.li,{children:["All response helpers check ",(0,n.jsx)(r.code,{children:"ctx.isClosed"})," before writing to avoid double-response errors."]}),"\n"]})]})}function a(e={}){const{wrapper:r}={...(0,d.R)(),...e.components};return r?(0,n.jsx)(r,{...e,children:(0,n.jsx)(h,{...e})}):h(e)}},8453:(e,r,t)=>{t.d(r,{R:()=>o,x:()=>i});var s=t(6540);const n={},d=s.createContext(n);function o(e){const r=s.useContext(d);return s.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function i(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:o(e.components),s.createElement(d.Provider,{value:r},e.children)}}}]);