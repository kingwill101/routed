"use strict";(globalThis.webpackChunkrouted=globalThis.webpackChunkrouted||[]).push([[4987],{8453:(e,t,n)=>{n.d(t,{R:()=>i,x:()=>o});var s=n(6540);const a={},r=s.createContext(a);function i(e){const t=s.useContext(r);return s.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:i(e.components),s.createElement(r.Provider,{value:t},e.children)}},8544:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>d,contentTitle:()=>o,default:()=>p,frontMatter:()=>i,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"fundamentals/responses","title":"Responses","description":"Return JSON, templates, files, and streaming responses","source":"@site/docs/routed/fundamentals/responses.mdx","sourceDirName":"fundamentals","slug":"/fundamentals/responses","permalink":"/docs/routed/fundamentals/responses","draft":false,"unlisted":false,"editUrl":"https://github.com/kingwill101/routed/tree/main/docs/docs/routed/fundamentals/responses.mdx","tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"title":"Responses","description":"Return JSON, templates, files, and streaming responses","sidebar_position":4},"sidebar":"routedSidebar","previous":{"title":"Request Handling","permalink":"/docs/routed/fundamentals/requests"},"next":{"title":"Context Data","permalink":"/docs/routed/fundamentals/context-data"}}');var a=n(4848),r=n(8453);const i={title:"Responses",description:"Return JSON, templates, files, and streaming responses",sidebar_position:4},o="Responses",d={},c=[{value:"JSON variants",id:"json-variants",level:2},{value:"HTML and templates",id:"html-and-templates",level:2},{value:"Other content types",id:"other-content-types",level:2},{value:"Renderers",id:"renderers",level:2},{value:"Files and static assets",id:"files-and-static-assets",level:2},{value:"Redirects, headers, and status codes",id:"redirects-headers-and-status-codes",level:2},{value:"Streaming",id:"streaming",level:2},{value:"Raw socket upgrades",id:"raw-socket-upgrades",level:2}];function l(e){const t={blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",...(0,r.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(t.header,{children:(0,a.jsx)(t.h1,{id:"responses",children:"Responses"})}),"\n",(0,a.jsxs)(t.p,{children:["Routed ships with fluent helpers for the most common response types. Each helper returns a ",(0,a.jsx)(t.code,{children:"Response"}),", so you can return the call directly from your handler. Helpers set sensible Content-Type headers (for example, application/json for json/indentedJson); when sending custom data via ctx.data, be explicit with the media type and charset."]}),"\n",(0,a.jsx)(t.h2,{id:"json-variants",children:"JSON variants"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-dart",children:"ctx.json({'message': 'Hello'});                    // application/json\nctx.indentedJson({'debug': true});                 // pretty-printed\nctx.secureJson(data, prefix: \")]}'\\n\");            // JSON hijacking protection\nctx.asciiJson({'emoji': '\ud83d\udd25'});                     // escape non-ASCII (use rarely; prefer UTF-8)\nctx.jsonp(data, callback: 'handleResponse');       // JSONP (legacy; prefer CORS)\n"})}),"\n",(0,a.jsx)(t.h2,{id:"html-and-templates",children:"HTML and templates"}),"\n",(0,a.jsxs)(t.p,{children:["Use ",(0,a.jsx)(t.code,{children:"ctx.string"})," for small inline responses; for HTML pages prefer a view engine and call ",(0,a.jsx)(t.code,{children:"ctx.template"})," / ",(0,a.jsx)(t.code,{children:"ctx.html"})," to keep markup out of handlers and leverage template caching."]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-dart",children:"// Inline HTML\nctx.string('<h1>Hello</h1>', statusCode: HttpStatus.ok);\n\n// Render a Liquid template via the view provider\nfinal engine = Engine(\n  configItems: {\n    'storage': {\n      'default': 'templates',\n      'disks': {\n        'templates': {'driver': 'local', 'root': 'resources'},\n      },\n    },\n    'view': {\n      'engine': 'liquid',\n      'disk': 'templates',\n      'directory': 'views',\n    },\n  },\n);\nawait engine.initialize();\n\nrouter.get('/dashboard', (ctx) async {\n  return await ctx.template(\n    templateName: 'dashboard.liquid',\n    data: {'user': {'name': 'Taylor'}},\n  );\n});\n"})}),"\n",(0,a.jsxs)(t.p,{children:["The ",(0,a.jsx)(t.code,{children:"ctx.html"})," helper renders a string through the configured template engine, which is useful for dynamic fragments:"]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-dart",children:"await ctx.html('<p>{{ message }}</p>', data: {'message': 'Welcome'});\n"})}),"\n",(0,a.jsxs)(t.blockquote,{children:["\n",(0,a.jsxs)(t.p,{children:["The view provider validates its configuration (",(0,a.jsx)(t.code,{children:"view.engine"}),", ",(0,a.jsx)(t.code,{children:"view.directory"}),", ",(0,a.jsx)(t.code,{children:"view.disk"}),", and ",(0,a.jsx)(t.code,{children:"view.cache"})," types) and throws a ",(0,a.jsx)(t.code,{children:"ProviderConfigException"})," if the manifest supplies the wrong shape. Use ",(0,a.jsx)(t.code,{children:"dart run routed provider:list --config"})," to inspect the active view settings and confirm the provider is enabled."]}),"\n"]}),"\n",(0,a.jsx)(t.h2,{id:"other-content-types",children:"Other content types"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-dart",children:"ctx.string('plain text response');\nctx.xml({'user': {'name': 'Ada'}});\nctx.yaml({'features': ['cache', 'sessions']});\nctx.data('application/octet-stream', bytes); // arbitrary bytes\nctx.data('text/csv; charset=utf-8', csvBytes); // specify charset for text formats\n"})}),"\n",(0,a.jsx)(t.h2,{id:"renderers",children:"Renderers"}),"\n",(0,a.jsxs)(t.p,{children:["The helpers above are small wrappers around ",(0,a.jsx)(t.code,{children:"Render"})," implementations in ",(0,a.jsx)(t.code,{children:"packages/routed/lib/src/render/*"}),". If you need explicit control, call ",(0,a.jsx)(t.code,{children:"ctx.render"})," with a renderer instance or build a custom ",(0,a.jsx)(t.code,{children:"Render"})," subclass."]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-dart",children:"import 'package:routed/src/render/json_render.dart';\n\nrouter.get('/status', (ctx) {\n  ctx.render(HttpStatus.ok, JsonRender({'status': 'ok'}));\n});\n"})}),"\n",(0,a.jsx)(t.h2,{id:"files-and-static-assets",children:"Files and static assets"}),"\n",(0,a.jsx)(t.p,{children:"Avoid resolving arbitrary absolute paths; prefer managed disks or known directories and use fileAttachment for user downloads to set Content-Disposition safely."}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-dart",children:"await ctx.file('public/manual.pdf');\nawait ctx.fileAttachment('reports/q1.pdf', 'report-q1.pdf');\nawait ctx.dir('public'); // serve directory listings\n\nrouter.static('/assets', 'public/assets');\nrouter.staticFile('/favicon.ico', 'public/favicon.ico');\n"})}),"\n",(0,a.jsx)(t.p,{children:"Prefer configuration-driven mounts for larger apps (or when you want storage disks to back assets):"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-yaml",metastring:'title="config/static.yaml"',children:"static:\n  enabled: true\n  mounts:\n    - route: /assets\n      disk: assets\n      path: ''\n"})}),"\n",(0,a.jsx)(t.h2,{id:"redirects-headers-and-status-codes",children:"Redirects, headers, and status codes"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-dart",children:"await ctx.redirect('/login');\nawait ctx.redirect('/moved', statusCode: HttpStatus.movedPermanently);\n\nctx.setHeader('Cache-Control', 'max-age=3600');\nctx.setHeader('Location', '/resources/123');       // for 201 Created responses\nctx.status(HttpStatus.created);\n"})}),"\n",(0,a.jsx)(t.h2,{id:"streaming",children:"Streaming"}),"\n",(0,a.jsx)(t.p,{children:"Stream large responses without buffering the whole payload. If you know the total size, set contentLength to enable Content-Length; otherwise omit it and the server will use chunked transfer encoding:"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-dart",children:"await ctx.dataFromReader(\n  statusCode: HttpStatus.ok,\n  contentType: 'text/plain',\n  contentLength: streamLength,\n  reader: myStream, // Stream<List<int>>\n  extraHeaders: {'X-Stream': 'true'},\n);\n"})}),"\n",(0,a.jsx)(t.h2,{id:"raw-socket-upgrades",children:"Raw socket upgrades"}),"\n",(0,a.jsxs)(t.p,{children:["For protocols that need full control over the TCP socket (custom streaming,\nlong-poll transports, bespoke wire protocols) use ",(0,a.jsx)(t.code,{children:"ctx.upgrade"}),". It mirrors\nShelf's \u201chijack\u201d API but keeps the engine informed so graceful shutdown still\nworks:"]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-dart",children:"router.get('/raw', (ctx) async {\n  ctx.response\n    ..statusCode = HttpStatus.switchingProtocols\n    ..headers.set('Upgrade', 'custom');\n\n  await ctx.upgrade((socket) async {\n    socket.write('hello\\n');\n    await socket.flush();\n    await socket.listen((data) {\n      socket.add(data); // echo\n    }).asFuture();\n  });\n});\n"})}),"\n",(0,a.jsx)(t.p,{children:"Only HTTP/1.1 requests can be upgraded, and an upgrade may happen once per\nrequest. After detaching you own the socket\u2014be sure to close it inside the\ncallback when you are done."}),"\n",(0,a.jsxs)(t.p,{children:["Import ",(0,a.jsx)(t.code,{children:"dart:io"})," to access ",(0,a.jsx)(t.code,{children:"HttpStatus"})," constants used in the examples."]})]})}function p(e={}){const{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,a.jsx)(t,{...e,children:(0,a.jsx)(l,{...e})}):l(e)}}}]);