"use strict";(globalThis.webpackChunkrouted=globalThis.webpackChunkrouted||[]).push([[8814],{1924:(e,t,s)=>{s.r(t),s.d(t,{assets:()=>l,contentTitle:()=>d,default:()=>c,frontMatter:()=>a,metadata:()=>r,toc:()=>o});const r=JSON.parse('{"id":"getting-started","title":"Getting Started (Server Testing)","description":"Install the tooling, connect your framework, and run the first server_test","source":"@site/docs/server-testing/getting-started.mdx","sourceDirName":".","slug":"/getting-started","permalink":"/docs/server_testing/getting-started","draft":false,"unlisted":false,"editUrl":"https://github.com/kingwill101/routed/tree/main/docs/docs/server-testing/getting-started.mdx","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"title":"Getting Started (Server Testing)","description":"Install the tooling, connect your framework, and run the first server_test","sidebar_position":2},"sidebar":"serverTestingSidebar","previous":{"title":"Server Testing Overview","permalink":"/docs/server_testing/intro"},"next":{"title":"Test Transports","permalink":"/docs/server_testing/transports"}}');var n=s(4848),i=s(8453);const a={title:"Getting Started (Server Testing)",description:"Install the tooling, connect your framework, and run the first server_test",sidebar_position:2},d="Getting Started",l={},o=[{value:"1. Add the Dev Dependencies",id:"1-add-the-dev-dependencies",level:2},{value:"2. (Optional) Scaffold Browser Assets",id:"2-optional-scaffold-browser-assets",level:2},{value:"3. Choose or Build a RequestHandler",id:"3-choose-or-build-a-requesthandler",level:2},{value:"Using the Built-in <code>IoRequestHandler</code>",id:"using-the-built-in-iorequesthandler",level:3},{value:"Using the Shelf Provider",id:"using-the-shelf-provider",level:3},{value:"4. Write Your First Test",id:"4-write-your-first-test",level:2},{value:"Example with <code>IoRequestHandler</code>",id:"example-with-iorequesthandler",level:3},{value:"Example with Shelf",id:"example-with-shelf",level:3},{value:"5. Run the Suite",id:"5-run-the-suite",level:2}];function h(e){const t={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",p:"p",pre:"pre",...(0,i.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(t.header,{children:(0,n.jsx)(t.h1,{id:"getting-started",children:"Getting Started"})}),"\n",(0,n.jsx)(t.p,{children:"These steps get you from an empty project to a runnable server test using the Shelf adapter. Swap in a different handler provider if you use another framework."}),"\n",(0,n.jsx)(t.h2,{id:"1-add-the-dev-dependencies",children:"1. Add the Dev Dependencies"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-yaml",children:"# pubspec.yaml (dev_dependencies)\ndev_dependencies:\n  server_testing: ^0.3.0\n  server_testing_shelf: ^0.2.1\n  test: ^1.25.0\n"})}),"\n",(0,n.jsx)(t.p,{children:"Then install packages:"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-bash",children:"dart pub get\n"})}),"\n",(0,n.jsx)(t.h2,{id:"2-optional-scaffold-browser-assets",children:"2. (Optional) Scaffold Browser Assets"}),"\n",(0,n.jsx)(t.p,{children:"If you plan to run UI automation, bootstrap the workspace now so browser bundles, drivers, and example tests are in place:"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-bash",children:"dart run server_testing init\ndart run server_testing install          # install default browsers\ndart run server_testing install:driver   # ensure webdriver binaries\n"})}),"\n",(0,n.jsxs)(t.p,{children:["The CLI creates ",(0,n.jsx)(t.code,{children:"test/http/"})," and ",(0,n.jsx)(t.code,{children:"test/browser/"})," folders, writes a sample ",(0,n.jsx)(t.code,{children:"browsers.json"}),", and caches downloads under ",(0,n.jsx)(t.code,{children:"~/.cache"}),"."]}),"\n",(0,n.jsx)(t.h2,{id:"3-choose-or-build-a-requesthandler",children:"3. Choose or Build a RequestHandler"}),"\n",(0,n.jsxs)(t.p,{children:[(0,n.jsx)(t.code,{children:"server_testing"})," never talks to your framework directly. It relies on a ",(0,n.jsx)(t.code,{children:"RequestHandler"})," abstraction that translates between ",(0,n.jsx)(t.code,{children:"HttpRequest"})," objects and your app."]}),"\n",(0,n.jsxs)(t.h3,{id:"using-the-built-in-iorequesthandler",children:["Using the Built-in ",(0,n.jsx)(t.code,{children:"IoRequestHandler"})]}),"\n",(0,n.jsxs)(t.p,{children:["For applications using ",(0,n.jsx)(t.code,{children:"dart:io"})," ",(0,n.jsx)(t.code,{children:"HttpServer"})," directly, use the built-in handler:"]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-dart",children:"import 'dart:io';\nimport 'package:server_testing/server_testing.dart';\n\nFuture<void> handleRequest(HttpRequest request) async {\n  final response = request.response;\n  response.statusCode = 200;\n  response.write('ok');\n  await response.close();\n}\n\nfinal handler = IoRequestHandler(handleRequest);\n"})}),"\n",(0,n.jsx)(t.h3,{id:"using-the-shelf-provider",children:"Using the Shelf Provider"}),"\n",(0,n.jsx)(t.p,{children:"For Shelf applications, there is a ready-made provider:"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-dart",children:"import 'package:shelf/shelf.dart' as shelf;\nimport 'package:server_testing/server_testing.dart';\nimport 'package:server_testing_shelf/server_testing_shelf.dart';\n\nfinal app = (shelf.Request req) async => shelf.Response.ok('ok');\nfinal handler = ShelfRequestHandler(app);\n"})}),"\n",(0,n.jsxs)(t.p,{children:["If your framework is not covered, implement ",(0,n.jsx)(t.code,{children:"RequestHandler"})," yourself\u2014see ",(0,n.jsx)(t.a,{href:"/docs/server_testing/handler-providers",children:"Handler Providers"}),"."]}),"\n",(0,n.jsx)(t.h2,{id:"4-write-your-first-test",children:"4. Write Your First Test"}),"\n",(0,n.jsxs)(t.p,{children:[(0,n.jsx)(t.code,{children:"serverTest"})," is a thin wrapper around ",(0,n.jsx)(t.code,{children:"test()"})," that wires up a ",(0,n.jsx)(t.code,{children:"TestClient"}),", passes the handler into your callback, and disposes everything for you. It accepts the same ",(0,n.jsx)(t.code,{children:"timeout"}),", ",(0,n.jsx)(t.code,{children:"skip"}),", ",(0,n.jsx)(t.code,{children:"tags"}),", ",(0,n.jsx)(t.code,{children:"retry"}),", and ",(0,n.jsx)(t.code,{children:"onPlatform"})," options you can pass to ",(0,n.jsx)(t.code,{children:"test()"}),"."]}),"\n",(0,n.jsxs)(t.h3,{id:"example-with-iorequesthandler",children:["Example with ",(0,n.jsx)(t.code,{children:"IoRequestHandler"})]}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-dart",children:"import 'dart:io';\nimport 'package:server_testing/server_testing.dart';\n\nvoid main() {\n  Future<void> handleRequest(HttpRequest request) async {\n    final response = request.response;\n    \n    if (request.uri.path == '/health') {\n      response.statusCode = 200;\n      response.write('ok');\n    } else {\n      response.statusCode = 404;\n      response.write('missing');\n    }\n    \n    await response.close();\n  }\n\n  final handler = IoRequestHandler(handleRequest);\n\n  serverTest('health endpoint', (client, _) async {\n    final res = await client.get('/health');\n    res.assertStatus(200).assertBody('ok');\n  }, handler: handler);\n}\n"})}),"\n",(0,n.jsx)(t.h3,{id:"example-with-shelf",children:"Example with Shelf"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-dart",children:"void main() {\n  final handler = ShelfRequestHandler((shelf.Request req) async {\n    if (req.url.path == 'health') {\n      return shelf.Response.ok('ok', headers: {'content-type': 'text/plain'});\n    }\n    return shelf.Response.notFound('missing');\n  });\n\n  serverTest('health endpoint', (client, _) async {\n    final res = await client.get('/health');\n    res.assertStatus(200).assertBody('ok');\n  }, handler: handler);\n}\n"})}),"\n",(0,n.jsxs)(t.p,{children:["The callback receives the ",(0,n.jsx)(t.code,{children:"TestClient"})," plus the same ",(0,n.jsx)(t.code,{children:"handler"})," instance. You can use the second parameter to inspect shared state or tear down external resources."]}),"\n",(0,n.jsx)(t.h2,{id:"5-run-the-suite",children:"5. Run the Suite"}),"\n",(0,n.jsx)(t.pre,{children:(0,n.jsx)(t.code,{className:"language-bash",children:"dart test                     # fast in-memory transport by default\ndart test --exclude-tags real-browser\ndart test -t real-browser -r expanded\n"})}),"\n",(0,n.jsxs)(t.p,{children:["By default ",(0,n.jsx)(t.code,{children:"serverTest"})," uses the in-memory transport. Pass ",(0,n.jsx)(t.code,{children:"transportMode: TransportMode.ephemeralServer"})," when you need the full HTTP stack or want to share the ephemeral server with browser tests."]}),"\n",(0,n.jsxs)(t.p,{children:["Next, dive into ",(0,n.jsx)(t.a,{href:"/docs/server_testing/http-testing",children:"HTTP Testing"})," to explore the client API, or ",(0,n.jsx)(t.a,{href:"/docs/server_testing/browser/browser-testing",children:"Browser Testing"})," to wire a UI flow on top of the same handler."]})]})}function c(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,n.jsx)(t,{...e,children:(0,n.jsx)(h,{...e})}):h(e)}},8453:(e,t,s)=>{s.d(t,{R:()=>a,x:()=>d});var r=s(6540);const n={},i=r.createContext(n);function a(e){const t=r.useContext(i);return r.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function d(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:a(e.components),r.createElement(i.Provider,{value:t},e.children)}}}]);