"use strict";(globalThis.webpackChunkrouted=globalThis.webpackChunkrouted||[]).push([[1230],{2158:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>d,contentTitle:()=>t,default:()=>u,frontMatter:()=>r,metadata:()=>l,toc:()=>o});const l=JSON.parse('{"id":"fundamentals/validation","title":"Validation","description":"Validate incoming data using built-in and custom rules","source":"@site/docs/routed/fundamentals/validation.mdx","sourceDirName":"fundamentals","slug":"/fundamentals/validation","permalink":"/docs/routed/fundamentals/validation","draft":false,"unlisted":false,"editUrl":"https://github.com/kingwill101/routed/tree/main/docs/docs/routed/fundamentals/validation.mdx","tags":[],"version":"current","sidebarPosition":9,"frontMatter":{"title":"Validation","description":"Validate incoming data using built-in and custom rules","sidebar_position":9},"sidebar":"routedSidebar","previous":{"title":"Server-Sent Events","permalink":"/docs/routed/fundamentals/sse"},"next":{"title":"Error Handling","permalink":"/docs/routed/fundamentals/error-handling"}}');var a=i(4848),s=i(8453);const r={title:"Validation",description:"Validate incoming data using built-in and custom rules",sidebar_position:9},t="Validation",d={},o=[{value:"Basic Validation",id:"basic-validation",level:2},{value:"Available Rules",id:"available-rules",level:2},{value:"Core Rules",id:"core-rules",level:3},{value:"Type Validation",id:"type-validation",level:3},{value:"Size Rules",id:"size-rules",level:3},{value:"Format Rules",id:"format-rules",level:3},{value:"File Validation",id:"file-validation",level:3},{value:"Handling Validation Errors",id:"handling-validation-errors",level:2},{value:"Controlling Error Flow",id:"controlling-error-flow",level:2},{value:"Optional fields example",id:"optional-fields-example",level:3},{value:"Custom Validation Rules",id:"custom-validation-rules",level:2},{value:"Request Context Integration",id:"request-context-integration",level:2}];function c(e){const n={blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"validation",children:"Validation"})}),"\n",(0,a.jsx)(n.p,{children:"Routed provides validation capabilities for request data including JSON, form data, query parameters, and file uploads."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-dart",metastring:'title="Import validation helpers"',children:"import 'package:routed/validation.dart';\n"})}),"\n",(0,a.jsx)(n.h2,{id:"basic-validation",children:"Basic Validation"}),"\n",(0,a.jsxs)(n.p,{children:["The ",(0,a.jsx)(n.code,{children:"validate()"})," method allows validating incoming request data against a set of rules:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-dart",children:"router.post('/users', (ctx) async {\n  await ctx.validate({\n    'email': 'required|email',\n    'password': 'required|min:8'\n  });\n\n  // Validation passed\n  final data = await ctx.request.body();\n  ctx.json({'message': 'User created'});\n});\n"})}),"\n",(0,a.jsx)(n.h2,{id:"available-rules",children:"Available Rules"}),"\n",(0,a.jsxs)(n.p,{children:["Rules are written as a pipe-delimited string (for example, 'required|min:8|email'). Options follow a colon and accept comma-separated values (for example, 'between:3,10' or 'file_extensions",":jpg",",png'). Whitespace is ignored around delimiters."]}),"\n",(0,a.jsx)(n.h3,{id:"core-rules",children:"Core Rules"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"required"})," - Field must be present and not empty"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"nullable"})," - Field may be null or missing; other rules are evaluated only when a non-null value is present"]}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"type-validation",children:"Type Validation"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"string"})," - Must be a string"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"numeric"})," - Must be a number"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"int"})," - Must be an integer"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"double"})," - Must be a decimal number"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"array"})," - Must be an array"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"boolean"})," - Must be a boolean value"]}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"size-rules",children:"Size Rules"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"min:value"})," - Minimum length (strings/arrays) or numeric value"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"max:value"})," - Maximum length (strings/arrays) or numeric value"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"between:min,max"})," - Inclusive bounds for length or numeric value"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"size:value"})," - Exact length (strings/arrays) or exact numeric value"]}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"format-rules",children:"Format Rules"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"email"})," - Must be a valid email address"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"url"})," - Must be valid URL"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"date"})," - Must be valid date (YYYY-MM-DD)"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"uuid"})," - Must be valid UUID"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"ip"})," - Must be valid IP address"]}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"file-validation",children:"File Validation"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"file"})," - Must be file upload"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"max_file_size:bytes"})," - Maximum file size"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"file_extensions:jpg,png"})," - Allowed file extensions"]}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"Notes:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"nullable"})," allows missing or null values; without ",(0,a.jsx)(n.code,{children:"required"}),", such fields pass validation when unset"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"file"})," should appear before file-specific rules like ",(0,a.jsx)(n.code,{children:"max_file_size"})," or ",(0,a.jsx)(n.code,{children:"file_extensions"})]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"file_extensions"})," expects a comma-separated list without leading dots; comparison is based on the uploaded filename's extension"]}),"\n",(0,a.jsx)(n.li,{children:"Size rules apply to strings/arrays by length; for numeric fields they apply to the numeric value"}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"handling-validation-errors",children:"Handling Validation Errors"}),"\n",(0,a.jsxs)(n.p,{children:["Validation errors throw a ",(0,a.jsx)(n.code,{children:"ValidationError"})," with error details:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-dart",children:"try {\n  await ctx.validate({\n    'email': 'required|email',\n    'password': 'required|min:8'\n  });\n} on ValidationError catch (e) {\n  return ctx.json({\n    'errors': e.errors  \n  }, statusCode: 422);\n}\n"})}),"\n",(0,a.jsx)(n.h2,{id:"controlling-error-flow",children:"Controlling Error Flow"}),"\n",(0,a.jsx)(n.p,{children:"The validation helpers expose additional knobs:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-dart",children:"await ctx.validate(\n  {\n    'username': 'required|min:5|alpha',\n  },\n  bail: true, // stop evaluating further rules for a field\n  messages: {\n    'username.min': 'Usernames must be at least five characters long.',\n    'alpha': 'Use only letters in usernames.', // blanket override\n  },\n);\n"})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["When ",(0,a.jsx)(n.code,{children:"bail"})," is ",(0,a.jsx)(n.code,{children:"true"}),", subsequent rules for a field are skipped after the first failure."]}),"\n",(0,a.jsxs)(n.li,{children:["Without ",(0,a.jsx)(n.code,{children:"bail"}),", Routed now accumulates every failing rule message for that field\u2014responses contain an ordered list instead of just the last failure."]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.code,{children:"messages"})," lets you swap the default copy globally (by rule name) or per field (",(0,a.jsx)(n.code,{children:"field.rule"}),")."]}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"optional-fields-example",children:"Optional fields example"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-dart",children:"await ctx.validate({\n  'nickname': 'nullable|string|min:3'\n});\n// When nickname is missing or null, the string/min rules are skipped.\n// To require a value, drop 'nullable' and add 'required'.\n"})}),"\n",(0,a.jsx)(n.h2,{id:"custom-validation-rules",children:"Custom Validation Rules"}),"\n",(0,a.jsxs)(n.p,{children:["Create custom rules by implementing ",(0,a.jsx)(n.code,{children:"ValidationRule"}),":"]}),"\n",(0,a.jsxs)(n.blockquote,{children:["\n",(0,a.jsxs)(n.p,{children:["Note: ",(0,a.jsx)(n.code,{children:"ValidationRuleRegistry"})," is available by default in bare mode (",(0,a.jsx)(n.code,{children:"Engine()"}),") and is also registered by ",(0,a.jsx)(n.code,{children:"RoutingServiceProvider"})," in full mode. If you manually remove it, re-register one before calling ",(0,a.jsx)(n.code,{children:"engine.container.get<ValidationRuleRegistry>()"}),"."]}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-dart",children:"class PhoneRule extends ValidationRule {\n  @override\n  String get name => 'phone';\n\n  @override\n  String message(dynamic value, [List<String>? options]) => \n    'Must be valid phone number';\n\n  @override\n  bool validate(dynamic value, [List<String>? options]) {\n    if (value == null) return false;\n    return RegExp(r'^\\d{3}-\\d{3}-\\d{4}$').hasMatch(value.toString());\n  }\n}\n\n// Register the rule\nfinal engine = Engine();\nengine.container.get<ValidationRuleRegistry>().register(() => PhoneRule());\n\n// Use custom rule\nawait ctx.validate({\n  'phone': 'required|phone'  \n});\n"})}),"\n",(0,a.jsx)(n.h2,{id:"request-context-integration",children:"Request Context Integration"}),"\n",(0,a.jsx)(n.p,{children:"Validation is integrated with the request context:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-dart",children:"router.post('/upload', (ctx) async {\n  // Validate form data and files\n  await ctx.validate({\n    'title': 'required|string',\n    'file': 'required|file|max_file_size:5242880'\n  });\n\n  // Access validated data\n  final title = await ctx.postForm('title');\n  final file = await ctx.formFile('file');\n\n  // Process valid data...\n});\n"})})]})}function u(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(c,{...e})}):c(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>r,x:()=>t});var l=i(6540);const a={},s=l.createContext(a);function r(e){const n=l.useContext(s);return l.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:r(e.components),l.createElement(s.Provider,{value:n},e.children)}}}]);