"use strict";(globalThis.webpackChunkrouted=globalThis.webpackChunkrouted||[]).push([[433],{12:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>s,default:()=>h,frontMatter:()=>d,metadata:()=>r,toc:()=>l});const r=JSON.parse('{"id":"fundamentals/engine","title":"Engine Lifecycle","description":"Understand bare vs full boot profiles, explicit provider composition, and how to initialize the Engine.","source":"@site/docs/routed/fundamentals/engine.mdx","sourceDirName":"fundamentals","slug":"/fundamentals/engine","permalink":"/docs/routed/fundamentals/engine","draft":false,"unlisted":false,"editUrl":"https://github.com/kingwill101/routed/tree/main/docs/docs/routed/fundamentals/engine.mdx","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"title":"Engine Lifecycle","description":"Understand bare vs full boot profiles, explicit provider composition, and how to initialize the Engine.","sidebar_position":2},"sidebar":"routedSidebar","previous":{"title":"Routing","permalink":"/docs/routed/fundamentals/routing"},"next":{"title":"Middleware","permalink":"/docs/routed/fundamentals/middleware"}}');var o=i(4848),t=i(8453);const d={title:"Engine Lifecycle",description:"Understand bare vs full boot profiles, explicit provider composition, and how to initialize the Engine.",sidebar_position:2},s="Engine Lifecycle",c={},l=[{value:"Quick Start",id:"quick-start",level:2},{value:"<code>Engine.create()</code> \u2013 async convenience (recommended)",id:"enginecreate--async-convenience-recommended",level:2},{value:"<code>Engine()</code> \u2013 manual construction",id:"engine--manual-construction",level:2},{value:"Bare mode",id:"bare-mode",level:3},{value:"Full mode with <code>Engine.builtins</code>",id:"full-mode-with-enginebuiltins",level:3},{value:"Minimal mode with <code>Engine.defaultProviders</code>",id:"minimal-mode-with-enginedefaultproviders",level:3},{value:"Inline configuration with <code>configItems</code>",id:"inline-configuration-with-configitems",level:3},{value:"Custom configuration (explicit CoreServiceProvider)",id:"custom-configuration-explicit-coreserviceprovider",level:3},{value:"Loading configuration from disk",id:"loading-configuration-from-disk",level:3},{value:"Lazy provider loading via config",id:"lazy-provider-loading-via-config",level:3},{value:"Choosing between them",id:"choosing-between-them",level:2},{value:"Notes for config-driven features",id:"notes-for-config-driven-features",level:2},{value:"Late configuration overrides with <code>withConfigItems</code>",id:"late-configuration-overrides-with-withconfigitems",level:3}];function a(e){const n={code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"engine-lifecycle",children:"Engine Lifecycle"})}),"\n",(0,o.jsxs)(n.p,{children:["The ",(0,o.jsx)(n.code,{children:"Engine"})," owns the container, service providers, middleware stacks, and HTTP\nservers. Routed uses ",(0,o.jsx)(n.strong,{children:"explicit provider composition"})," with convenient defaults:"]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Bare"}),": minimal routing + middleware, no config loader, no provider manifest."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Full"})," (recommended): config loading + provider registration + manifest discovery."]}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"Use the profile that matches your workload."}),"\n",(0,o.jsx)(n.h2,{id:"quick-start",children:"Quick Start"}),"\n",(0,o.jsxs)(n.p,{children:["For most applications, use ",(0,o.jsx)(n.code,{children:"Engine.create()"})," which loads all built-in providers:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-dart",metastring:'title="Recommended: Full-featured engine"',children:"final engine = await Engine.create();\n\nengine.get('/ping', (ctx) => ctx.text('pong'));\n\nawait engine.serve(address: '127.0.0.1', port: 8080);\n"})}),"\n",(0,o.jsx)(n.p,{children:"This gives you all 16 built-in providers: core, routing, cache, sessions, uploads,\ncors, security, logging, auth, observability, compression, rate limiting, storage,\nstatic assets, views, and localization."}),"\n",(0,o.jsxs)(n.h2,{id:"enginecreate--async-convenience-recommended",children:[(0,o.jsx)(n.code,{children:"Engine.create()"})," \u2013 async convenience (recommended)"]}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.code,{children:"Engine.create()"})," is the recommended way to create an engine. It constructs an\nengine with all built-in providers and initializes it in one call. It accepts\noptional ",(0,o.jsx)(n.code,{children:"configItems"})," for inline configuration, ",(0,o.jsx)(n.code,{children:"providers"}),", ",(0,o.jsx)(n.code,{children:"middlewares"}),",\n",(0,o.jsx)(n.code,{children:"options"}),", and ",(0,o.jsx)(n.code,{children:"errorHandling"})," for full customization:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-dart",children:"// Full-featured engine with all builtins (default)\nfinal engine = await Engine.create();\n\n// Inline configuration \u2014 no YAML files needed (recommended)\nfinal engine = await Engine.create(\n  configItems: {\n    'app.name': 'My Application',\n    'app.env': 'production',\n    'logging.enabled': true,\n  },\n);\n\n// Minimal engine with just core + routing\nfinal engine = await Engine.create(providers: Engine.defaultProviders);\n\n// Bare engine (no providers)\nfinal engine = await Engine.create(providers: []);\n\n// Advanced: explicit CoreServiceProvider (e.g. when combining with withLoader)\nfinal engine = await Engine.create(\n  providers: [\n    CoreServiceProvider(configItems: {'app.name': 'MyApp'}),\n    ...Engine.builtins,\n  ],\n);\n"})}),"\n",(0,o.jsxs)(n.h2,{id:"engine--manual-construction",children:[(0,o.jsx)(n.code,{children:"Engine()"})," \u2013 manual construction"]}),"\n",(0,o.jsxs)(n.p,{children:["When you need finer control over the boot process, construct the engine manually\nand call ",(0,o.jsx)(n.code,{children:"initialize()"}),":"]}),"\n",(0,o.jsx)(n.h3,{id:"bare-mode",children:"Bare mode"}),"\n",(0,o.jsxs)(n.p,{children:["Calling ",(0,o.jsx)(n.code,{children:"Engine()"})," with no providers returns a bare-bones instance. No config\nfiles are loaded and no providers are auto-registered:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-dart",metastring:'title="Bare engine"',children:"final engine = Engine();\nengine.get('/ping', (ctx) => ctx.text('pong'));\n\nawait engine.serve(address: '127.0.0.1', port: 8080);\n"})}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"What you get in bare mode"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Route matching (including parameter patterns)"}),"\n",(0,o.jsx)(n.li,{children:"Middleware execution"}),"\n",(0,o.jsx)(n.li,{children:"The standard request/response helpers"}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"What you do NOT get"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Config loader / ",(0,o.jsx)(n.code,{children:".env"})," processing"]}),"\n",(0,o.jsxs)(n.li,{children:["Provider manifest discovery (",(0,o.jsx)(n.code,{children:"http.providers"}),")"]}),"\n",(0,o.jsx)(n.li,{children:"Built-in providers (logging, cache, sessions, etc.)"}),"\n"]}),"\n",(0,o.jsxs)(n.h3,{id:"full-mode-with-enginebuiltins",children:["Full mode with ",(0,o.jsx)(n.code,{children:"Engine.builtins"})]}),"\n",(0,o.jsxs)(n.p,{children:["Use ",(0,o.jsx)(n.code,{children:"Engine.builtins"})," to get all framework providers:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-dart",metastring:'title="Full mode with all providers"',children:"final engine = Engine(providers: Engine.builtins);\n\nawait engine.initialize();\n"})}),"\n",(0,o.jsxs)(n.p,{children:["This includes all providers from the ",(0,o.jsx)(n.code,{children:"ProviderRegistry"}),": core, routing, cache,\nsessions, uploads, cors, security, logging, auth, observability, compression,\nrate limiting, storage, static assets, views, and localization."]}),"\n",(0,o.jsxs)(n.h3,{id:"minimal-mode-with-enginedefaultproviders",children:["Minimal mode with ",(0,o.jsx)(n.code,{children:"Engine.defaultProviders"})]}),"\n",(0,o.jsxs)(n.p,{children:["Use ",(0,o.jsx)(n.code,{children:"Engine.defaultProviders"})," to get just the essential providers:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-dart",metastring:'title="Minimal mode with core + routing"',children:"final engine = Engine(providers: Engine.defaultProviders);\n\nawait engine.initialize();\n"})}),"\n",(0,o.jsx)(n.p,{children:"This gives you:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"In-memory configuration with sensible defaults"}),"\n",(0,o.jsx)(n.li,{children:"Router registration"}),"\n",(0,o.jsx)(n.li,{children:"Event manager"}),"\n"]}),"\n",(0,o.jsxs)(n.h3,{id:"inline-configuration-with-configitems",children:["Inline configuration with ",(0,o.jsx)(n.code,{children:"configItems"})]}),"\n",(0,o.jsxs)(n.p,{children:["For custom configuration values without file I/O, use the ",(0,o.jsx)(n.code,{children:"configItems"}),"\nparameter directly on the constructor. This automatically creates a\n",(0,o.jsx)(n.code,{children:"CoreServiceProvider"})," with your values:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-dart",metastring:'title="Inline configuration (recommended)"',children:"final engine = Engine(\n  providers: Engine.builtins,\n  configItems: {\n    'app.name': 'My Application',\n    'app.env': 'production',\n    'database.host': 'db.internal',\n  },\n);\n\nawait engine.initialize();\n"})}),"\n",(0,o.jsxs)(n.p,{children:["This is equivalent to the more verbose pattern of constructing a\n",(0,o.jsx)(n.code,{children:"CoreServiceProvider(configItems: {...})"})," manually, but shorter and less\nerror-prone."]}),"\n",(0,o.jsx)(n.h3,{id:"custom-configuration-explicit-coreserviceprovider",children:"Custom configuration (explicit CoreServiceProvider)"}),"\n",(0,o.jsxs)(n.p,{children:["When you need to combine inline config with a specific ",(0,o.jsx)(n.code,{children:"CoreServiceProvider"}),"\nconstructor (for example, ",(0,o.jsx)(n.code,{children:"withLoader"})," or ",(0,o.jsx)(n.code,{children:"withCachedConfig"}),"), construct it\nexplicitly:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-dart",metastring:'title="Explicit CoreServiceProvider"',children:"final engine = Engine(\n  providers: [\n    CoreServiceProvider(configItems: {\n      'app.name': 'My Application',\n      'app.env': 'production',\n      'database.host': 'db.internal',\n    }),\n    RoutingServiceProvider(),\n  ],\n);\n\nawait engine.initialize();\n"})}),"\n",(0,o.jsx)(n.h3,{id:"loading-configuration-from-disk",children:"Loading configuration from disk"}),"\n",(0,o.jsxs)(n.p,{children:["To load configuration from files, use ",(0,o.jsx)(n.code,{children:"CoreServiceProvider.withLoader"}),":"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-dart",metastring:'title="File-based configuration"',children:"final engine = Engine(\n  providers: [\n    CoreServiceProvider.withLoader(ConfigLoaderOptions(\n      configDirectory: 'config',\n      envFiles: ['.env', '.env.local'],\n      watch: true,\n    )),\n    RoutingServiceProvider(),\n  ],\n);\n\nawait engine.initialize();\n"})}),"\n",(0,o.jsx)(n.h3,{id:"lazy-provider-loading-via-config",children:"Lazy provider loading via config"}),"\n",(0,o.jsxs)(n.p,{children:["You can also configure providers in your ",(0,o.jsx)(n.code,{children:"config/http.yaml"})," and they will be\nlazily loaded from the ",(0,o.jsx)(n.code,{children:"ProviderRegistry"}),". This allows you to use a minimal\nprovider set in code while still enabling additional providers via config:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-dart",metastring:'title="Minimal code, config-driven providers"',children:"final engine = Engine(\n  providers: [\n    CoreServiceProvider.withLoader(ConfigLoaderOptions(\n      configDirectory: 'config',\n    )),\n    RoutingServiceProvider(),\n  ],\n);\n\nawait engine.initialize();\n"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",metastring:'title="config/http.yaml"',children:"providers:\n  - routed.uploads\n  - routed.cors\n  - routed.logging\n"})}),"\n",(0,o.jsxs)(n.p,{children:["The providers listed in ",(0,o.jsx)(n.code,{children:"http.providers"})," will be auto-registered from the\n",(0,o.jsx)(n.code,{children:"ProviderRegistry"})," during initialization."]}),"\n",(0,o.jsx)(n.h2,{id:"choosing-between-them",children:"Choosing between them"}),"\n",(0,o.jsxs)(n.table,{children:[(0,o.jsx)(n.thead,{children:(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.th,{children:"Scenario"}),(0,o.jsx)(n.th,{children:"Recommended API"}),(0,o.jsx)(n.th,{children:"Notes"})]})}),(0,o.jsxs)(n.tbody,{children:[(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:"Standard applications"}),(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"Engine.create()"})}),(0,o.jsx)(n.td,{children:"All builtins, fully featured."})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:"Inline config without YAML"}),(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"Engine.create(configItems: {...})"})}),(0,o.jsx)(n.td,{children:"No file I/O needed."})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:"Minimal applications"}),(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"Engine.create(providers: Engine.defaultProviders)"})}),(0,o.jsx)(n.td,{children:"Just core + routing."})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:"Microbenchmarks / tiny services"}),(0,o.jsxs)(n.td,{children:[(0,o.jsx)(n.code,{children:"Engine()"})," or ",(0,o.jsx)(n.code,{children:"Engine.create(providers: [])"})]}),(0,o.jsx)(n.td,{children:"Bare mode. Minimal overhead."})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:"Custom provider configuration"}),(0,o.jsxs)(n.td,{children:[(0,o.jsx)(n.code,{children:"Engine(providers: [...])"})," + ",(0,o.jsx)(n.code,{children:"initialize()"})]}),(0,o.jsx)(n.td,{children:"Explicit provider control."})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:"Config-driven provider loading"}),(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"Engine(providers: [CoreServiceProvider.withLoader(...), ...])"})}),(0,o.jsx)(n.td,{children:"Lazy loading via manifest."})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:"Unit tests"}),(0,o.jsxs)(n.td,{children:[(0,o.jsx)(n.code,{children:"Engine(providers: [...])"})," + ",(0,o.jsx)(n.code,{children:"initialize()"})]}),(0,o.jsx)(n.td,{children:"Explicit provider control."})]})]})]}),"\n",(0,o.jsx)(n.h2,{id:"notes-for-config-driven-features",children:"Notes for config-driven features"}),"\n",(0,o.jsxs)(n.p,{children:["Most ",(0,o.jsx)(n.code,{children:"EngineOpt"})," helpers and provider-backed features depend on ",(0,o.jsx)(n.code,{children:"Config"}),". In\nbare mode, ",(0,o.jsx)(n.code,{children:"Config"})," is not bound unless you register ",(0,o.jsx)(n.code,{children:"CoreServiceProvider"})," or\nbind a ",(0,o.jsx)(n.code,{children:"Config"})," instance yourself. If you need config-driven middleware or\nprovider defaults, include ",(0,o.jsx)(n.code,{children:"CoreServiceProvider"})," in your providers list."]}),"\n",(0,o.jsxs)(n.h3,{id:"late-configuration-overrides-with-withconfigitems",children:["Late configuration overrides with ",(0,o.jsx)(n.code,{children:"withConfigItems"})]}),"\n",(0,o.jsxs)(n.p,{children:["If you need to override configuration values ",(0,o.jsx)(n.em,{children:"after"})," providers have registered\ntheir defaults, use the ",(0,o.jsx)(n.code,{children:"withConfigItems"})," engine option:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-dart",children:"final engine = Engine(\n  providers: Engine.builtins,\n  options: [\n    withConfigItems({\n      'app.debug': true,\n      'cache.driver': 'array',\n    }),\n  ],\n);\n"})}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Important:"})," ",(0,o.jsx)(n.code,{children:"withConfigItems"})," runs after provider registration, so it acts as\na late override. If you need values available ",(0,o.jsx)(n.em,{children:"during"})," provider registration, use\nthe ",(0,o.jsx)(n.code,{children:"configItems"})," constructor parameter instead."]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(a,{...e})}):a(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>d,x:()=>s});var r=i(6540);const o={},t=r.createContext(o);function d(e){const n=r.useContext(t);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:d(e.components),r.createElement(t.Provider,{value:n},e.children)}}}]);