"use strict";(self.webpackChunkrouted=self.webpackChunkrouted||[]).push([[7348],{5066:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>a,contentTitle:()=>d,default:()=>h,frontMatter:()=>o,metadata:()=>r,toc:()=>l});const r=JSON.parse('{"id":"routed/fundamentals/configuration","title":"Configuration","description":"Configure the engine, file system, templates, and request behaviour","source":"@site/docs/routed/fundamentals/configuration.mdx","sourceDirName":"routed/fundamentals","slug":"/routed/fundamentals/configuration","permalink":"/docs/routed/fundamentals/configuration","draft":false,"unlisted":false,"editUrl":"https://github.com/kingwill101/routed/tree/main/docs/docs/routed/fundamentals/configuration.mdx","tags":[],"version":"current","sidebarPosition":11,"frontMatter":{"title":"Configuration","description":"Configure the engine, file system, templates, and request behaviour","sidebar_position":11},"sidebar":"tutorialSidebar","previous":{"title":"Error Handling","permalink":"/docs/routed/fundamentals/error-handling"},"next":{"title":"Structured Logging","permalink":"/docs/routed/fundamentals/logging"}}');var s=i(4848),t=i(8453);const o={title:"Configuration",description:"Configure the engine, file system, templates, and request behaviour",sidebar_position:11},d="Configuration",a={},l=[{value:"Configuration sources &amp; precedence",id:"configuration-sources--precedence",level:2},{value:"Customising the loader &amp; enabling watch mode",id:"customising-the-loader--enabling-watch-mode",level:2},{value:"Provider manifest &amp; CLI tooling",id:"provider-manifest--cli-tooling",level:2},{value:"Inspecting providers from the CLI",id:"inspecting-providers-from-the-cli",level:3},{value:"Built-in provider catalogue",id:"built-in-provider-catalogue",level:3},{value:"Programmatic provider inspection",id:"programmatic-provider-inspection",level:3},{value:"Default configuration &amp; <code>ProvidesDefaultConfig</code>",id:"default-configuration--providesdefaultconfig",level:3},{value:"Validation &amp; <code>ProviderConfigException</code>",id:"validation--providerconfigexception",level:3},{value:"Liquid templating in config files",id:"liquid-templating-in-config-files",level:3},{value:"Engine feature flags",id:"engine-feature-flags",level:2},{value:"Application keys &amp; secrets",id:"application-keys--secrets",level:2},{value:"Accessing configuration in code",id:"accessing-configuration-in-code",level:2},{value:"Scoped overrides for tests and tooling",id:"scoped-overrides-for-tests-and-tooling",level:3},{value:"Listening to configuration events",id:"listening-to-configuration-events",level:2},{value:"EngineConfig reference",id:"engineconfig-reference",level:2},{value:"File system configuration",id:"file-system-configuration",level:3},{value:"Request size &amp; uploads",id:"request-size--uploads",level:3},{value:"Functional configuration",id:"functional-configuration",level:3},{value:"View engine configuration",id:"view-engine-configuration",level:3},{value:"File Upload Configuration",id:"file-upload-configuration",level:3},{value:"Static assets",id:"static-assets",level:3},{value:"Storage disks",id:"storage-disks",level:3},{value:"Session Configuration",id:"session-configuration",level:3},{value:"Cookie-based Sessions",id:"cookie-based-sessions",level:4},{value:"File-based Sessions",id:"file-based-sessions",level:4},{value:"Custom template engines",id:"custom-template-engines",level:3},{value:"File system abstraction",id:"file-system-abstraction",level:3},{value:"Routing Configuration",id:"routing-configuration",level:3},{value:"Logging configuration",id:"logging-configuration",level:3},{value:"Proxy Configuration",id:"proxy-configuration",level:3},{value:"Cache Configuration",id:"cache-configuration",level:3},{value:"Engine configuration reference",id:"engine-configuration-reference",level:2},{value:"Enable HTTP/2",id:"enable-http2",level:3},{value:"Configure rate limiting",id:"configure-rate-limiting",level:3},{value:"Environment helper",id:"environment-helper",level:2},{value:"Configuration Best Practices",id:"configuration-best-practices",level:2},{value:"Development vs Production",id:"development-vs-production",level:2},{value:"Type-safe Configuration",id:"type-safe-configuration",level:2}];function c(e){const n={a:"a",admonition:"admonition",blockquote:"blockquote",br:"br",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"configuration",children:"Configuration"})}),"\n",(0,s.jsxs)(n.p,{children:["See the ",(0,s.jsx)(n.a,{href:"/docs/routed/examples/config-demo",children:"Config & CLI demo"})," under\n",(0,s.jsx)(n.code,{children:"examples/config_demo/"})," for a runnable project that stitches the loader,\nprovider defaults, and CLI commands together."]}),"\n",(0,s.jsxs)(n.p,{children:["Routed now boots with a configuration loader that merges multiple sources before service providers start.",(0,s.jsx)(n.br,{}),"\n","You still have access to ",(0,s.jsx)(n.code,{children:"EngineConfig"})," for framework tuning, but day-to-day settings (database hosts,\nfeature flags, etc.) live in the application configuration managed by ",(0,s.jsx)(n.code,{children:"ConfigLoader"}),"."]}),"\n",(0,s.jsx)(n.h2,{id:"configuration-sources--precedence",children:"Configuration sources & precedence"}),"\n",(0,s.jsx)(n.p,{children:"The loader resolves configuration in the following order:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Defaults"})," - supplied through ",(0,s.jsx)(n.code,{children:"ConfigLoaderOptions.defaults"})," (or the built-in defaults shipped by Routed)."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Environment files"})," - each ",(0,s.jsx)(n.code,{children:".env"})," file is parsed (values such as ",(0,s.jsx)(n.code,{children:"APP__NAME=My App"})," are translated to ",(0,s.jsx)(n.code,{children:"app.name"}),")."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Config directory"})," - every file under ",(0,s.jsx)(n.code,{children:"config/"})," (including ",(0,s.jsx)(n.code,{children:"config/{env}/"}),") is merged namespace by namespace."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Runtime overrides"})," - anything passed via ",(0,s.jsx)(n.code,{children:"configItems"})," or calling ",(0,s.jsx)(n.code,{children:"engine.replaceConfig"}),"."]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Later sources always win when keys overlap."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-dart",children:"// Inside an async bootstrap function\nfinal engine = await Engine.create(\n  configOptions: ConfigLoaderOptions(\n    defaults: const {\n      'app': {'name': 'Routed App', 'env': 'development', 'debug': true},\n      'database': {'host': '127.0.0.1', 'port': 5432},\n    },\n    configDirectory: 'config',\n    envFiles: ['.env', '.env.local'],\n  ),\n  configItems: {\n    // Runtime overrides (e.g. tests)\n    'database.host': 'db.internal',\n  },\n);\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"Engine.create"})," constructs an engine, boots service providers, and returns the\ninitialized instance. If you need finer control (for example, registering\nlisteners before boot), you can still instantiate ",(0,s.jsx)(n.code,{children:"Engine()"})," and call\n",(0,s.jsx)(n.code,{children:"await engine.initialize()"})," manually."]}),"\n",(0,s.jsxs)(n.p,{children:["The loader pushes a resolved ",(0,s.jsx)(n.code,{children:"ConfigImpl"})," instance into the container. It is automatically cloned for every\nrequest so per-request mutations do not leak."]}),"\n",(0,s.jsx)(n.h2,{id:"customising-the-loader--enabling-watch-mode",children:"Customising the loader & enabling watch mode"}),"\n",(0,s.jsxs)(n.p,{children:["Use ",(0,s.jsx)(n.code,{children:"ConfigLoaderOptions"})," to tweak directories, environment files, or enable hot reloading during development:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-dart",children:"final engine = Engine(\n  configOptions: ConfigLoaderOptions(\n    configDirectory: 'config',\n    envFiles: ['.env', '.env.${Platform.environment['APP_ENV'] ?? 'dev'}'],\n    watch: true,\n    watchDebounce: const Duration(milliseconds: 200),\n  ),\n);\n"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"watch: true"})," wires file system listeners that re-run the loader and call ",(0,s.jsx)(n.code,{children:"engine.replaceConfig"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:["Metadata about the reload lands on ",(0,s.jsx)(n.code,{children:"ConfigReloadedEvent"})," so you can react inside your own services."]}),"\n",(0,s.jsxs)(n.li,{children:["Per-environment folders (",(0,s.jsx)(n.code,{children:"config/{env}/"}),") are loaded automatically when ",(0,s.jsx)(n.code,{children:"app.env"})," is set via defaults or ",(0,s.jsx)(n.code,{children:".env"}),"."]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["If you prefer to skip ",(0,s.jsx)(n.code,{children:".env"})," parsing entirely, set ",(0,s.jsx)(n.code,{children:"loadEnvFiles: false"})," and rely on defaults or external configuration."]}),"\n",(0,s.jsx)(n.h2,{id:"provider-manifest--cli-tooling",children:"Provider manifest & CLI tooling"}),"\n",(0,s.jsxs)(n.p,{children:["Every Routed project ships with a manifest under ",(0,s.jsx)(n.code,{children:"config/http.yaml"}),". Two keys drive the provider system:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",metastring:'title="config/http.yaml"',children:"providers:\n  - routed.core\n  - routed.routing\n  - routed.cache\n  - routed.sessions\n  - routed.uploads\n  - routed.cors\n  - routed.security\n  - routed.logging\n  - routed.storage\n  - routed.static\n  - routed.localization\n  - routed.views\nhttp:\n  features:\n    uploads: { enabled: true }\n    cors:    { enabled: false }\n    security: { enabled: true }\n"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"providers"})," lists the service providers the engine should register during boot. Disable a provider by removing it (or using ",(0,s.jsx)(n.code,{children:"dart run routed_cli provider:disable id"}),")."]}),"\n",(0,s.jsxs)(n.li,{children:["Provider-specific ",(0,s.jsx)(n.code,{children:"*.enabled"})," flags (for example ",(0,s.jsx)(n.code,{children:"logging.enabled"}),", ",(0,s.jsx)(n.code,{children:"static.enabled"}),", ",(0,s.jsx)(n.code,{children:"rate_limit.enabled"}),") control opt-in behaviour so you can toggle middleware without editing code."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"http.middleware_sources"})," (populated by several providers) documents the middleware identifiers they register. Override the arrays when you need to reorder or remove middleware while keeping provider-owned setup logic intact."]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"inspecting-providers-from-the-cli",children:"Inspecting providers from the CLI"}),"\n",(0,s.jsx)(n.p,{children:"Run the CLI to see which providers are active, their descriptions, and the defaults they contribute:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"dart run routed_cli provider:list --config\n"})}),"\n",(0,s.jsxs)(n.p,{children:["The output includes each provider\u2019s ",(0,s.jsx)(n.code,{children:"configSource"})," and the default configuration it publishes. If the manifest includes malformed overrides (wrong types, missing maps, etc.), Routed throws a ",(0,s.jsx)(n.code,{children:"ProviderConfigException"})," and the CLI shows the failing path so you can fix it before starting the server."]}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Tip:"}),' Whenever the CLI writes a config file it prepends a short "configuration quick reference" comment. These comments mirror the provider docs (covering key paths, types, and supported options) so you can discover configuration knobs without leaving the file. If you prefer machine-readable metadata, run ',(0,s.jsx)(n.code,{children:"dart run routed_cli config:cache --docs"})," (optionally with ",(0,s.jsx)(n.code,{children:"--docs-output path/to/docs.json"}),") to emit the same information as JSON. That file is ideal for editor tooling, lint rules, or internal dashboards that want to surface config hints."]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"built-in-provider-catalogue",children:"Built-in provider catalogue"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Provider ID"}),(0,s.jsx)(n.th,{children:"Description"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"routed.core"})}),(0,s.jsx)(n.td,{children:"Loads configuration, registers the root container bindings, and sets up middleware registries."})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"routed.routing"})}),(0,s.jsx)(n.td,{children:"Registers the router, event manager, and routing lifecycle events."})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"routed.cache"})}),(0,s.jsxs)(n.td,{children:["Configures the cache manager and default stores (",(0,s.jsx)(n.code,{children:"cache.*"}),")."]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"routed.sessions"})}),(0,s.jsxs)(n.td,{children:["Enables session middleware, cookie/file stores, and session defaults (",(0,s.jsx)(n.code,{children:"session.*"}),")."]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"routed.uploads"})}),(0,s.jsxs)(n.td,{children:["Normalises multipart limits (",(0,s.jsx)(n.code,{children:"uploads.*"}),") and feeds them into ",(0,s.jsx)(n.code,{children:"EngineConfig"}),"."]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"routed.cors"})}),(0,s.jsxs)(n.td,{children:["Applies CORS defaults (",(0,s.jsx)(n.code,{children:"cors.*"})," or ",(0,s.jsx)(n.code,{children:"security.cors"}),") and manages middleware reloads."]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"routed.security"})}),(0,s.jsxs)(n.td,{children:["Handles CSRF, security headers, trusted proxies, and request size limits from ",(0,s.jsx)(n.code,{children:"security.*"}),"."]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"routed.logging"})}),(0,s.jsxs)(n.td,{children:["Controls the HTTP logging middleware and structured logging defaults (",(0,s.jsx)(n.code,{children:"logging.*"}),")."]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"routed.storage"})}),(0,s.jsxs)(n.td,{children:["Manages storage disks consumed by static assets, views, and uploads (",(0,s.jsx)(n.code,{children:"storage.*"}),")."]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"routed.static"})}),(0,s.jsxs)(n.td,{children:["Serves configured static mounts (",(0,s.jsx)(n.code,{children:"static.*"}),")."]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"routed.localization"})}),(0,s.jsxs)(n.td,{children:["Binds the translation loader + translator using the default filesystem and ",(0,s.jsx)(n.code,{children:"translation.*"})," config."]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"routed.views"})}),(0,s.jsxs)(n.td,{children:["Resolves view engines/directories using the shared storage layer (",(0,s.jsx)(n.code,{children:"view.*"}),")."]})]})]})]}),"\n",(0,s.jsxs)(n.p,{children:["Custom providers can be added by calling ",(0,s.jsx)(n.code,{children:"ProviderRegistry.instance.register('your.id', factory: () => YourProvider(), description: '...')"}),"\u2014this makes them visible to the CLI and eligible for inclusion in the manifest."]}),"\n",(0,s.jsx)(n.h3,{id:"programmatic-provider-inspection",children:"Programmatic provider inspection"}),"\n",(0,s.jsxs)(n.p,{children:["Prefer code over the CLI? Call ",(0,s.jsx)(n.code,{children:"inspectProviders()"})," (re-exported from ",(0,s.jsx)(n.code,{children:"package:routed/routed.dart"}),") to retrieve the same metadata the CLI prints. Every entry exposes the provider id, description, defaults, and documentation payload contributed through ",(0,s.jsx)(n.code,{children:"ConfigDocEntry"}),". This is handy when you want to surface inline help in an IDE, validate manifests in CI, or snapshot defaults for dashboards without shelling out:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-dart",children:"import 'package:routed/routed.dart';\n\nfinal providers = await inspectProviders();\nfor (final provider in providers) {\n  logger.info('${provider.id} -> ${provider.description}');\n  for (final doc in provider.docs) {\n    logger.debug('${doc.path}: ${doc.description}', {\n      'default': doc.defaultValue,\n      'options': doc.resolveOptions(),\n      'metadata': doc.metadata,\n    });\n  }\n}\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Because providers now declare comprehensive documentation metadata, the CLI (",(0,s.jsx)(n.code,{children:"provider:list --config"}),") and your own tooling receive the same structured view of every config knob\u2014no more guessing which keys exist or what types they expect."]}),"\n",(0,s.jsxs)(n.h3,{id:"default-configuration--providesdefaultconfig",children:["Default configuration & ",(0,s.jsx)(n.code,{children:"ProvidesDefaultConfig"})]}),"\n",(0,s.jsxs)(n.p,{children:["Providers advertise their defaults by mixing in ",(0,s.jsx)(n.code,{children:"ProvidesDefaultConfig"}),". During boot the ",(0,s.jsx)(n.code,{children:"ConfigRegistry"})," collects every provider\u2019s defaults and merges them before the loader runs. This keeps package defaults discoverable and prevents \u201cfirst boot\u201d errors when a user forgets to set up required configuration."]}),"\n",(0,s.jsxs)(n.p,{children:["If you ship a package with its own provider, override ",(0,s.jsx)(n.code,{children:"configSource"})," so the CLI can attribute defaults properly:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-dart",children:"class MailProvider extends ServiceProvider with ProvidesDefaultConfig {\n  @override\n  String get configSource => 'my_package.mail';\n\n  @override\n  Map<String, dynamic> get defaultConfig => const {\n    'mail': {\n      'host': 'localhost',\n      'port': 2525,\n    },\n  };\n}\n"})}),"\n",(0,s.jsxs)(n.h3,{id:"validation--providerconfigexception",children:["Validation & ",(0,s.jsx)(n.code,{children:"ProviderConfigException"})]}),"\n",(0,s.jsx)(n.p,{children:"Each built-in provider validates its portion of the manifest. Examples include:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"uploads.max_memory"})," / ",(0,s.jsx)(n.code,{children:"uploads.max_file_size"})," must be integers."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"cors.allowed_origins"}),", ",(0,s.jsx)(n.code,{children:"logging.request_headers"}),", ",(0,s.jsx)(n.code,{children:"security.trusted_proxies.proxies"}),", and ",(0,s.jsx)(n.code,{children:"static.mounts[].disk"})," must be non-empty strings."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"cache.default"})," must be a string that references a store defined under ",(0,s.jsx)(n.code,{children:"cache.stores"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"view.engine"}),", ",(0,s.jsx)(n.code,{children:"view.directory"}),", and ",(0,s.jsx)(n.code,{children:"view.disk"})," must be strings; ",(0,s.jsx)(n.code,{children:"view.cache"})," must be a boolean."]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["If any value fails validation the provider throws ",(0,s.jsx)(n.code,{children:"ProviderConfigException"})," before boot completes. Running ",(0,s.jsx)(n.code,{children:"provider:list --config"})," is the quickest way to surface these issues during development."]}),"\n",(0,s.jsx)(n.h3,{id:"liquid-templating-in-config-files",children:"Liquid templating in config files"}),"\n",(0,s.jsxs)(n.p,{children:["Every file under ",(0,s.jsx)(n.code,{children:"config/"})," is rendered with ",(0,s.jsx)(n.a,{href:"https://pub.dev/packages/liquify",children:"Liquify"})," before it is decoded. That means you can pull in values from ",(0,s.jsx)(n.code,{children:".env"}),", the system environment, or runtime overrides without hand-writing string replacements."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-dotenv",metastring:'title=".env"',children:"APP__NAME=Liquid Config Demo\nAPP__DEBUG=true\nMAIL__HOST=smtp.internal\nMAIL__CREDENTIALS__USERNAME=config-demo\nSESSION__CONFIG__APP_KEY=base64:abc123...\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",metastring:'title="config/mail.yaml"',children:"driver: smtp\nhost: \"{{ mail.host | default: 'localhost' }}\"\nport: {{ mail.port | default: 2525 }}\nfrom: \"{{ mail.from | default: 'noreply@example.dev' }}\"\ncredentials:\n  username: \"{{ mail.credentials.username | default: 'demo' }}\"\n  password: \"{{ mail.credentials.password | default: 'secret' }}\"\n"})}),"\n",(0,s.jsx)(n.p,{children:"The loader builds a template context that includes:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["every key from ",(0,s.jsx)(n.code,{children:".env"})," files"]}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"Platform.environment"})}),"\n",(0,s.jsxs)(n.li,{children:["overrides passed to ",(0,s.jsx)(n.code,{children:"ConfigLoader.load"})," (strings and primitive values are available to filters)"]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["Keys land in the template exactly as they are defined and are additionally mirrored under the ",(0,s.jsx)(n.code,{children:"env.*"})," namespace. A plain environment variable (",(0,s.jsx)(n.code,{children:"APP_KEY"}),") is therefore available as both ",(0,s.jsx)(n.code,{children:"{{ APP_KEY }}"})," and ",(0,s.jsx)(n.code,{children:"{{ env.APP_KEY }}"}),". When a key contains ",(0,s.jsx)(n.strong,{children:"double underscores"}),", the loader also publishes a dotted alias: ",(0,s.jsx)(n.code,{children:"SESSION__CONFIG__APP_KEY"})," becomes accessible as ",(0,s.jsx)(n.code,{children:"{{ SESSION__CONFIG__APP_KEY }}"}),", ",(0,s.jsx)(n.code,{children:"{{ env.SESSION__CONFIG__APP_KEY }}"}),", and ",(0,s.jsx)(n.code,{children:"{{ env.session.config.app_key }}"}),". This allows you to mix legacy uppercase names with Liquid\u2019s nested lookups without losing the original form."]}),"\n",(0,s.jsxs)(n.p,{children:["Keys without double underscores are ",(0,s.jsx)(n.strong,{children:"not"})," modified beyond the ",(0,s.jsx)(n.code,{children:"env.*"})," mirror\u2014if you rely on the single-token name, reference ",(0,s.jsx)(n.code,{children:"{{ APP_KEY }}"})," or ",(0,s.jsx)(n.code,{children:"{{ env.APP_KEY }}"}),". Conversely, if you only want the dotted form in templates, define the double-underscore version in ",(0,s.jsx)(n.code,{children:".env"})," and rely on the alias inside your YAML."]}),"\n",(0,s.jsxs)(n.p,{children:["When you need list lookups, use bracket notation: ",(0,s.jsx)(n.code,{children:"{{ static.mounts[0].route }}"})," fetches the first mount even if the value came from ",(0,s.jsx)(n.code,{children:"STATIC__MOUNTS__0__ROUTE"})," in ",(0,s.jsx)(n.code,{children:".env"}),"."]}),"\n",(0,s.jsxs)(n.p,{children:["Standard Liquid filters are available too, which makes it easy to define fallbacks: ",(0,s.jsx)(n.code,{children:"{{ mail.host | default: 'localhost' }}"}),". If rendering fails the loader now throws a ",(0,s.jsx)(n.code,{children:"FormatException"})," pointing at the failing file, so mistakes surface quickly during boot."]}),"\n",(0,s.jsx)(n.h2,{id:"engine-feature-flags",children:"Engine feature flags"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"EngineConfig.features"})," enables coarse-grained behaviour (security middleware, proxy support, trusted platform headers). Configure them programmatically:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-dart",children:"final engine = Engine(\n  config: EngineConfig(\n    features: const EngineFeatures(\n      enableSecurityFeatures: true,\n      enableProxySupport: true,\n      enableTrustedPlatform: true,\n    ),\n  ),\n);\n"})}),"\n",(0,s.jsx)(n.p,{children:"Or toggle them in the manifest:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",metastring:'title="config/http.yaml"',children:"http:\n  features:\n    security: { enabled: true }\n    proxy: { enabled: true }\n    trusted_platform: { enabled: true }\n"})}),"\n",(0,s.jsxs)(n.p,{children:["The providers honour these flags when deciding whether to run (for example, ",(0,s.jsx)(n.code,{children:"routed.security"})," checks ",(0,s.jsx)(n.code,{children:"enableSecurityFeatures"}),")."]}),"\n",(0,s.jsx)(n.h2,{id:"application-keys--secrets",children:"Application keys & secrets"}),"\n",(0,s.jsx)(n.p,{children:"Many providers (sessions, HMAC signing, encrypted cookies) rely on a shared application key. Declare it once and reference it where needed:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",metastring:'title="config/http.yaml"',children:'app:\n  key: "{{ session.config.app_key }}"\n\nsession:\n  config:\n    app_key: "{{ session.config.app_key }}"\n'})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-dotenv",metastring:'title=".env"',children:"SESSION__CONFIG__APP_KEY=base64:Z0x2...   # generate with `dart run routed_cli key:generate`\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Keep the actual value in ",(0,s.jsx)(n.code,{children:".env"}),"/deployment secrets. The loader exposes both ",(0,s.jsx)(n.code,{children:"SESSION__CONFIG__APP_KEY"})," and ",(0,s.jsx)(n.code,{children:"session.config.app_key"}),", so providers can reference whichever shape is most convenient. The core provider merges ",(0,s.jsx)(n.code,{children:"app.key"})," into ",(0,s.jsx)(n.code,{children:"EngineConfig.appKey"})," so other services can reuse it."]}),"\n",(0,s.jsx)(n.h2,{id:"accessing-configuration-in-code",children:"Accessing configuration in code"}),"\n",(0,s.jsx)(n.p,{children:"Routed exposes several helpers that respect the current zone/request scope:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-dart",children:"import 'package:routed/routed.dart';\n\nrouter.get('/info', (ctx) async {\n  final name = configValue<String>('app.name');      // Reads from Config.current\n  final env = Config.current.getOrThrow<String>('app.env');\n\n  ctx.json({\n    'app': name,\n    'environment': env,\n    'requestId': ctx.request.id,\n  });\n});\n"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"configValue<T>(key, [default])"})," and ",(0,s.jsx)(n.code,{children:"configValueOrThrow<T>(key)"})," wrap ",(0,s.jsx)(n.code,{children:"Config.current"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"Config.current"})," resolves the request-scoped clone when inside a handler, otherwise the root application config."]}),"\n",(0,s.jsxs)(n.li,{children:["The raw container binding remains available via ",(0,s.jsx)(n.code,{children:"await ctx.container.make<Config>()"}),"."]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"scoped-overrides-for-tests-and-tooling",children:"Scoped overrides for tests and tooling"}),"\n",(0,s.jsxs)(n.p,{children:["Use ",(0,s.jsx)(n.code,{children:"Config.runWith"})," to install a temporary configuration for the duration of an operation. The previous value\nis restored automatically, and request containers see the override as well."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-dart",children:"final override = ConfigImpl({'app': {'name': 'Override'}});\n\nawait Config.runWith(override, () async {\n  expect(configValue<String>('app.name'), equals('Override'));\n  // perform test logic ...\n});\n\nexpect(configValue<String>('app.name'), equals('Routed App'));\n"})}),"\n",(0,s.jsx)(n.p,{children:"This is ideal for integration tests and background scripts that need to impersonate a tenant or toggle features."}),"\n",(0,s.jsx)(n.h2,{id:"listening-to-configuration-events",children:"Listening to configuration events"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"Engine"})," publishes two configuration events through the shared ",(0,s.jsx)(n.code,{children:"EventManager"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"ConfigLoadedEvent"})," \u2013 fired once after the initial boot."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"ConfigReloadedEvent"})," \u2013 fired whenever the loader reloads (for example, file watcher reloads) or you call ",(0,s.jsx)(n.code,{children:"engine.replaceConfig"})," manually. Metadata passed to ",(0,s.jsx)(n.code,{children:"replaceConfig(metadata: {...})"})," is forwarded on the event."]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-dart",children:"final events = await engine.make<EventManager>();\n\nevents.on<ConfigLoadedEvent>().listen((event) {\n  logger.info('Config loaded: \\\\n${event.config.all()}');\n});\n\nevents.on<ConfigReloadedEvent>().listen((event) {\n  cacheWarmers.refresh(event.config);\n  auditLog.record('config_reload', event.metadata);\n});\n"})}),"\n",(0,s.jsx)(n.p,{children:"These events make it easy to refresh caches, rebuild dependent services, or emit telemetry whenever configuration changes."}),"\n",(0,s.jsx)(n.h2,{id:"engineconfig-reference",children:"EngineConfig reference"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"EngineConfig"})," still governs framework behaviour (routing, security, file uploads, etc.). The sections below\ncover the most common options."]}),"\n",(0,s.jsx)(n.h3,{id:"file-system-configuration",children:"File system configuration"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-dart",children:"import 'package:file/file.dart';\nimport 'package:file/memory.dart' as memory;\nimport 'package:file/local.dart' as local;\n\n// Use local file system (default)\nfinal engine = Engine(\n  config: EngineConfig(\n    fileSystem: const local.LocalFileSystem()\n  )\n);\n\n// Use memory file system (for testing)\nfinal testEngine = Engine(\n  config: EngineConfig(\n    fileSystem: memory.MemoryFileSystem()\n  )\n);\n\n// Custom file system implementation\nclass CustomFileSystem implements FileSystem {\n  // Implement required methods...\n}\n\nfinal customEngine = Engine(\n  config: EngineConfig(\n    fileSystem: CustomFileSystem()\n  )\n);\n"})}),"\n",(0,s.jsx)(n.h3,{id:"request-size--uploads",children:"Request size & uploads"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-dart",children:"final engine = Engine(\n  config: EngineConfig(\n    security: const EngineSecurityFeatures(\n      maxRequestSize: 10 * 1024 * 1024, // 10MB body limit\n    ),\n    multipart: MultipartConfig(\n      maxMemory: 32 * 1024 * 1024,\n      maxFileSize: 50 * 1024 * 1024,\n      allowedExtensions: {'.jpg', '.pdf'},\n    ),\n    redirectTrailingSlash: true,\n    handleMethodNotAllowed: true, // Return 405 with Allow header; see engine.allowedMethods('/path')\n    templateDirectory: 'views',\n    forwardedByClientIP: true,\n    remoteIPHeaders: const ['X-Forwarded-For', 'X-Real-IP'],\n  ),\n  options: [withTrustedProxies(['10.0.0.0/8'])],\n);\n"})}),"\n",(0,s.jsx)(n.h3,{id:"functional-configuration",children:"Functional configuration"}),"\n",(0,s.jsx)(n.p,{children:"Use functional options for cleaner configuration:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-dart",children:"final engine = Engine(\n  options: [\n    // Configure trusted proxies\n    withTrustedProxies(['10.0.0.0/8']),\n    \n    // Configure routing behavior\n    // engine.route(name, params) validates placeholders (missing/extra params throw)\n    withRedirectTrailingSlash(true),\n    withHandleMethodNotAllowed(true), // enables 405 + Allow; inspect allowed methods via engine.allowedMethods('/path')\n    \n    // Add global middleware\n    withMiddleware([loggerMiddleware, corsMiddleware]),\n    \n    // Configure multipart\n    withMultipart(\n      maxMemory: 32 * 1024 * 1024,\n      maxFileSize: 10 * 1024 * 1024,\n      allowedExtensions: {'.jpg', '.png', '.pdf'}\n    ),\n    \n    // Configure cache\n    withCacheManager(cacheManager),\n    \n    // Configure sessions\n    withSessionConfig(SessionConfig.cookie(\n      appKey: 'your-secret-key'\n    ))\n  ]\n);\n"})}),"\n",(0,s.jsx)(n.h3,{id:"view-engine-configuration",children:"View engine configuration"}),"\n",(0,s.jsxs)(n.p,{children:["Liquid templates are available by default, and the view provider reads its settings from the ",(0,s.jsx)(n.code,{children:"view.*"})," namespace. Pair it with the storage provider so template directories resolve through named disks:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",metastring:'title="config/http.yaml"',children:"storage:\n  default: app\n  disks:\n    app:\n      driver: local\n      root: resources\n\nview:\n  engine: liquid\n  disk: app        # optional; defaults to the storage.default disk\n  directory: views # resolved relative to the selected disk\n  cache: true      # disable in development to pick up template changes instantly\n"})}),"\n",(0,s.jsx)(n.p,{children:"Bootstrap the engine with the same structure when supplying configuration imperatively:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-dart",children:"final engine = Engine(\n  configItems: {\n    'storage': {\n      'default': 'app',\n      'disks': {\n        'app': {'driver': 'local', 'root': 'resources'},\n      },\n    },\n    'view': {\n      'engine': 'liquid',\n      'disk': 'app',\n      'directory': 'views',\n      'cache': true,\n    },\n  },\n);\nawait engine.initialize();\n"})}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"directory"})," value is resolved relative to the chosen disk (set it to an empty string to use the disk root). Toggle ",(0,s.jsx)(n.code,{children:"view.cache"})," to control the ",(0,s.jsx)(n.code,{children:"ViewConfig.cache"})," flag (helpful when hot-reloading templates in development). You can still call ",(0,s.jsx)(n.code,{children:"engine.useViewEngine(...)"})," later if you need to swap in a custom renderer or supply a bespoke file system:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-dart",children:"engine.useViewEngine(\n  LiquidViewEngine(\n    root: LiquidRoot(fileSystem: myFileSystem),\n    directory: 'emails',\n  ),\n);\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Import ",(0,s.jsx)(n.code,{children:"package:routed/template.dart"})," to access ",(0,s.jsx)(n.code,{children:"LiquidViewEngine"})," and ",(0,s.jsx)(n.code,{children:"LiquidRoot"})," in code samples."]}),"\n",(0,s.jsxs)(n.p,{children:["When watch mode is enabled (",(0,s.jsx)(n.code,{children:"ConfigLoaderOptions.watch: true"}),") a change to ",(0,s.jsx)(n.code,{children:"config/"})," or ",(0,s.jsx)(n.code,{children:".env"})," files triggers ",(0,s.jsx)(n.code,{children:"ConfigReloadedEvent"}),"; the view provider listens for the event and reapplies ",(0,s.jsx)(n.code,{children:"view.*"})," settings so disk/directory/cache tweaks take effect without restarting the server."]}),"\n",(0,s.jsx)(n.h3,{id:"file-upload-configuration",children:"File Upload Configuration"}),"\n",(0,s.jsxs)(n.p,{children:["Configure multipart file handling either declaratively or via ",(0,s.jsx)(n.code,{children:"EngineConfig"}),". In ",(0,s.jsx)(n.code,{children:"config/http.yaml"})," define limits under ",(0,s.jsx)(n.code,{children:"uploads.*"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",metastring:'title="config/http.yaml"',children:"uploads:\n  max_memory: 33554432        # bytes held in memory before spilling to disk\n  max_file_size: 10485760\n  allowed_extensions: ['jpg', 'png', 'pdf']\n  directory: uploads\n  file_permissions: 493        # octal 0755\n"})}),"\n",(0,s.jsxs)(n.p,{children:["At runtime you can mutate these values using ",(0,s.jsx)(n.code,{children:"engine.replaceConfig"})," or override them in code:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-dart",children:"final config = EngineConfig(\n  multipart: MultipartConfig(\n    // Maximum memory usage\n    maxMemory: 32 * 1024 * 1024,  // 32MB\n    \n    // Maximum file size\n    maxFileSize: 10 * 1024 * 1024, // 10MB\n    \n    // Allowed file types\n    allowedExtensions: {'jpg', 'png', 'pdf'},\n    \n    // Upload directory\n    uploadDirectory: 'uploads',\n    \n    // File permissions\n    filePermissions: 0750\n  )\n);\n"})}),"\n",(0,s.jsx)(n.h3,{id:"static-assets",children:"Static assets"}),"\n",(0,s.jsx)(n.p,{children:"Static files can now be configured declaratively. Enable the static provider and describe the mounts you want to expose:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",metastring:'title="config/http.yaml"',children:"storage:\n  default: assets\n  disks:\n    assets:\n      driver: local\n      root: public/assets\n\nstatic:\n  enabled: true\n  mounts:\n    - route: /assets\n      disk: assets\n      path: ''          # empty path serves the disk root\n      index: index.html\n      list_directories: false\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Each mount maps a request prefix (",(0,s.jsx)(n.code,{children:"route"}),") to a location managed by the storage provider. Provide ",(0,s.jsx)(n.code,{children:"disk"})," to reuse a configured storage disk and set ",(0,s.jsx)(n.code,{children:"path"})," relative to that disk (the legacy ",(0,s.jsx)(n.code,{children:"directory"})," key is still honoured). When ",(0,s.jsx)(n.code,{children:"index"})," is set, requests that land on the mount root (or a directory ending with a trailing slash) will serve that file. Enable ",(0,s.jsx)(n.code,{children:"list_directories"})," to render directory listings when no index is available."]}),"\n",(0,s.jsxs)(n.p,{children:["You can toggle mounts at runtime via ",(0,s.jsx)(n.code,{children:"EngineOpt.withStaticAssets"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-dart",children:"engine = Engine(\n  options: [\n    withStaticAssets(\n      enabled: true,\n      route: '/assets',\n      mounts: [\n        {\n          'route': '/assets',\n          'disk': 'assets',\n          'path': '',\n          'index': 'index.html',\n          'list_directories': false,\n        },\n      ],\n    ),\n  ],\n);\n"})}),"\n",(0,s.jsx)(n.p,{children:"Configuration reloads update the static middleware without restarting the engine."}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsxs)(n.p,{children:["Programmatic overrides can supply a custom ",(0,s.jsx)(n.code,{children:"file_system"})," (and optional ",(0,s.jsx)(n.code,{children:"root"}),") when mounting assets. This is useful for in-memory fixtures during tests or when embedding templates from a virtual file system."]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"storage-disks",children:"Storage disks"}),"\n",(0,s.jsx)(n.p,{children:"Static mounts, uploads, and other providers rely on the storage subsystem. Configure disks once and reference them by name across your app:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",metastring:'title="config/http.yaml"',children:"storage:\n  default: local\n  root: \"{{ env.STORAGE_ROOT | default: 'storage/app' }}\"\n  disks:\n    local:\n      driver: local\n    assets:\n      driver: local\n      root: public/assets\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Each disk describes a driver plus its root directory. The built-in ",(0,s.jsx)(n.code,{children:"local"})," driver reads from the host file system and honours the engine's file-system abstraction, making it easy to stub out storage when testing. Retrieve an absolute path at runtime with the ",(0,s.jsx)(n.code,{children:"StorageManager"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-dart",children:"final storage = await engine.make<StorageManager>();\nfinal absolutePath = storage.resolve('logo.png', disk: 'assets');\n"})}),"\n",(0,s.jsxs)(n.p,{children:["The storage provider feeds other subsystems automatically: set ",(0,s.jsx)(n.code,{children:"view.disk"})," to back templates with a named disk and reference the same disks from static mounts (",(0,s.jsx)(n.code,{children:"static.mounts[].disk"}),") or uploads."]}),"\n",(0,s.jsxs)(n.p,{children:["Use the top-level ",(0,s.jsx)(n.code,{children:"storage.root"})," key (or the ",(0,s.jsx)(n.code,{children:"STORAGE_ROOT"})," environment variable exposed in new projects) to move the baseline path for the built-in ",(0,s.jsx)(n.code,{children:"local"})," disk without editing every disk entry. If you omit the entire ",(0,s.jsx)(n.code,{children:"storage"})," section the provider still seeds a default ",(0,s.jsx)(n.code,{children:"local"})," disk, but its root now derives from ",(0,s.jsx)(n.code,{children:"storage.root"})," (defaulting to ",(0,s.jsx)(n.code,{children:"storage/app"}),")."]}),"\n",(0,s.jsxs)(n.p,{children:["Cloud storage is available out of the box through the ",(0,s.jsx)(n.code,{children:"s3"})," driver (and aliases like ",(0,s.jsx)(n.code,{children:"minio"}),", ",(0,s.jsx)(n.code,{children:"spaces"}),", and ",(0,s.jsx)(n.code,{children:"r2"}),"). Configure credentials under ",(0,s.jsx)(n.code,{children:"options"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",metastring:'title="S3-compatible disk"',children:'storage:\n  default: local\n  cloud: s3\n  disks:\n    local:\n      driver: local\n      root: storage/app\n    s3:\n      driver: s3\n      options:\n        endpoint: s3.amazonaws.com\n        key: "{{ env.AWS_ACCESS_KEY_ID }}"\n        secret: "{{ env.AWS_SECRET_ACCESS_KEY }}"\n        bucket: my-app-assets\n        use_ssl: true\n        region: us-east-1\n'})}),"\n",(0,s.jsxs)(n.p,{children:["The provider also boots the ",(0,s.jsxs)(n.a,{href:"https://pub.dev/packages/storage_fs",children:[(0,s.jsx)(n.code,{children:"Storage"})," facade"]}),", so code that prefers a Laravel-style API can call it directly:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-dart",children:"await Storage.put('reports/summary.txt', 'Quarterly results');\nfinal downloadUrl = await Storage.cloud().getTemporaryUrl(\n  'reports/summary.txt',\n  DateTime.now().add(Duration(minutes: 10)),\n);\n"})}),"\n",(0,s.jsxs)(n.p,{children:["To add new drivers, call ",(0,s.jsx)(n.code,{children:"StorageServiceProvider.registerDriver"})," before boot (or inside a service provider). Provide a builder that returns a ",(0,s.jsx)(n.code,{children:"StorageDisk"})," and optionally a ",(0,s.jsx)(n.code,{children:"documentation"})," callback that returns ",(0,s.jsx)(n.code,{children:"ConfigDocEntry"})," items. Those entries feed ",(0,s.jsx)(n.code,{children:"provider:list --config"})," and appear beside the built-in docs under ",(0,s.jsx)(n.code,{children:"storage.disks.*"}),", so teams know which extra keys your driver accepts."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-dart",children:"StorageServiceProvider.registerDriver(\n  'dropbox',\n  (context) => DropboxDisk(\n    token: context.option<String>('token')!,\n    root: context.option<String>('root') ?? '/app',\n  ),\n  documentation: (ctx) => <ConfigDocEntry>[\n    ConfigDocEntry(\n      path: ctx.path('token'),\n      type: 'string',\n      description: 'Access token used to authenticate Dropbox requests.',\n    ),\n    ConfigDocEntry(\n      path: ctx.path('root'),\n      type: 'string',\n      description: 'Remote folder that acts as the disk root.',\n    ),\n  ],\n);\n"})}),"\n",(0,s.jsxs)(n.p,{children:["The built-in ",(0,s.jsx)(n.code,{children:"local"})," driver is registered the same way, so overrides and custom drivers exercise the identical code paths."]}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsxs)(n.p,{children:["Need a bigger picture? Check ",(0,s.jsx)(n.a,{href:"/docs/routed/advanced/driver-registries",children:"Driver Registries"})," for patterns that apply across storage, cache, and session subsystems."]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"routed provider:driver storage my_driver\n"})}),"\n",(0,s.jsxs)(n.p,{children:["The CLI writes a starter file to ",(0,s.jsx)(n.code,{children:"lib/drivers/storage/"}),", including the boilerplate ",(0,s.jsx)(n.code,{children:"registerDriver"})," call and documentation callback."]}),"\n",(0,s.jsx)(n.h3,{id:"session-configuration",children:"Session Configuration"}),"\n",(0,s.jsx)(n.h4,{id:"cookie-based-sessions",children:"Cookie-based Sessions"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-dart",children:"final config = EngineConfig(\n  sessionConfig: SessionConfig.cookie(\n    appKey: 'your-secret-key',\n    cookieName: 'app_session',\n    maxAge: Duration(hours: 24)\n  )\n);\n"})}),"\n",(0,s.jsx)(n.h4,{id:"file-based-sessions",children:"File-based Sessions"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-dart",children:"final config = EngineConfig(\n  sessionConfig: SessionConfig.file(\n    appKey: 'your-secret-key',\n    storagePath: 'sessions',\n    cookieName: 'app_session',\n    maxAge: Duration(hours: 24)\n  )\n);\n"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsxs)(n.p,{children:["Store secrets in the manifest via Liquid placeholders (for example ",(0,s.jsx)(n.code,{children:'session.config.app_key: "{{ session.config.app_key }}"'})," and ",(0,s.jsx)(n.code,{children:'app.key: "{{ session.config.app_key }}"'}),"). Keep the actual key in ",(0,s.jsx)(n.code,{children:".env"})," as ",(0,s.jsx)(n.code,{children:"SESSION__CONFIG__APP_KEY"})," and generate it with ",(0,s.jsx)(n.code,{children:"dart run routed_cli key:generate"}),"."]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"custom-template-engines",children:"Custom template engines"}),"\n",(0,s.jsxs)(n.p,{children:["Swap out Liquid entirely by registering your own ",(0,s.jsx)(n.code,{children:"ViewEngine"})," implementation:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-dart",children:"engine.useViewEngine(\n  JinjaTemplateEngine(fileSystem: myFileSystem),\n  directory: 'templates',\n);\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Pair this with the ",(0,s.jsx)(n.code,{children:"view.*"})," config (or ",(0,s.jsx)(n.code,{children:"withStaticAssets"}),"/",(0,s.jsx)(n.code,{children:"storage.*"}),") so the rest of the ecosystem keeps using the same disks and cache settings."]}),"\n",(0,s.jsxs)(n.p,{children:["If you\u2019re migrating from older codebases you can still rely on the legacy ",(0,s.jsx)(n.code,{children:"templateDirectory"})," / ",(0,s.jsx)(n.code,{children:"templateEngine"})," fields on ",(0,s.jsx)(n.code,{children:"EngineConfig"}),", but we recommend converging on the provider + disk approach to keep configuration centralised."]}),"\n",(0,s.jsx)(n.h3,{id:"file-system-abstraction",children:"File system abstraction"}),"\n",(0,s.jsx)(n.p,{children:"All providers share the same file system. Swap it out during tests:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-dart",children:"final engine = Engine(\n  config: EngineConfig(fileSystem: memory.MemoryFileSystem.test()),\n);\n"})}),"\n",(0,s.jsx)(n.p,{children:"Storage disks, static assets, and view lookups honour this setting."}),"\n",(0,s.jsx)(n.h3,{id:"routing-configuration",children:"Routing Configuration"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-dart",children:"final config = EngineConfig(\n  // URL handling\n  redirectTrailingSlash: true,   // /about/ -> /about\n  redirectFixedPath: false,      // Remove duplicate slashes\n  removeExtraSlash: false,       // /path//to -> /path/to\n  \n  // Path handling\n  useRawPath: false,            // Use raw URL path\n  unescapePathValues: true,     // Unescape URL values\n  \n  // Error handling\n  handleMethodNotAllowed: true   // Return 405 with Allow header; use engine.allowedMethods('/path')\n);\n"})}),"\n",(0,s.jsx)(n.p,{children:"Manifest equivalent:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",metastring:'title="config/http.yaml"',children:"routing:\n  redirect_trailing_slash: true\n  handle_method_not_allowed: true\n  remove_extra_slash: false\n  use_raw_path: false\n  unescape_path_values: true\n"})}),"\n",(0,s.jsx)(n.h3,{id:"logging-configuration",children:"Logging configuration"}),"\n",(0,s.jsxs)(n.p,{children:["Drive the logging middleware from configuration or ",(0,s.jsx)(n.code,{children:"EngineOpt.withLogging"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",metastring:'title="config/http.yaml"',children:"logging:\n  enabled: true\n  level: debug        # info (default) or debug\n  errors_only: false  # only log failing requests when true\n  include_stack_traces: false\n  extra_fields:\n    service: api\n    deployment: production\n  request_headers: X-Correlation-ID, X-Trace\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-dart",children:"final engine = Engine(\n  options: [\n    withLogging(\n      level: 'debug',\n      errorsOnly: true,\n      extraFields: {'service': 'api'},\n      requestHeaders: ['X-Correlation-ID', 'X-Trace'],\n    ),\n  ],\n);\n"})}),"\n",(0,s.jsxs)(n.p,{children:["When ",(0,s.jsx)(n.code,{children:"logging.enabled"})," is ",(0,s.jsx)(n.code,{children:"false"})," the HTTP logging middleware short-circuits. Set ",(0,s.jsx)(n.code,{children:"errors_only"})," to ",(0,s.jsx)(n.code,{children:"true"})," to suppress successful request logs while still capturing errors, use ",(0,s.jsx)(n.code,{children:"logging.level"})," to flip between ",(0,s.jsx)(n.code,{children:"info"})," and ",(0,s.jsx)(n.code,{children:"debug"})," output, attach constant metadata via ",(0,s.jsx)(n.code,{children:"extra_fields"}),", surface request metadata (like correlation ids) with ",(0,s.jsx)(n.code,{children:"request_headers"}),", and flip ",(0,s.jsx)(n.code,{children:"include_stack_traces"})," to ",(0,s.jsx)(n.code,{children:"true"})," temporarily when you want full stack traces in error logs."]}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsxs)(n.p,{children:["Validation: Providers fail fast when configuration has the wrong shape. Logging rejects non-string ",(0,s.jsx)(n.code,{children:"request_headers"}),", uploads insist on integer limits and string extensions, CORS only accepts string origins/methods, security guards max request sizes / CSRF flags / trusted proxy lists, cache requires map-shaped stores, views expect string directories/disks/engine names, and static/storage modules apply the same scrutiny. Any mismatch throws a ",(0,s.jsx)(n.code,{children:"ProviderConfigException"})," with the offending path so you can spot and correct the bad value before the engine finishes booting."]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"proxy-configuration",children:"Proxy Configuration"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-dart",children:"final config = EngineConfig(\n  // Trust forwarded headers\n  forwardedByClientIP: true,\n  \n  // Headers to check for real IP\n  remoteIPHeaders: [\n    'X-Forwarded-For',\n    'X-Real-IP'\n  ],\n  \n  // Trusted proxy IPs/ranges\n  trustedProxies: [\n    '127.0.0.1',\n    '10.0.0.0/8',\n    '172.16.0.0/12'\n  ]\n);\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Equivalent manifest (",(0,s.jsx)(n.code,{children:"security.trusted_proxies"}),"):"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",metastring:'title="config/http.yaml"',children:"security:\n  trusted_proxies:\n    enabled: true\n    forward_client_ip: true\n    proxies: ['127.0.0.1', '10.0.0.0/8', '172.16.0.0/12']\n    headers: ['X-Forwarded-For', 'X-Real-IP']\n    platform_header: CF-Connecting-IP\n"})}),"\n",(0,s.jsx)(n.h3,{id:"cache-configuration",children:"Cache Configuration"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-dart",children:"final config = EngineConfig(\n  cacheManager: CacheManager()\n    ..registerStore('array', {\n      'driver': 'array',\n      'serialize': false\n    })\n    ..registerStore('file', {\n      'driver': 'file',\n      'path': 'cache'\n    })\n);\n"})}),"\n",(0,s.jsx)(n.h2,{id:"engine-configuration-reference",children:"Engine configuration reference"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Concern"}),(0,s.jsxs)(n.th,{children:["Configure via ",(0,s.jsx)(n.code,{children:"config/http.yaml"})]}),(0,s.jsx)(n.th,{children:"Configure programmatically"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Security middleware"}),(0,s.jsxs)(n.td,{children:[(0,s.jsx)(n.code,{children:"security.headers"}),", ",(0,s.jsx)(n.code,{children:"security.csrf.*"}),", ",(0,s.jsx)(n.code,{children:"security.max_request_size"}),", ",(0,s.jsx)(n.code,{children:"security.ip_filter.*"})]}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"EngineConfig(features: EngineFeatures(enableSecurityFeatures: true))"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Proxy support"}),(0,s.jsxs)(n.td,{children:[(0,s.jsx)(n.code,{children:"security.trusted_proxies.enabled"}),", ",(0,s.jsx)(n.code,{children:"security.trusted_proxies.*"})]}),(0,s.jsxs)(n.td,{children:[(0,s.jsx)(n.code,{children:"EngineConfig(features: EngineFeatures(enableProxySupport: true))"}),", ",(0,s.jsx)(n.code,{children:"withTrustedProxies([...])"})]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Trusted platform headers"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"security.trusted_proxies.platform_header"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"EngineConfig(features: EngineFeatures(enableTrustedPlatform: true))"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Routing booleans"}),(0,s.jsxs)(n.td,{children:[(0,s.jsx)(n.code,{children:"routing.redirect_trailing_slash"}),", ",(0,s.jsx)(n.code,{children:"routing.handle_method_not_allowed"}),", ",(0,s.jsx)(n.code,{children:"routing.remove_extra_slash"}),", ",(0,s.jsx)(n.code,{children:"routing.use_raw_path"}),", ",(0,s.jsx)(n.code,{children:"routing.unescape_path_values"})]}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"EngineConfig(redirectTrailingSlash: ..., handleMethodNotAllowed: ..., removeExtraSlash: ..., useRawPath: ..., unescapePathValues: ...)"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Routing semantics"}),(0,s.jsxs)(n.td,{children:[(0,s.jsx)(n.code,{children:"routing.default_options"}),", ",(0,s.jsx)(n.code,{children:"routing.etag.strategy"})]}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"EngineConfig(defaultOptionsEnabled: ..., etagStrategy: ...)"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Multipart limits"}),(0,s.jsxs)(n.td,{children:[(0,s.jsx)(n.code,{children:"uploads.max_memory"}),", ",(0,s.jsx)(n.code,{children:"uploads.max_file_size"}),", ",(0,s.jsx)(n.code,{children:"uploads.max_disk_usage"}),", ",(0,s.jsx)(n.code,{children:"uploads.allowed_extensions"}),", ",(0,s.jsx)(n.code,{children:"uploads.directory"}),", ",(0,s.jsx)(n.code,{children:"uploads.file_permissions"})]}),(0,s.jsxs)(n.td,{children:[(0,s.jsx)(n.code,{children:"EngineConfig(multipart: MultipartConfig(...))"}),", ",(0,s.jsx)(n.code,{children:"withMultipart(...)"})]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"HTTP/2"}),(0,s.jsxs)(n.td,{children:[(0,s.jsx)(n.code,{children:"http.http2.enabled"}),", ",(0,s.jsx)(n.code,{children:"http.http2.allow_cleartext"}),", ",(0,s.jsx)(n.code,{children:"http.http2.max_concurrent_streams"}),", ",(0,s.jsx)(n.code,{children:"http.http2.idle_timeout"})]}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"EngineConfig(http2: Http2Config(enabled: true, allowCleartext: ..., maxConcurrentStreams: ..., idleTimeout: ...))"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"TLS certificates"}),(0,s.jsxs)(n.td,{children:[(0,s.jsx)(n.code,{children:"http.tls.certificate_path"}),", ",(0,s.jsx)(n.code,{children:"http.tls.key_path"}),", ",(0,s.jsx)(n.code,{children:"http.tls.password"}),", ",(0,s.jsx)(n.code,{children:"http.tls.request_client_certificate"}),", ",(0,s.jsx)(n.code,{children:"http.tls.shared"}),", ",(0,s.jsx)(n.code,{children:"http.tls.v6_only"})]}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"EngineConfig(tlsCertificatePath: ..., tlsKeyPath: ..., tlsCertificatePassword: ..., tlsRequestClientCertificate: ..., tlsShared: ..., tlsV6Only: ...)"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Rate limiting"}),(0,s.jsxs)(n.td,{children:[(0,s.jsx)(n.code,{children:"rate_limit.enabled"}),", ",(0,s.jsx)(n.code,{children:"rate_limit.backend"}),", ",(0,s.jsx)(n.code,{children:"rate_limit.store"}),", ",(0,s.jsx)(n.code,{children:"rate_limit.policies[*].*"})]}),(0,s.jsxs)(n.td,{children:[(0,s.jsx)(n.code,{children:"RateLimitServiceProvider"})," (middleware auto-registered once enabled); configure policies via config."]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"View directories/cache"}),(0,s.jsxs)(n.td,{children:[(0,s.jsx)(n.code,{children:"view.engine"}),", ",(0,s.jsx)(n.code,{children:"view.disk"}),", ",(0,s.jsx)(n.code,{children:"view.directory"}),", ",(0,s.jsx)(n.code,{children:"view.cache"})," (plus ",(0,s.jsx)(n.code,{children:"storage.*"})," disks)"]}),(0,s.jsxs)(n.td,{children:[(0,s.jsx)(n.code,{children:"EngineConfig(templateDirectory: ..., templateEngine: ...)"}),", ",(0,s.jsx)(n.code,{children:"engine.useViewEngine(...)"})]})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Logging middleware"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"logging.*"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"withLogging(...)"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Cache stores"}),(0,s.jsxs)(n.td,{children:[(0,s.jsx)(n.code,{children:"cache.default"}),", ",(0,s.jsx)(n.code,{children:"cache.stores.*"})]}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"withCacheManager(...)"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Sessions"}),(0,s.jsxs)(n.td,{children:[(0,s.jsx)(n.code,{children:"session.config"})," / ",(0,s.jsx)(n.code,{children:"session"})]}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"withSessionConfig(...)"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Static assets"}),(0,s.jsxs)(n.td,{children:[(0,s.jsx)(n.code,{children:"static.enabled"}),", ",(0,s.jsx)(n.code,{children:"static.mounts[*]"})]}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"withStaticAssets(...)"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"Remote IP headers"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"security.trusted_proxies.headers"})}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"EngineConfig(remoteIPHeaders: [...])"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"File system"}),(0,s.jsx)(n.td,{children:"-- (inherits from environment)"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"EngineConfig(fileSystem: ...)"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"App key"}),(0,s.jsxs)(n.td,{children:[(0,s.jsx)(n.code,{children:"app.key"}),"/",(0,s.jsx)(n.code,{children:"env.APP_KEY"})]}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"EngineConfig(appKey: ...)"})})]})]})]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"dart run routed_cli provider:list --config"})," is a quick way to verify the manifest-driven configuration after edits."]}),"\n",(0,s.jsx)(n.h3,{id:"enable-http2",children:"Enable HTTP/2"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",metastring:'title="config/http.yaml"',children:"http:\n  http2:\n    enabled: true\n    allow_cleartext: false\n    max_concurrent_streams: 256\n    idle_timeout: 30s\n  tls:\n    certificate_path: certs/server.pem\n    key_path: certs/server.key\n    password:\n    request_client_certificate: false\n    shared: false\n    v6_only: false\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-dart",metastring:'title="main.dart"',children:"final engine = Engine(\n  config: EngineConfig(\n    http2: const Http2Config(\n      enabled: true,\n      allowCleartext: false,\n      maxConcurrentStreams: 256,\n      idleTimeout: Duration(seconds: 30),\n    ),\n  ),\n)..get('/', (ctx) => ctx.string('Hello, HTTP/2!'));\n\nawait engine.serveSecure(\n  address: '0.0.0.0',\n  port: 8443,\n  certificatePath: 'certs/server.pem',\n  keyPath: 'certs/server.key',\n);\n"})}),"\n",(0,s.jsx)(n.admonition,{type:"tip",children:(0,s.jsxs)(n.p,{children:["If ",(0,s.jsx)(n.code,{children:"rate_limit.store"})," is omitted the provider looks up ",(0,s.jsx)(n.code,{children:"cache.default"}),". Make sure one of those values is present; otherwise the limiter throws during boot because it cannot find a backing cache store."]})}),"\n",(0,s.jsx)(n.h3,{id:"configure-rate-limiting",children:"Configure rate limiting"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",metastring:'title="config/rate-limiting.yaml"',children:"rate_limit:\n  enabled: true\n  backend: redis          # memory/redis \u2014 must have matching cache store\n  store: redis            # optional; defaults to cache.default when omitted\n  failover: allow         # allow | block | local when the backend is offline\n  policies:\n    - name: api-ip\n      match: GET /api/v1/*\n      strategy: token_bucket\n      key:\n        type: ip\n      capacity: 100\n      interval: 60s\n      burst: 2\n\n    - name: api-user\n      match: /api/v1/*\n      method: POST\n      strategy: sliding_window\n      key:\n        type: header\n        header: x-user-id\n      limit: 20\n      window: 1m\n\ncache:\n  default: file\n  stores:\n    redis:\n      driver: redis\n      url: redis://localhost:6379/2\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-dart",metastring:'title="main.dart"',children:"final engine = Engine();\n\n// The provider compiles policies from configuration. Ensure the feature flag\n// remains enabled (default) so the middleware runs before handlers.\n"})}),"\n",(0,s.jsx)(n.h2,{id:"environment-helper",children:"Environment helper"}),"\n",(0,s.jsxs)(n.p,{children:["Routed includes an ",(0,s.jsx)(n.code,{children:"Environment"})," wrapper that merges system variables with values loaded from ",(0,s.jsx)(n.code,{children:".env"})," files (",(0,s.jsx)(n.code,{children:"packages/routed/lib/src/utils/environment.dart:1"}),"). Use the exported singleton ",(0,s.jsx)(n.code,{children:"env"})," when you want safe reads or in-memory overrides:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-dart",children:"import 'package:routed/routed.dart';\n\nvoid bootstrap() {\n  final appEnv = env['APP_ENV'] ?? 'development';\n  final appKey = env['APP_KEY'] ?? 'development-key';\n\n  env['APP_URL'] ??= 'http://localhost:8080';\n\n  final engine = Engine(\n    config: EngineConfig(\n      appKey: appKey,\n      features: EngineFeatures(enableProxySupport: appEnv == 'production'),\n    ),\n  );\n}\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"Environment"})," exposes ",(0,s.jsx)(n.code,{children:"[]="}),"/",(0,s.jsx)(n.code,{children:"[]"}),", ",(0,s.jsx)(n.code,{children:"set"}),", ",(0,s.jsx)(n.code,{children:"remove"}),", and ",(0,s.jsx)(n.code,{children:"toMap()"})," so tests can override inputs without mutating the real process environment."]}),"\n",(0,s.jsx)(n.h2,{id:"configuration-best-practices",children:"Configuration Best Practices"}),"\n",(0,s.jsx)(n.h2,{id:"development-vs-production",children:"Development vs Production"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-dart",children:"import 'dart:io' show Platform;\n\nEngineConfig createConfig() {\n  final env = Platform.environment['APP_ENV'] ?? 'development';\n  \n  if (env == 'production') {\n    return EngineConfig(\n      // Production settings\n      appKey: Platform.environment['APP_KEY']!,\n      handleMethodNotAllowed: true,\n      forwardedByClientIP: true,\n      trustedProxies: Platform.environment['TRUSTED_PROXIES']?.split(',') ?? [],\n      multipart: MultipartConfig(\n        maxFileSize: 50 * 1024 * 1024,  // 50MB\n        allowedExtensions: {'.jpg', '.pdf', '.png'},\n        uploadDirectory: '/var/www/uploads'\n      ),\n      sessionConfig: SessionConfig.file(\n        appKey: Platform.environment['APP_KEY']!,\n        storagePath: '/var/www/sessions',\n        secure: true\n      )\n    );\n  }\n  \n  // Development settings\n  return EngineConfig(\n    appKey: 'dev-key',\n    handleMethodNotAllowed: false,\n    forwardedByClientIP: false,\n    multipart: MultipartConfig(\n      maxFileSize: 100 * 1024 * 1024,  // 100MB\n      allowedExtensions: {'.*'},  // Allow all extensions\n      uploadDirectory: 'uploads'\n    ),\n    sessionConfig: SessionConfig.cookie(\n      appKey: 'dev-key',\n      secure: false\n    )\n  );\n}\n\nfinal engine = Engine(\n  config: createConfig(),\n  configItems: {\n    'app.env': Platform.environment['APP_ENV'] ?? 'development',\n    'app.debug': Platform.environment['APP_DEBUG'] == 'true'\n  }\n);\n"})}),"\n",(0,s.jsx)(n.h2,{id:"type-safe-configuration",children:"Type-safe Configuration"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-dart",children:"class AppConfig {\n  final String environment;\n  final bool debug;\n  final DatabaseConfig database;\n  final CacheConfig cache;\n  \n  AppConfig({\n    required this.environment,\n    required this.debug,\n    required this.database,\n    required this.cache,\n  });\n  \n  factory AppConfig.fromEnv() {\n    return AppConfig(\n      environment: Platform.environment['APP_ENV'] ?? 'development',\n      debug: Platform.environment['APP_DEBUG'] == 'true',\n      database: DatabaseConfig.fromEnv(),\n      cache: CacheConfig.fromEnv(),\n    );\n  }\n  \n  EngineConfig toEngineConfig() {\n    return EngineConfig(\n      appKey: Platform.environment['APP_KEY'],\n      sessionConfig: createSessionConfig(),\n      multipart: createMultipartConfig(),\n      cacheManager: cache.createManager()\n    );\n  }\n}\n\n// Usage\nfinal appConfig = AppConfig.fromEnv();\nfinal engine = Engine(\n  config: appConfig.toEngineConfig(),\n  configItems: appConfig.toMap()\n);\n"})}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"Use Environment Variables"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-dart",children:"final engine = Engine(\n  config: EngineConfig(\n    appKey: Platform.environment['APP_KEY'],\n    templateDirectory: Platform.environment['TEMPLATE_DIR'] ?? 'templates'\n  )\n);\n"})}),"\n",(0,s.jsxs)(n.ol,{start:"2",children:["\n",(0,s.jsx)(n.li,{children:"Separate Development/Production Configs"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-dart",children:"EngineConfig getConfig(String env) {\n  switch (env) {\n    case 'production':\n      return EngineConfig(\n        handleMethodNotAllowed: true,\n        forwardedByClientIP: true,\n        trustedProxies: ['10.0.0.0/8']\n      );\n      \n    case 'development':\n      return EngineConfig(\n        handleMethodNotAllowed: false,\n        forwardedByClientIP: false,\n        trustedProxies: []\n      );\n      \n    default:\n      throw Exception('Unknown environment: $env');\n  }\n}\n"})}),"\n",(0,s.jsxs)(n.ol,{start:"3",children:["\n",(0,s.jsx)(n.li,{children:"Use Factory Methods"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-dart",children:"class AppConfig {\n  static EngineConfig create() {\n    return EngineConfig(\n      appKey: loadSecretKey(),\n      sessionConfig: createSessionConfig(),\n      multipart: createMultipartConfig(),\n      cacheManager: createCacheManager()\n    );\n  }\n  \n  static SessionConfig createSessionConfig() {\n    return SessionConfig.cookie(\n      appKey: loadSecretKey(),\n      maxAge: Duration(hours: 24)\n    );\n  }\n  \n  // Additional factory methods...\n}\n"})}),"\n",(0,s.jsxs)(n.ol,{start:"4",children:["\n",(0,s.jsx)(n.li,{children:"Validate Configuration"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-dart",children:"void validateConfig(EngineConfig config) {\n  if (config.appKey == null || config.appKey!.isEmpty) {\n    throw Exception('APP_KEY must be set');\n  }\n  \n  if (config.multipart.maxFileSize > 100 * 1024 * 1024) {\n    throw Exception('Maximum file size cannot exceed 100MB');\n  }\n  \n  // Additional validation...\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:"This covers the main configuration options available in Routed. Each section can be further customized based on your application's needs."})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>o,x:()=>d});var r=i(6540);const s={},t=r.createContext(s);function o(e){const n=r.useContext(t);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),r.createElement(t.Provider,{value:n},e.children)}}}]);