"use strict";(self.webpackChunkrouted=self.webpackChunkrouted||[]).push([[8658],{2080:(e,s,t)=>{t.r(s),t.d(s,{assets:()=>a,contentTitle:()=>c,default:()=>h,frontMatter:()=>l,metadata:()=>n,toc:()=>d});const n=JSON.parse('{"id":"server-testing/test-client/test-client","title":"TestClient","description":"Fluent HTTP client that powers serverTest with in-memory and server transports","source":"@site/docs/server-testing/test-client/test-client.mdx","sourceDirName":"server-testing/test-client","slug":"/server-testing/test-client","permalink":"/docs/server-testing/test-client","draft":false,"unlisted":false,"editUrl":"https://github.com/kingwill101/routed/tree/main/docs/docs/server-testing/test-client/test-client.mdx","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"title":"TestClient","description":"Fluent HTTP client that powers serverTest with in-memory and server transports","sidebar_position":1,"slug":"/server-testing/test-client"},"sidebar":"tutorialSidebar","previous":{"title":"CLI","permalink":"/docs/server-testing/cli"},"next":{"title":"TestResponse","permalink":"/docs/server-testing/test-client/test-response"}}');var r=t(4848),i=t(8453);const l={title:"TestClient",description:"Fluent HTTP client that powers serverTest with in-memory and server transports",sidebar_position:1,slug:"/server-testing/test-client"},c="TestClient",a={},d=[{value:"Construction Options",id:"construction-options",level:2},{value:"Request Helpers",id:"request-helpers",level:2},{value:"Multipart Builder",id:"multipart-builder",level:2},{value:"Response Lifecycle",id:"response-lifecycle",level:2},{value:"Tips",id:"tips",level:2}];function o(e){const s={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.header,{children:(0,r.jsx)(s.h1,{id:"testclient",children:"TestClient"})}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.code,{children:"TestClient"})," is the workhorse used by ",(0,r.jsx)(s.code,{children:"serverTest"})," and can be constructed manually when you need finer control."]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-dart",children:"import 'package:shelf/shelf.dart' as shelf;\nimport 'package:server_testing/server_testing.dart';\nimport 'package:server_testing_shelf/server_testing_shelf.dart';\n\nfinal app = (shelf.Request req) async => shelf.Response.ok('ok');\nfinal handler = ShelfRequestHandler(app);\nfinal client = TestClient(handler);            // defaults to in-memory\nfinal serverClient = TestClient.ephemeralServer(handler);\n\nfinal res = await client.get('/');\nres.assertStatus(200).assertBody('ok');\nawait client.close();       // always close manually when not using serverTest\nawait serverClient.close(); // server transport also frees sockets\n"})}),"\n",(0,r.jsx)(s.h2,{id:"construction-options",children:"Construction Options"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"TestClient(handler)"})," or ",(0,r.jsx)(s.code,{children:"TestClient.inMemory(handler)"})," \u2013 in-memory mode."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"TestClient(handler, mode: TransportMode.ephemeralServer)"})," or ",(0,r.jsx)(s.code,{children:"TestClient.ephemeralServer(handler)"})," \u2013 real ",(0,r.jsx)(s.code,{children:"HttpServer"}),"."]}),"\n",(0,r.jsxs)(s.li,{children:["Pass a ",(0,r.jsx)(s.code,{children:"TransportOptions"})," object to tweak defaults (e.g. custom ",(0,r.jsx)(s.code,{children:"remoteAddress"}),")."]}),"\n",(0,r.jsxs)(s.li,{children:["Retrieve the actual base URL in server mode via ",(0,r.jsx)(s.code,{children:"await client.baseUrlFuture"}),"."]}),"\n"]}),"\n",(0,r.jsxs)(s.p,{children:["The client keeps a reference to the ",(0,r.jsx)(s.code,{children:"RequestHandler"}),". When the client is closed it calls ",(0,r.jsx)(s.code,{children:"handler.close()"})," so your adapter can dispose external resources."]}),"\n",(0,r.jsx)(s.h2,{id:"request-helpers",children:"Request Helpers"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.code,{children:"get"}),", ",(0,r.jsx)(s.code,{children:"post"}),", ",(0,r.jsx)(s.code,{children:"put"}),", ",(0,r.jsx)(s.code,{children:"patch"}),", ",(0,r.jsx)(s.code,{children:"delete"}),", ",(0,r.jsx)(s.code,{children:"head"})]}),"\n",(0,r.jsxs)(s.li,{children:["JSON variants: ",(0,r.jsx)(s.code,{children:"getJson"}),", ",(0,r.jsx)(s.code,{children:"postJson"}),", ",(0,r.jsx)(s.code,{children:"putJson"}),", ",(0,r.jsx)(s.code,{children:"patchJson"}),", ",(0,r.jsx)(s.code,{children:"deleteJson"})]}),"\n",(0,r.jsxs)(s.li,{children:["Multipart builder: ",(0,r.jsx)(s.code,{children:"multipart('/upload', (builder) { ... })"})]}),"\n",(0,r.jsxs)(s.li,{children:["Low-level custom payload: pass a ",(0,r.jsx)(s.code,{children:"String"}),", bytes, ",(0,r.jsx)(s.code,{children:"Map"}),", or ",(0,r.jsx)(s.code,{children:"List"})," as the ",(0,r.jsx)(s.code,{children:"body"})," argument"]}),"\n",(0,r.jsxs)(s.li,{children:["Headers: supply ",(0,r.jsx)(s.code,{children:"Map<String, List<String>>"})," via the optional ",(0,r.jsx)(s.code,{children:"headers"})," parameter"]}),"\n",(0,r.jsxs)(s.li,{children:["Cookies: populate the ",(0,r.jsx)(s.code,{children:"cookie"})," header manually or rely on server-generated ",(0,r.jsx)(s.code,{children:"Set-Cookie"})," headers and capture from the ",(0,r.jsx)(s.code,{children:"TestResponse"})]}),"\n"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-dart",children:"final create = await client.postJson('/users', {'name': 'Ada'});\ncreate.assertStatus(201);\n\nfinal update = await client.put('/users/1', 'name=Grace', headers: {\n  'content-type': ['application/x-www-form-urlencoded'],\n});\nupdate.assertStatus(200);\n"})}),"\n",(0,r.jsx)(s.h2,{id:"multipart-builder",children:"Multipart Builder"}),"\n",(0,r.jsxs)(s.p,{children:[(0,r.jsx)(s.code,{children:"client.multipart"})," accepts a callback that receives a ",(0,r.jsx)(s.code,{children:"MultipartRequestBuilder"}),":"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-dart",children:"final res = await client.multipart('/upload', (builder) {\n  builder.addField('name', 'fixture');\n  builder.addFileFromBytes(\n    name: 'avatar',\n    filename: 'avatar.png',\n    bytes: pngBytes,\n    contentType: MediaType('image', 'png'),\n  );\n});\n"})}),"\n",(0,r.jsx)(s.p,{children:"The helpers take care of building the boundary, headers, and encoding."}),"\n",(0,r.jsx)(s.h2,{id:"response-lifecycle",children:"Response Lifecycle"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-dart",children:"final response = await client.get('/users');\nresponse\n  .assertStatus(200)\n  .assertJson((json) => json.count('users', 1));\n"})}),"\n",(0,r.jsxs)(s.p,{children:["See ",(0,r.jsx)(s.a,{href:"/docs/server-testing/test-client/test-response",children:"TestResponse"})," for the full set of assertion helpers and JSON utilities."]}),"\n",(0,r.jsx)(s.h2,{id:"tips",children:"Tips"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:["Wrap the client creation inside ",(0,r.jsx)(s.code,{children:"serverTest"})," unless you have a custom lifecycle to manage."]}),"\n",(0,r.jsxs)(s.li,{children:["Always close manually when you instantiate the client yourself (",(0,r.jsx)(s.code,{children:"await client.close()"}),")."]}),"\n",(0,r.jsxs)(s.li,{children:["Reuse a single handler across multiple tests only when it is stateless; otherwise prefer building a fresh handler inside each ",(0,r.jsx)(s.code,{children:"serverTest"}),"."]}),"\n",(0,r.jsxs)(s.li,{children:["Use ",(0,r.jsx)(s.code,{children:"baseUrlFuture"})," to integrate with browser tests or external HTTP clients that expect a real URL."]}),"\n"]})]})}function h(e={}){const{wrapper:s}={...(0,i.R)(),...e.components};return s?(0,r.jsx)(s,{...e,children:(0,r.jsx)(o,{...e})}):o(e)}},8453:(e,s,t)=>{t.d(s,{R:()=>l,x:()=>c});var n=t(6540);const r={},i=n.createContext(r);function l(e){const s=n.useContext(i);return n.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function c(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:l(e.components),n.createElement(i.Provider,{value:s},e.children)}}}]);