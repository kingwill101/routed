"use strict";(self.webpackChunkrouted=self.webpackChunkrouted||[]).push([[8891],{7903:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>d,contentTitle:()=>l,default:()=>u,frontMatter:()=>a,metadata:()=>r,toc:()=>o});const r=JSON.parse('{"id":"tutorials/tutorial","title":"Build a REST API with Routed","description":"Create a small albums API with validation, routing, and JSON responses","source":"@site/docs/tutorials/tutorial.mdx","sourceDirName":"tutorials","slug":"/tutorials/routed-rest-api","permalink":"/docs/tutorials/routed-rest-api","draft":false,"unlisted":false,"editUrl":"https://github.com/kingwill101/routed/tree/main/docs/docs/tutorials/tutorial.mdx","tags":[],"version":"current","frontMatter":{"title":"Build a REST API with Routed","description":"Create a small albums API with validation, routing, and JSON responses","slug":"/tutorials/routed-rest-api"},"sidebar":"tutorialSidebar","previous":{"title":"Hardening REST APIs with Property-Based Testing","permalink":"/docs/tutorials/hardening-rest-apis"}}');var i=n(4848),s=n(8453);const a={title:"Build a REST API with Routed",description:"Create a small albums API with validation, routing, and JSON responses",slug:"/tutorials/routed-rest-api"},l=void 0,d={},o=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"1. Scaffold the project",id:"1-scaffold-the-project",level:2},{value:"2. Implement the API",id:"2-implement-the-api",level:2},{value:"3. Run the server",id:"3-run-the-server",level:2},{value:"4. Exercise the endpoints",id:"4-exercise-the-endpoints",level:2},{value:"5. Where to go next",id:"5-where-to-go-next",level:2}];function c(e){const t={a:"a",blockquote:"blockquote",code:"code",h2:"h2",li:"li",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.p,{children:"Routed makes it easy to stand up HTTP APIs without writing a lot of boilerplate. This tutorial walks through creating a tiny albums catalogue with three endpoints:"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.code,{children:"GET /albums"})," \u2013 list every album"]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.code,{children:"GET /albums/{id}"})," \u2013 fetch a single album by ID"]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.code,{children:"POST /albums"})," \u2013 add a new album"]}),"\n"]}),"\n",(0,i.jsx)(t.p,{children:"We will keep data in memory for brevity, but the same patterns apply to database-backed services."}),"\n",(0,i.jsx)(t.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:["Dart SDK 3.0 or later (see ",(0,i.jsx)(t.a,{href:"https://dart.dev/get-dart",children:"dart.dev/get-dart"}),")"]}),"\n",(0,i.jsx)(t.li,{children:"A terminal and your favourite editor (VS\u202fCode, IntelliJ, etc.)"}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.code,{children:"curl"})," or a similar HTTP client for manual requests"]}),"\n"]}),"\n",(0,i.jsx)(t.h2,{id:"1-scaffold-the-project",children:"1. Scaffold the project"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-bash",children:"mkdir routed_albums\ncd routed_albums\n# Generate a minimal Dart package\ndart create -t console-full .\n\n# Add runtime dependencies\ndart pub add routed\n"})}),"\n",(0,i.jsxs)(t.p,{children:["The ",(0,i.jsx)(t.code,{children:"console-full"})," template gives you a ",(0,i.jsx)(t.code,{children:"bin/"})," entry point and ",(0,i.jsx)(t.code,{children:"lib/"})," folder. We will place all code in ",(0,i.jsx)(t.code,{children:"bin/server.dart"}),", but feel free to split it into libraries for larger projects."]}),"\n",(0,i.jsx)(t.h2,{id:"2-implement-the-api",children:"2. Implement the API"}),"\n",(0,i.jsxs)(t.p,{children:["Replace the contents of ",(0,i.jsx)(t.code,{children:"bin/server.dart"})," with the following:"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-dart",children:"import 'dart:io';\n\nimport 'package:routed/middlewares.dart';\nimport 'package:routed/routed.dart';\n\nFuture<void> main() async {\n  final engine = Engine(\n    options: [\n      // Abort requests that take longer than 10 seconds.\n      withMiddleware([timeoutMiddleware(const Duration(seconds: 10))]),\n    ],\n  );\n\n  final albums = <String, Map<String, dynamic>>{\n    '1': {'id': '1', 'title': 'Blue Train', 'artist': 'John Coltrane', 'price': 56.99},\n    '2': {'id': '2', 'title': 'Jeru', 'artist': 'Gerry Mulligan', 'price': 17.99},\n    '3': {'id': '3', 'title': 'Sarah Vaughan and Clifford Brown', 'artist': 'Sarah Vaughan', 'price': 39.99},\n  };\n  var nextId = albums.length;\n\n  engine.get('/', (ctx) => ctx.json({'message': 'Routed albums API'}));\n\n  engine.group(path: '/albums', builder: (router) {\n    router.get('/', (ctx) {\n      return ctx.json({'albums': albums.values.toList()});\n    });\n\n    router.get('/{id}', (ctx) {\n      final id = ctx.param('id');\n      final album = id != null ? albums[id] : null;\n      if (album == null) {\n        return ctx.json({'error': 'Album not found'}, statusCode: HttpStatus.notFound);\n      }\n      return ctx.json(album);\n    });\n\n    router.post('/', (ctx) async {\n      await ctx.validate({\n        'title': 'required|string|min_length:1|max_length:120',\n        'artist': 'required|string|min_length:1|max_length:120',\n        'price': 'required|numeric',\n      });\n\n      final payload = <String, dynamic>{};\n      await ctx.bindJSON(payload);\n\n      final price = double.tryParse(payload['price'].toString());\n      if (price == null) {\n        return ctx.json({'error': 'Price must be numeric'}, statusCode: HttpStatus.unprocessableEntity);\n      }\n\n      final id = (++nextId).toString();\n      final album = {\n        'id': id,\n        'title': payload['title'],\n        'artist': payload['artist'],\n        'price': price,\n      };\n\n      albums[id] = album;\n      return ctx.json(album, statusCode: HttpStatus.created);\n    });\n  });\n\n  await engine.serve(host: '127.0.0.1', port: 8080);\n  print('Listening on http://127.0.0.1:8080');\n}\n"})}),"\n",(0,i.jsx)(t.p,{children:"Key takeaways:"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.code,{children:"ctx.json()"})," serialises maps/lists to JSON and sets the response headers."]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.code,{children:"ctx.param('id')"})," reads route parameters. The router automatically enforces the placeholders defined in the path."]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.code,{children:"ctx.validate()"})," uses Routed\u2019s built-in validation rules. It runs before we mutate the data."]}),"\n",(0,i.jsxs)(t.li,{children:[(0,i.jsx)(t.code,{children:"ctx.bindJSON()"})," copies decoded JSON into the supplied map so you can work with strongly typed objects if desired."]}),"\n"]}),"\n",(0,i.jsxs)(t.blockquote,{children:["\n",(0,i.jsxs)(t.p,{children:["In a larger app you can move the timeout middleware\u2014and other feature toggles\u2014into ",(0,i.jsx)(t.code,{children:"config/http.yaml"})," (for example under ",(0,i.jsx)(t.code,{children:"http.middleware.global"}),"). Running ",(0,i.jsx)(t.code,{children:"dart run routed_cli provider:list --config"})," shows the active providers/middleware and surfaces validation errors before booting the server."]}),"\n"]}),"\n",(0,i.jsx)(t.h2,{id:"3-run-the-server",children:"3. Run the server"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-bash",children:"dart run bin/server.dart\n"})}),"\n",(0,i.jsxs)(t.p,{children:["You should see the log ",(0,i.jsx)(t.code,{children:"Listening on http://127.0.0.1:8080"}),"."]}),"\n",(0,i.jsx)(t.h2,{id:"4-exercise-the-endpoints",children:"4. Exercise the endpoints"}),"\n",(0,i.jsx)(t.p,{children:"List all albums:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-bash",children:"curl http://127.0.0.1:8080/albums | jq\n"})}),"\n",(0,i.jsx)(t.p,{children:"Create a new album:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-bash",children:'curl -X POST http://127.0.0.1:8080/albums \\\n  -H \'content-type: application/json\' \\\n  -d \'{"title": "Kind of Blue", "artist": "Miles Davis", "price": 49.99}\' | jq\n'})}),"\n",(0,i.jsx)(t.p,{children:"Fetch a single album:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-bash",children:"curl http://127.0.0.1:8080/albums/1 | jq\n"})}),"\n",(0,i.jsx)(t.p,{children:"Invalid payloads return validation errors:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-bash",children:'curl -X POST http://127.0.0.1:8080/albums \\\n  -H \'content-type: application/json\' \\\n  -d \'{"title": "", "artist": "", "price": "free"}\' | jq\n'})}),"\n",(0,i.jsxs)(t.p,{children:["The response status is ",(0,i.jsx)(t.code,{children:"422"})," with details about the failing fields."]}),"\n",(0,i.jsx)(t.h2,{id:"5-where-to-go-next",children:"5. Where to go next"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:["Inspect the full example in this repository at ",(0,i.jsx)(t.a,{href:"https://github.com/kingwill101/routed/tree/main/examples/basic_router",children:(0,i.jsx)(t.code,{children:"examples/basic_router"})}),"."]}),"\n",(0,i.jsxs)(t.li,{children:["Continue with the ",(0,i.jsx)(t.a,{href:"/docs/routed/fundamentals/routing",children:"routing fundamentals"})," guide to learn about middleware, route groups, and named routes."]}),"\n",(0,i.jsx)(t.li,{children:"Add persistence (for example with PostgreSQL) by swapping the in-memory map for a repository layer."}),"\n"]}),"\n",(0,i.jsx)(t.p,{children:"You now have a working REST API built with Routed. Extend it with authentication, database access, or property-based tests using the other guides in this documentation set."})]})}function u(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}},8453:(e,t,n)=>{n.d(t,{R:()=>a,x:()=>l});var r=n(6540);const i={},s=r.createContext(i);function a(e){const t=r.useContext(s);return r.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function l(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),r.createElement(s.Provider,{value:t},e.children)}}}]);