"use strict";(globalThis.webpackChunkrouted=globalThis.webpackChunkrouted||[]).push([[2334],{5936:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>h,frontMatter:()=>a,metadata:()=>t,toc:()=>d});const t=JSON.parse('{"id":"test-client/json-assertions","title":"JSON Assertions","description":"Learn how to test JSON responses","source":"@site/docs/server-testing/test-client/json-assertions.mdx","sourceDirName":"test-client","slug":"/test-client/json-assertions","permalink":"/docs/server_testing/test-client/json-assertions","draft":false,"unlisted":false,"editUrl":"https://github.com/kingwill101/routed/tree/main/docs/docs/server-testing/test-client/json-assertions.mdx","tags":[],"version":"current","sidebarPosition":5,"frontMatter":{"title":"JSON Assertions","description":"Learn how to test JSON responses","sidebar_position":5},"sidebar":"serverTestingSidebar","previous":{"title":"Header Extensions","permalink":"/docs/server_testing/test-client/headers"},"next":{"title":"Schema Validation","permalink":"/docs/server_testing/test-client/schema-validation"}}');var i=s(4848),r=s(8453);const a={title:"JSON Assertions",description:"Learn how to test JSON responses",sidebar_position:5},o="JSON Response Testing",c={},d=[{value:"Basic Assertions",id:"basic-assertions",level:2},{value:"Nested Data Testing",id:"nested-data-testing",level:2},{value:"Array Testing",id:"array-testing",level:2},{value:"Numeric Testing",id:"numeric-testing",level:2},{value:"Schema Validation",id:"schema-validation",level:2},{value:"Conditional Testing",id:"conditional-testing",level:2},{value:"Fragment Testing",id:"fragment-testing",level:2},{value:"Property Interaction Tracking",id:"property-interaction-tracking",level:2},{value:"Debugging",id:"debugging",level:2}];function l(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"json-response-testing",children:"JSON Response Testing"})}),"\n",(0,i.jsxs)(n.p,{children:["The server_testing package provides powerful JSON assertion capabilities via ",(0,i.jsx)(n.code,{children:"TestResponse.assertJson"})," and ",(0,i.jsx)(n.code,{children:"AssertableJson"})," (inspired by Laravel's testing API). The fluent matcher DSL comes from the ",(0,i.jsx)(n.a,{href:"https://pub.dev/packages/assertable_json",children:(0,i.jsx)(n.code,{children:"assertable_json"})})," package, which ",(0,i.jsx)(n.code,{children:"server_testing"})," re-exports\u2014importing ",(0,i.jsx)(n.code,{children:"package:server_testing/server_testing.dart"})," is all you need."]}),"\n",(0,i.jsx)(n.h2,{id:"basic-assertions",children:"Basic Assertions"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-dart",children:"test('test json response', () async {\n  final response = await client.getJson('/api/data');\n  \n  response.assertJson((json) {\n    json\n      .has('id')                    // Key exists\n      .has('user.name')             // Nested key exists\n      .missing('deleted_at')        // Key doesn't exist\n      .where('status', 'active')    // Exact value match\n      .whereNot('type', 'admin')    // Value doesn't match\n      .whereType<int>('id')         // Type check \n      .whereIn('role', ['user', 'admin']); // Value in list\n  });\n});\n"})}),"\n",(0,i.jsx)(n.h2,{id:"nested-data-testing",children:"Nested Data Testing"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-dart",children:"response.assertJson((json) {\n  // Test nested object\n  json.scope('user', (user) {\n    user\n      .where('id', 1)\n      .where('name', 'John')\n      .scope('profile', (profile) {\n        profile\n          .has('avatar')\n          .has('bio');\n      });\n  });\n});\n"})}),"\n",(0,i.jsx)(n.h2,{id:"array-testing",children:"Array Testing"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-dart",children:"response.assertJson((json) {\n  // Count array items\n  json.count('items', 3);\n  \n  // Count between range\n  json.countBetween('items', 1, 5);\n  \n  // Test first item\n  json.scope('items', (items) {\n    items.first((item) {\n      item.where('id', 1);\n    });\n  });\n  \n  // Test each item\n  json.scope('items', (items) {\n    items.each((item) {\n      item\n        .has('id')\n        .has('name')\n        .whereType<int>('id');\n    });\n  });\n});\n"})}),"\n",(0,i.jsx)(n.h2,{id:"numeric-testing",children:"Numeric Testing"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-dart",children:"response.assertJson((json) {\n  json\n    .isGreaterThan('age', 18)\n    .isLessThan('price', 100.0)\n    .isGreaterOrEqual('quantity', 1)\n    .isLessOrEqual('discount', 50)\n    .isBetween('score', 0, 100)\n    .isDivisibleBy('quantity', 5)\n    .isMultipleOf('price', 10)\n    .isPositive('balance')\n    .isNegative('debt');\n});\n"})}),"\n",(0,i.jsx)(n.h2,{id:"schema-validation",children:"Schema Validation"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-dart",children:"response.assertJson((json) {\n  // Simple schema\n  json.matchesSchema({\n    'id': int,\n    'name': String,\n    'active': bool\n  });\n  \n  // Complex schema with arrays\n  json.assertStructure({\n    'users': {\n      '*': [               // Wildcard for array items\n        'id',\n        'name',\n        'email'\n      ]\n    },\n    'meta': {\n      'total',\n      'per_page'\n    }\n  });\n});\n"})}),"\n",(0,i.jsx)(n.h2,{id:"conditional-testing",children:"Conditional Testing"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-dart",children:"response.assertJson((json) {\n  // Only test if condition is true\n  json.when(isAdmin, (json) {\n    json.has('admin_features');\n  });\n  \n  // Only test if condition is false\n  json.unless(isBasicUser, (json) {\n    json.has('premium_features');\n  });\n});\n"})}),"\n",(0,i.jsx)(n.h2,{id:"fragment-testing",children:"Fragment Testing"}),"\n",(0,i.jsx)(n.h2,{id:"property-interaction-tracking",children:"Property Interaction Tracking"}),"\n",(0,i.jsxs)(n.p,{children:["The assertJson method tracks which properties have been checked in your assertions using the ",(0,i.jsx)(n.code,{children:"etc()"})," method:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-dart",children:"response.assertJson((json) {\n  json\n    .where('id', 1)\n    .where('name', 'John')\n    // Mark all remaining properties as checked\n    .etc();\n});\n\n// Without etc(), this would fail if response contains other properties\nresponse.assertJson((json) {\n  json\n    .where('id', 1)\n    // Will fail if response has any other properties\n    // besides 'id' because they weren't checked\n});\n\n// Use etc() in nested scopes\nresponse.assertJson((json) {\n  json.scope('user', (user) {\n    user\n      .where('id', 1)\n      .where('name', 'John')\n      .etc(); // Mark all user properties as checked\n  })\n  .etc(); // Mark all root properties as checked\n});\n"})}),"\n",(0,i.jsx)(n.p,{children:"This helps ensure you're testing all properties in your responses and not accidentally ignoring unexpected data."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-dart",children:"// Test part of response matches\nresponse.assertJson((json) {\n  json.assertFragment({\n    'user': {\n      'id': 1,\n      'name': 'John'\n    }\n  });\n});\n"})}),"\n",(0,i.jsx)(n.h2,{id:"debugging",children:"Debugging"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-dart",children:"response\n  // Print response for debugging\n  .dump()\n  \n  // Tap into assertion chain\n  .tap((json) {\n    print('Testing JSON: ${json.toString()}');\n  })\n  \n  // Continue assertions\n  .assertJson((json) {\n    json.has('data');\n  });\n"})})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(l,{...e})}):l(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>a,x:()=>o});var t=s(6540);const i={},r=t.createContext(i);function a(e){const n=t.useContext(r);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),t.createElement(r.Provider,{value:n},e.children)}}}]);