"use strict";(globalThis.webpackChunkrouted=globalThis.webpackChunkrouted||[]).push([[9208],{7288:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>a,contentTitle:()=>l,default:()=>h,frontMatter:()=>o,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"fundamentals/fallback-precedence","title":"Fallback precedence","description":"Understand how Routed selects fallback handlers and how to structure overrides per router group.","source":"@site/docs/routed/fundamentals/fallback-precedence.mdx","sourceDirName":"fundamentals","slug":"/fundamentals/fallback-precedence","permalink":"/docs/routed/fundamentals/fallback-precedence","draft":false,"unlisted":false,"editUrl":"https://github.com/kingwill101/routed/tree/main/docs/docs/routed/fundamentals/fallback-precedence.mdx","tags":[],"version":"current","sidebarPosition":7,"frontMatter":{"id":"fallback-precedence","title":"Fallback precedence","sidebar_position":7,"description":"Understand how Routed selects fallback handlers and how to structure overrides per router group."},"sidebar":"routedSidebar","previous":{"title":"Cookies","permalink":"/docs/routed/fundamentals/cookies"},"next":{"title":"WebSockets","permalink":"/docs/routed/fundamentals/websockets"}}');var s=t(4848),i=t(8453);const o={id:"fallback-precedence",title:"Fallback precedence",sidebar_position:7,description:"Understand how Routed selects fallback handlers and how to structure overrides per router group."},l=void 0,a={},c=[{value:"Resolution order",id:"resolution-order",level:2},{value:"How specificity scoring works",id:"how-specificity-scoring-works",level:3},{value:"Registering multiple fallbacks",id:"registering-multiple-fallbacks",level:2},{value:"Tuning behaviour",id:"tuning-behaviour",level:2},{value:"Troubleshooting checklist",id:"troubleshooting-checklist",level:2}];function d(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.p,{children:'Fallback handlers bridge the gap between "no match" and "useful response." Routed lets you register fallbacks at the engine level or on any router group, and then chooses the most specific candidate when a request slips past the usual route table. This guide shows the evaluation order, how specificity scoring works, and how to tune the outcome.'}),"\n",(0,s.jsx)(n.h2,{id:"resolution-order",children:"Resolution order"}),"\n",(0,s.jsx)(n.p,{children:"When a request arrives, the engine evaluates candidates in the following order:"}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Phase"}),(0,s.jsx)(n.th,{children:"Candidate"}),(0,s.jsx)(n.th,{children:"Match criteria"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"1"}),(0,s.jsx)(n.td,{children:"Static + parameterised routes"}),(0,s.jsx)(n.td,{children:"HTTP method, path pattern, and constraints must match."})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"2"}),(0,s.jsx)(n.td,{children:"Method-only checks"}),(0,s.jsx)(n.td,{children:"If the path matched but the method did not, the engine can surface a 405 response (when enabled)."})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:"3"}),(0,s.jsx)(n.td,{children:"Fallback routes"}),(0,s.jsx)(n.td,{children:"If no normal route matched, the engine compares every fallback handler and picks the one whose static prefix most closely resembles the request path."})]})]})]}),"\n",(0,s.jsxs)(n.p,{children:["Only phase 3 is documented here; the earlier phases behave as described in ",(0,s.jsx)(n.a,{href:"/docs/routed/fundamentals/routing",children:"Routing basics"}),"."]}),"\n",(0,s.jsx)(n.h3,{id:"how-specificity-scoring-works",children:"How specificity scoring works"}),"\n",(0,s.jsxs)(n.p,{children:["Every fallback route is compiled down to an internal path that ends with ",(0,s.jsx)(n.code,{children:"/{__fallback:*}"}),". During evaluation, Routed extracts the static prefix (everything before the wildcard) and uses a fuzzy ratio to measure how closely that prefix matches the request path. The fallback with the highest score wins."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"Request path:      /api/v1/users/42\nFallback prefixes: /         -> score 15\n                   /api      -> score 68\n                   /api/v1   -> score 92 (chosen)\n"})}),"\n",(0,s.jsx)(n.p,{children:"Because all fallbacks run through the same scorer, you can influence precedence by:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Nesting fallbacks closer to the routes they should guard (e.g. define ",(0,s.jsx)(n.code,{children:"/api/v1"})," inside the ",(0,s.jsx)(n.code,{children:"/api"})," group)."]}),"\n",(0,s.jsxs)(n.li,{children:["Using more specific static prefixes (",(0,s.jsx)(n.code,{children:"/console/admin"})," beats ",(0,s.jsx)(n.code,{children:"/console"})," for admin-only responses)."]}),"\n",(0,s.jsx)(n.li,{children:"Avoiding catch-all fallbacks inside high-priority groups unless you really want them to override child groups."}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"registering-multiple-fallbacks",children:"Registering multiple fallbacks"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-dart",metastring:'title="Global and group-specific fallbacks"',children:"final engine = Engine()\n  ..fallback((ctx) => ctx.string('Default 404'))\n  ..group(\n    path: '/api',\n    builder: (router) {\n      router.fallback(\n        (ctx) => ctx.json({\n          'error': 'API route not found',\n          'path': ctx.uri.path,\n        }),\n      );\n\n      router.group(\n        path: '/v1',\n        builder: (v1) {\n          v1.fallback(\n            (ctx) => ctx.json({\n              'error': 'v1 endpoint missing',\n              'path': ctx.uri.path,\n            }),\n          );\n        },\n      );\n    },\n  );\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Requests under ",(0,s.jsx)(n.code,{children:"/api/v1/..."})," land in the ",(0,s.jsx)(n.code,{children:"v1"})," fallback. Requests under ",(0,s.jsx)(n.code,{children:"/api/..."})," fall back to the API-wide handler. Everything else gets the default string response."]}),"\n",(0,s.jsx)(n.h2,{id:"tuning-behaviour",children:"Tuning behaviour"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Short-circuit specific scenarios."})," Place a normal route or middleware guard ahead of the fallback when a group needs to emit different responses for authenticated vs anonymous traffic."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Expose overrides through configuration."})," Wrap your fallback callbacks in functions that read view names or template paths from config so operations teams can change messaging without rebuilding."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Opt out per route when necessary."})," Routes can disable ",(0,s.jsx)(n.code,{children:"redirectTrailingSlash"})," or ",(0,s.jsx)(n.code,{children:"methodNotAllowed"})," handling via options; the fallback selection process respects those knobs."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Plan for explicit priority weights."})," The roadmap calls for user-tunable fallback priorities. Until that lands, rely on static prefixes and router nesting to guide the fuzzy scorer. When explicit priorities ship they will layer on top of the current behaviour, so the guidance above will continue to apply."]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"troubleshooting-checklist",children:"Troubleshooting checklist"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Confirm the fallback is registered on the router you expect (engine vs nested group)."}),"\n",(0,s.jsx)(n.li,{children:"Inspect static prefixes with logging to verify they line up with the paths you expect to catch."}),"\n",(0,s.jsxs)(n.li,{children:["Add request event listeners (",(0,s.jsx)(n.code,{children:"RouteNotFoundEvent"}),") to observe when no fallback wins\u2014this helps surface typos or incorrect group nesting."]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["For more on error handling in general, see ",(0,s.jsx)(n.a,{href:"/docs/routed/fundamentals/error-handling",children:"Unmatched routes and 404s"}),"."]})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>o,x:()=>l});var r=t(6540);const s={},i=r.createContext(s);function o(e){const n=r.useContext(i);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),r.createElement(i.Provider,{value:n},e.children)}}}]);