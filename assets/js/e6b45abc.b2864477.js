"use strict";(self.webpackChunkrouted=self.webpackChunkrouted||[]).push([[3551],{1390:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>d,contentTitle:()=>o,default:()=>u,frontMatter:()=>a,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"routed/testing/getting-started","title":"Getting Started with routed_testing","description":"Use engineTest and engineGroup to exercise your routes","source":"@site/docs/routed/testing/getting-started.mdx","sourceDirName":"routed/testing","slug":"/routed/testing/getting-started","permalink":"/docs/routed/testing/getting-started","draft":false,"unlisted":false,"editUrl":"https://github.com/kingwill101/routed/tree/main/docs/docs/routed/testing/getting-started.mdx","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"title":"Getting Started with routed_testing","description":"Use engineTest and engineGroup to exercise your routes","sidebar_position":1},"sidebar":"tutorialSidebar","previous":{"title":"Testing Routed Apps","permalink":"/docs/routed/testing/overview"},"next":{"title":"engineGroup Patterns","permalink":"/docs/routed/testing/engine-group"}}');var r=n(4848),i=n(8453);const a={title:"Getting Started with routed_testing",description:"Use engineTest and engineGroup to exercise your routes",sidebar_position:1},o="Getting Started with routed_testing",d={},c=[{value:"1. Install the testing stack",id:"1-install-the-testing-stack",level:2},{value:"2. Write your first test with <code>engineTest</code>",id:"2-write-your-first-test-with-enginetest",level:2},{value:"3. Share setup with <code>engineGroup</code>",id:"3-share-setup-with-enginegroup",level:2},{value:"4. Access the engine inside tests",id:"4-access-the-engine-inside-tests",level:2},{value:"5. Combine with browser tests",id:"5-combine-with-browser-tests",level:2}];function l(e){const t={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.header,{children:(0,r.jsx)(t.h1,{id:"getting-started-with-routed_testing",children:"Getting Started with routed_testing"})}),"\n",(0,r.jsxs)(t.p,{children:["The ",(0,r.jsx)(t.code,{children:"routed_testing"})," package builds on top of ",(0,r.jsx)(t.code,{children:"server_testing"})," to offer a clean testing API for Routed applications. You define routes on an ",(0,r.jsx)(t.code,{children:"Engine"}),", and the helper takes care of wrapping it in a ",(0,r.jsx)(t.code,{children:"RoutedRequestHandler"})," and a ",(0,r.jsx)(t.code,{children:"TestClient"}),"."]}),"\n",(0,r.jsx)(t.h2,{id:"1-install-the-testing-stack",children:"1. Install the testing stack"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:"dart pub add --dev routed_testing server_testing server_testing_shelf\ndart pub add --dev test\n"})}),"\n",(0,r.jsxs)(t.h2,{id:"2-write-your-first-test-with-enginetest",children:["2. Write your first test with ",(0,r.jsx)(t.code,{children:"engineTest"})]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-dart",children:"import 'package:routed/routed.dart';\nimport 'package:routed_testing/routed_testing.dart';\nimport 'package:server_testing/server_testing.dart';\n\nvoid main() {\n  engineTest('creates a user', (engine, client) async {\n    engine.post('/users', (ctx) async {\n      await ctx.validate({'name': 'required'});\n      return ctx.json({'status': 'created'});\n    });\n\n    final res = await client.postJson('/users', {'name': 'Taylor'});\n    res\n      ..assertStatus(200)\n      ..assertJson((json) => json.where('status', 'created'));\n  });\n}\n"})}),"\n",(0,r.jsxs)(t.p,{children:[(0,r.jsx)(t.code,{children:"engineTest"})," spins up a fresh engine and client for each test. Use ",(0,r.jsx)(t.code,{children:"transportMode: TransportMode.ephemeralServer"})," when you need to exercise the full HTTP stack instead of the default in-memory transport."]}),"\n",(0,r.jsxs)(t.h2,{id:"3-share-setup-with-enginegroup",children:["3. Share setup with ",(0,r.jsx)(t.code,{children:"engineGroup"})]}),"\n",(0,r.jsxs)(t.p,{children:[(0,r.jsx)(t.code,{children:"engineGroup"})," lets you reuse an engine/client across multiple tests:"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-dart",children:"void main() {\n  engineGroup('Users API',\n      transportMode: TransportMode.inMemory,\n      define: (engine, client, test) {\n    engine.get('/users', (ctx) => ctx.json({'users': []}));\n    engine.post('/users', (ctx) async {\n      await ctx.validate({'name': 'required'});\n      return ctx.json({'status': 'created'});\n    });\n\n    test('lists users', (engine, client) async {\n      final res = await client.getJson('/users');\n      res.assertStatus(200).assertJson((json) => json.has('users'));\n    });\n\n    test('creates user', (engine, client) async {\n      final res = await client.postJson('/users', {'name': 'Ava'});\n      res.assertJson((json) => json.where('status', 'created'));\n    });\n  });\n}\n"})}),"\n",(0,r.jsxs)(t.p,{children:["Each ",(0,r.jsx)(t.code,{children:"test"})," defined inside the group receives a ",(0,r.jsx)(t.em,{children:"fresh"})," engine/client pair, so state does not leak between tests."]}),"\n",(0,r.jsx)(t.h2,{id:"4-access-the-engine-inside-tests",children:"4. Access the engine inside tests"}),"\n",(0,r.jsx)(t.p,{children:"The engine passed to your callback is the same instance used by the client. You can inspect routes, mount additional routers, or configure middleware inside the test body:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-dart",children:"engineTest('attaches middleware', (engine, client) async {\n  engine.middlewares.add(timeoutMiddleware(const Duration(seconds: 5)));\n  engine.get('/slow', (ctx) async {\n    await Future<void>.delayed(const Duration(seconds: 10));\n    return ctx.string('done');\n  });\n\n  final res = await client.get('/slow');\n  res.assertStatus(HttpStatus.requestTimeout);\n});\n"})}),"\n",(0,r.jsxs)(t.p,{children:["Import ",(0,r.jsx)(t.code,{children:"dart:io"})," when you need ",(0,r.jsx)(t.code,{children:"HttpStatus"})," constants."]}),"\n",(0,r.jsx)(t.h2,{id:"5-combine-with-browser-tests",children:"5. Combine with browser tests"}),"\n",(0,r.jsxs)(t.p,{children:["Because ",(0,r.jsx)(t.code,{children:"engineTest"})," uses ",(0,r.jsx)(t.code,{children:"server_testing"})," under the hood, you can share the same handler with browser automation:"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-dart",children:"engineTest('renders home page', (engine, client) async {\n  engine.get('/', (ctx) => ctx.string('<html><title>Home</title></html>'));\n\n  final baseUrl = await client.baseUrlFuture;\n  await testBootstrap();\n\n  await browserTest('home has title', (browser) async {\n    await browser.visit('/', baseUrl: baseUrl);\n    await browser.assertTitle('Home');\n  });\n});\n"})}),"\n",(0,r.jsxs)(t.p,{children:["See the ",(0,r.jsx)(t.a,{href:"/docs/routed/testing/overview",children:"Testing index"})," for additional helpers and the ",(0,r.jsx)(t.a,{href:"/docs/server-testing/",children:"Server Testing docs"})," for the full assertion API."]})]})}function u(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(l,{...e})}):l(e)}},8453:(e,t,n)=>{n.d(t,{R:()=>a,x:()=>o});var s=n(6540);const r={},i=s.createContext(r);function a(e){const t=s.useContext(i);return s.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),s.createElement(i.Provider,{value:t},e.children)}}}]);