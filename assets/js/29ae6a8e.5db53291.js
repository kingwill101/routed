"use strict";(self.webpackChunkrouted=self.webpackChunkrouted||[]).push([[7404],{7606:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>l,contentTitle:()=>a,default:()=>h,frontMatter:()=>t,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"server-testing/browser/browser-config","title":"BrowserConfig & Devices","description":"Configure browsers, logging, and device emulation for WebDriver tests","source":"@site/docs/server-testing/browser/browser-config.mdx","sourceDirName":"server-testing/browser","slug":"/server-testing/browser/browser-config","permalink":"/docs/server-testing/browser/browser-config","draft":false,"unlisted":false,"editUrl":"https://github.com/kingwill101/routed/tree/main/docs/docs/server-testing/browser/browser-config.mdx","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"title":"BrowserConfig & Devices","description":"Configure browsers, logging, and device emulation for WebDriver tests","sidebar_position":2},"sidebar":"tutorialSidebar","previous":{"title":"Browser Testing","permalink":"/docs/server-testing/browser/browser-testing"},"next":{"title":"Pages & Components","permalink":"/docs/server-testing/browser/pages-and-components"}}');var i=n(4848),o=n(8453);const t={title:"BrowserConfig & Devices",description:"Configure browsers, logging, and device emulation for WebDriver tests",sidebar_position:2},a="BrowserConfig & Devices",l={},c=[{value:"Common Options",id:"common-options",level:2},{value:"Field Highlights",id:"field-highlights",level:3},{value:"Device Emulation",id:"device-emulation",level:2},{value:"Proxy Configuration",id:"proxy-configuration",level:2},{value:"Per-Test Overrides",id:"per-test-overrides",level:2},{value:"ChromeDriver and Browser Version Matching",id:"chromedriver-and-browser-version-matching",level:2},{value:"Overriding the detected driver",id:"overriding-the-detected-driver",level:3},{value:"Choosing browser channel/variant",id:"choosing-browser-channelvariant",level:3}];function d(e){const r={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,o.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(r.header,{children:(0,i.jsx)(r.h1,{id:"browserconfig--devices",children:"BrowserConfig & Devices"})}),"\n",(0,i.jsxs)(r.p,{children:[(0,i.jsx)(r.code,{children:"BrowserConfig"})," defines the defaults used by ",(0,i.jsx)(r.code,{children:"testBootstrap"}),", ",(0,i.jsx)(r.code,{children:"browserTest"}),", and ",(0,i.jsx)(r.code,{children:"browserGroup"}),". All fields have sensible defaults, but understanding the knobs helps when running in CI or reproducing user environments."]}),"\n",(0,i.jsx)(r.h2,{id:"common-options",children:"Common Options"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-dart",children:"final config = BrowserConfig(\n  browserName: 'firefox',        // default is 'chromium'\n  headless: true,                // run with UI off; set to false for debugging\n  baseUrl: 'http://localhost:8080',\n  timeout: const Duration(seconds: 45),\n  autoScreenshots: true,         // capture screenshots on failure\n  logDir: 'test_logs',           // where logs & screenshots end up\n  forceReinstall: false,         // set true to refresh cached binaries\n  verbose: true,                 // CLI-style logs during bootstrap\n);\n\nawait testBootstrap(config);\n"})}),"\n",(0,i.jsx)(r.h3,{id:"field-highlights",children:"Field Highlights"}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.code,{children:"browserName"})," \u2013 ",(0,i.jsx)(r.code,{children:"'chromium'"})," by default. Supported names include ",(0,i.jsx)(r.code,{children:"'firefox'"})," and ",(0,i.jsx)(r.code,{children:"'chromium'"})," (others depend on registered ",(0,i.jsx)(r.code,{children:"BrowserType"}),"s)."]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.code,{children:"headless"})," \u2013 ",(0,i.jsx)(r.code,{children:"true"})," by default. Flip to inspect the UI locally."]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.code,{children:"baseUrl"})," \u2013 used to resolve relative paths passed to ",(0,i.jsx)(r.code,{children:"browser.visit"}),"."]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.code,{children:"timeout"})," / ",(0,i.jsx)(r.code,{children:"defaultWaitTimeout"})," \u2013 adjust for slow environments."]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.code,{children:"autoInstall"})," / ",(0,i.jsx)(r.code,{children:"autoDownload"})," \u2013 leave enabled to automatically fetch missing browser binaries; disable if you provide them manually."]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.code,{children:"forceReinstall"})," \u2013 force a clean download the next time a test runs."]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.code,{children:"autoScreenshots"})," & ",(0,i.jsx)(r.code,{children:"screenshotDirectory"})," \u2013 toggle and customize screenshot capture on failures."]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.code,{children:"logDir"})," & ",(0,i.jsx)(r.code,{children:"verboseLogging"})," \u2013 route log output and increase verbosity when diagnosing issues."]}),"\n"]}),"\n",(0,i.jsx)(r.h2,{id:"device-emulation",children:"Device Emulation"}),"\n",(0,i.jsxs)(r.p,{children:["Supply a device descriptor (from ",(0,i.jsx)(r.code,{children:"devicesJsonData"}),") when launching a group or individual test. This applies viewport size, user agent, and other hints where supported."]}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-dart",children:"import 'package:server_testing/src/browser/bootstrap/devices_json_const.dart';\n\nbrowserGroup('Pixel 5', device: devicesJsonData['Pixel 5'], define: (getBrowser) {\n  test('mobile layout', () async {\n    final browser = getBrowser();\n    await browser.visit('/');\n    await browser.assertSee('Menu');\n  });\n});\n"})}),"\n",(0,i.jsxs)(r.p,{children:["You can also call ",(0,i.jsx)(r.code,{children:"browser.emulation.setDevice(device)"})," manually inside a test for finer control."]}),"\n",(0,i.jsx)(r.h2,{id:"proxy-configuration",children:"Proxy Configuration"}),"\n",(0,i.jsxs)(r.p,{children:["Pass a ",(0,i.jsx)(r.code,{children:"ProxyConfiguration"})," to route WebDriver traffic through a proxy (useful for corporate networks or traffic capture):"]}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-dart",children:"final config = BrowserConfig(\n  proxy: ProxyConfiguration(httpProxy: 'http://localhost:3128'),\n);\nawait testBootstrap(config);\n"})}),"\n",(0,i.jsxs)(r.p,{children:["Overrides can also be supplied per test via ",(0,i.jsx)(r.code,{children:"browserTest(..., proxy: ProxyConfiguration(...))"}),"."]}),"\n",(0,i.jsx)(r.h2,{id:"per-test-overrides",children:"Per-Test Overrides"}),"\n",(0,i.jsxs)(r.p,{children:[(0,i.jsx)(r.code,{children:"browserTest"})," and ",(0,i.jsx)(r.code,{children:"browserGroup"})," accept override parameters. These push a temporary configuration onto a stack and automatically restore it after the test finishes."]}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-dart",children:"import 'package:server_testing/server_testing.dart';\n\nbrowserTest(\n  'run headed chrome',\n  (browser) async {\n    await browser.visit('/');\n    await browser.assertTitleContains('Demo');\n  },\n  browserType: ChromiumType(),\n  headless: false,\n  baseUrl: 'http://127.0.0.1:4000',\n  timeout: const Duration(seconds: 90),\n);\n"})}),"\n",(0,i.jsx)(r.p,{children:"Use this for occasional variations without affecting the global bootstrap configuration."}),"\n",(0,i.jsx)(r.h2,{id:"chromedriver-and-browser-version-matching",children:"ChromeDriver and Browser Version Matching"}),"\n",(0,i.jsx)(r.p,{children:"Server Testing now aligns ChromeDriver with the bundled Chromium version automatically."}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsx)(r.li,{children:"Build time: the builder reads Playwright\u2019s browsers.json and records Chromium\u2019s browserVersion major. It generates a default ChromeDriver version for that major."}),"\n",(0,i.jsx)(r.li,{children:"Run time: when launching Chromium, DriverManager detects the installed Chromium binary (from the selected revision), derives its major version, and fetches the latest matching ChromeDriver from googlechromelabs milestone JSON. If the network fetch fails, it falls back to the generated default."}),"\n"]}),"\n",(0,i.jsx)(r.h3,{id:"overriding-the-detected-driver",children:"Overriding the detected driver"}),"\n",(0,i.jsx)(r.p,{children:"You can override the driver version explicitly:"}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsxs)(r.li,{children:["Environment variables:","\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsx)(r.li,{children:"SERVER_TESTING_CHROMEDRIVER_VERSION: exact version, e.g. 141.0.7390.76"}),"\n",(0,i.jsx)(r.li,{children:"SERVER_TESTING_CHROMEDRIVER_MAJOR: major only, e.g. 141"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(r.li,{children:"Per-launch via extraCapabilities:"}),"\n"]}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-dart",children:"browserTest('pin driver version', (browser) async { /* ... */ },\n  browserType: chromium,\n  extraCapabilities: {\n    'driver:version': '141.0.7390.76', // or\n    'driver:major': 141,\n  },\n);\n"})}),"\n",(0,i.jsx)(r.h3,{id:"choosing-browser-channelvariant",children:"Choosing browser channel/variant"}),"\n",(0,i.jsx)(r.p,{children:"Use BrowserLaunchOptions.channel to control which browser binary is used (e.g., 'chrome', 'chromium', 'chromium-tip-of-tree'). The driver resolver will use the final binary\u2019s version to pick a compatible driver. Headless/headed is already controlled by headless: true/false."}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-dart",children:"final options = BrowserLaunchOptions(\n  channel: 'chrome',  // or 'chromium', 'chromium-tip-of-tree'\n  headless: true,\n);\n"})}),"\n",(0,i.jsx)(r.p,{children:"Notes:"}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsx)(r.li,{children:"Cache location: ~/.server_testing by default (override with SERVER_TESTING_CACHE_DIR). Drivers cached per platform/version in ~/.server_testing/drivers."}),"\n",(0,i.jsx)(r.li,{children:"Set forceReinstall: true in BrowserConfig to refresh both browser and driver caches for a run."}),"\n",(0,i.jsx)(r.li,{children:"Firefox uses GeckoDriver; dynamic resolution is analogous but may fall back to a generated version if compatibility lookup is unavailable."}),"\n"]})]})}function h(e={}){const{wrapper:r}={...(0,o.R)(),...e.components};return r?(0,i.jsx)(r,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},8453:(e,r,n)=>{n.d(r,{R:()=>t,x:()=>a});var s=n(6540);const i={},o=s.createContext(i);function t(e){const r=s.useContext(o);return s.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function a(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:t(e.components),s.createElement(o.Provider,{value:r},e.children)}}}]);