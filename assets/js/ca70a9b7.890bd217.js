"use strict";(self.webpackChunkrouted=self.webpackChunkrouted||[]).push([[4581],{4350:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>a,contentTitle:()=>i,default:()=>u,frontMatter:()=>c,metadata:()=>o,toc:()=>d});const o=JSON.parse('{"id":"routed/examples/sse-counter","title":"SSE counter stream","description":"Minimal SSE endpoint that pushes an incrementing counter to the browser.","source":"@site/docs/routed/examples/sse-counter.mdx","sourceDirName":"routed/examples","slug":"/routed/examples/sse-counter","permalink":"/docs/routed/examples/sse-counter","draft":false,"unlisted":false,"editUrl":"https://github.com/kingwill101/routed/tree/main/docs/docs/routed/examples/sse-counter.mdx","tags":[],"version":"current","sidebarPosition":8,"frontMatter":{"id":"sse-counter","title":"SSE counter stream","sidebar_position":8,"description":"Minimal SSE endpoint that pushes an incrementing counter to the browser."},"sidebar":"tutorialSidebar","previous":{"title":"Route Event Hooks","permalink":"/docs/routed/examples/route-events"},"next":{"title":"Project CLI Commands","permalink":"/docs/routed/examples/project-commands"}}');var s=t(4848),r=t(8453);const c={id:"sse-counter",title:"SSE counter stream",sidebar_position:8,description:"Minimal SSE endpoint that pushes an incrementing counter to the browser."},i=void 0,a={},d=[];function l(e){const n={code:"code",p:"p",pre:"pre",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-dart",metastring:'title="bin/server.dart"',children:"import 'dart:async';\nimport 'dart:io';\n\nimport 'package:routed/routed.dart';\n\nFuture<void> main() async {\n  final engine = Engine()\n    ..get('/', (ctx) {\n      ctx.response.headers.set(HttpHeaders.contentTypeHeader, 'text/html');\n      return ctx.response\n        ..write('''<!DOCTYPE html>\n<html lang=\"en\">\n  <head>\n    <meta charset=\"utf-8\" />\n    <title>SSE Counter</title>\n    <style>\n      body { font-family: system-ui, sans-serif; margin: 2rem; }\n      .count { font-size: 2rem; font-weight: 600; }\n      .log { margin-top: 1rem; color: #555; }\n    </style>\n  </head>\n  <body>\n    <h1>SSE Counter</h1>\n    <p class=\"count\" id=\"count\">waiting...</p>\n    <div class=\"log\" id=\"log\">connecting\u2026</div>\n    <script>\n      const countEl = document.getElementById('count');\n      const logEl = document.getElementById('log');\n      const source = new EventSource('/events');\n\n      source.addEventListener('open', () => {\n        logEl.textContent = 'Connected to /events';\n        console.log('SSE connected');\n      });\n\n      source.addEventListener('connected', (event) => {\n        logEl.textContent = 'Connection established: ' + event.data;\n      });\n\n      source.onmessage = (event) => {\n        if (!isNaN(event.data)) {\n          countEl.textContent = event.data;\n          logEl.textContent = 'Last update: ' + new Date().toLocaleTimeString();\n        }\n      };\n\n      source.onerror = () => {\n        logEl.textContent = 'Connection lost; attempting to reconnect...';\n      };\n    <\/script>\n  </body>\n</html>\n''');\n    })\n    ..get('/events', (ctx) async {\n      ctx.response.headers\n        ..set('Access-Control-Allow-Origin', '*')\n        ..set('Access-Control-Allow-Headers', 'Cache-Control');\n\n      Stream<SseEvent> eventStream() async* {\n        yield SseEvent(\n          id: 'init',\n          event: 'connected',\n          data: 'Connection established',\n          retry: const Duration(seconds: 3),\n        );\n\n        var counter = 0;\n        while (true) {\n          await Future.delayed(const Duration(seconds: 1));\n          yield SseEvent(\n            id: '$counter',\n            data: '$counter',\n            retry: const Duration(seconds: 3),\n          );\n          counter++;\n        }\n      }\n\n      await ctx.sse(\n        eventStream(),\n        heartbeat: const Duration(seconds: 15),\n        heartbeatComment: 'still-alive',\n      );\n    });\n\n  await engine.serve(host: '127.0.0.1', port: 8080);\n}\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Launch the example (",(0,s.jsx)(n.code,{children:"dart run bin/server.dart"}),") and visit\n",(0,s.jsx)(n.code,{children:"http://127.0.0.1:8080/"})," to watch the counter advance. You can also stream the\nraw events with:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"curl -v -N http://127.0.0.1:8080/events\n"})}),"\n",(0,s.jsxs)(n.p,{children:["The stream begins with a ",(0,s.jsx)(n.code,{children:":ok"})," priming comment, followed by the ",(0,s.jsx)(n.code,{children:"connected"}),"\ncontrol event and then the incrementing counter. On shutdown the route emits\n",(0,s.jsx)(n.code,{children:"event: control"})," / ",(0,s.jsx)(n.code,{children:"data: close"})," before closing so clients can react quickly.\nOnce that frame is sent the request completes, so graceful shutdown drains\nwithout waiting for the process to exit forcefully."]})]})}function u(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(l,{...e})}):l(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>c,x:()=>i});var o=t(6540);const s={},r=o.createContext(s);function c(e){const n=o.useContext(r);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:c(e.components),o.createElement(r.Provider,{value:n},e.children)}}}]);