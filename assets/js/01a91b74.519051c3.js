"use strict";(globalThis.webpackChunkrouted=globalThis.webpackChunkrouted||[]).push([[5632],{4815:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>o,default:()=>u,frontMatter:()=>i,metadata:()=>a,toc:()=>d});const a=JSON.parse('{"id":"fundamentals/context-data","title":"Context Data","description":"Store per-request values, retrieve configuration, and work with request IDs","source":"@site/docs/routed/fundamentals/context-data.mdx","sourceDirName":"fundamentals","slug":"/fundamentals/context-data","permalink":"/docs/routed/fundamentals/context-data","draft":false,"unlisted":false,"editUrl":"https://github.com/kingwill101/routed/tree/main/docs/docs/routed/fundamentals/context-data.mdx","tags":[],"version":"current","sidebarPosition":5,"frontMatter":{"title":"Context Data","description":"Store per-request values, retrieve configuration, and work with request IDs","sidebar_position":5},"sidebar":"routedSidebar","previous":{"title":"Responses","permalink":"/docs/routed/fundamentals/responses"},"next":{"title":"HTTP Semantics","permalink":"/docs/routed/fundamentals/http-semantics"}}');var r=n(4848),s=n(8453);const i={title:"Context Data",description:"Store per-request values, retrieve configuration, and work with request IDs",sidebar_position:5},o="Context Data",c={},d=[{value:"Basic Usage",id:"basic-usage",level:2},{value:"Request-Scoped Logging",id:"request-scoped-logging",level:2},{value:"Type Safety",id:"type-safety",level:2},{value:"Request Attributes",id:"request-attributes",level:2},{value:"Engine &amp; configuration access",id:"engine--configuration-access",level:2},{value:"Middleware Example",id:"middleware-example",level:2},{value:"Data Cleanup",id:"data-cleanup",level:2}];function l(e){const t={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.header,{children:(0,r.jsx)(t.h1,{id:"context-data",children:"Context Data"})}),"\n",(0,r.jsx)(t.p,{children:"Use the request context to stash small, per-request values and retrieve them later in the same pipeline. Data is cleared automatically at the end of the request."}),"\n",(0,r.jsx)(t.h2,{id:"basic-usage",children:"Basic Usage"}),"\n",(0,r.jsx)(t.p,{children:"Store small values in the per-request context and read them later in the same pipeline (handlers or middleware)."}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-dart",children:"router.get('/example', (ctx) {\n  // Store data (prefer namespaced keys to avoid collisions)\n  ctx.set('user.id', 123);\n  ctx.set('preferences', {'theme': 'dark'});\n\n  // Retrieve data\n  final userId = ctx.get<int>('user.id');\n  final prefs = ctx.get<Map>('preferences');\n\n  // Provide a default when a value may be absent\n  final locale = ctx.get<String>('i18n.locale') ?? 'en';\n});\n"})}),"\n",(0,r.jsx)(t.h2,{id:"request-scoped-logging",children:"Request-Scoped Logging"}),"\n",(0,r.jsx)(t.p,{children:"Each request includes a structured logger; enrich it with context data as you handle work:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-dart",children:"router.post('/jobs', (ctx) async {\n  ctx.logger.info('job received', {\n    'job_type': ctx.request.input('type'),\n  });\n\n  await LoggingContext.withValues({'job_id': 'abc123'}, (logger) async {\n    logger.debug('queued job');\n  });\n});\n"})}),"\n",(0,r.jsxs)(t.p,{children:["The logger automatically includes request metadata (request ID, method, path). See ",(0,r.jsx)(t.a,{href:"/docs/routed/fundamentals/logging",children:"Structured logging"})," for more ways to customise the output."]}),"\n",(0,r.jsx)(t.h2,{id:"type-safety",children:"Type Safety"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-dart",children:"// Get with type checking\nfinal count = ctx.get<int>('count');\nfinal name = ctx.get<String>('name');\nfinal settings = ctx.get<Map<String, dynamic>>('settings');\n\n// Get with required value\nfinal userId = ctx.mustGet<int>('user_id'); // Throws if not found\n"})}),"\n",(0,r.jsx)(t.h2,{id:"request-attributes",children:"Request Attributes"}),"\n",(0,r.jsx)(t.p,{children:"Use request-scoped attributes when you want a dedicated store separate from the generic context key/value map."}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-dart",children:"// Store request-scoped data\nctx.setContextData('transaction_id', 'txn_123');\nctx.setContextData('processed_at', DateTime.now());\n\n// Retrieve request-scoped data\nfinal txnId = ctx.getContextData<String>('transaction_id');\nfinal timestamp = ctx.getContextData<DateTime>('processed_at');\n"})}),"\n",(0,r.jsx)(t.h2,{id:"engine--configuration-access",children:"Engine & configuration access"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-dart",children:"router.get('/info', (ctx) {\n  final appName = ctx.appConfig.get('app.name');\n  final engine = ctx.engine; // Engine? (nullable in some tests)\n  final requestId = ctx.request.id;\n\n  return ctx.json({\n    'app': appName,\n    'request_id': requestId,\n    'active_requests': engine?.activeRequestCount,\n  });\n});\n"})}),"\n",(0,r.jsx)(t.h2,{id:"middleware-example",children:"Middleware Example"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-dart",children:"// Authentication middleware\nFuture<Response> authMiddleware(EngineContext ctx, Next next) async {\n  final token = ctx.requestHeader('Authorization');\n  if (token != null) {\n    final user = await validateToken(token);\n    ctx.set('current_user', user);\n  }\n  return await next();\n}\n\n// Route handler\nrouter.get('/profile', (ctx) {\n  final user = ctx.get<User>('current_user');\n  if (user == null) {\n    return ctx.json({'error': 'Not authenticated'}, statusCode: 401);\n  }\n  return ctx.json({'profile': user.toJson()});\n});\n"})}),"\n",(0,r.jsx)(t.h2,{id:"data-cleanup",children:"Data Cleanup"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-dart",children:"// Clear all context data\nctx.clear();\n\n// Clear specific attributes (set to null to remove)\nctx.set('temp_data', null);\n"})})]})}function u(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(l,{...e})}):l(e)}},8453:(e,t,n)=>{n.d(t,{R:()=>i,x:()=>o});var a=n(6540);const r={},s=a.createContext(r);function i(e){const t=a.useContext(s);return a.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),a.createElement(s.Provider,{value:t},e.children)}}}]);