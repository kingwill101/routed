"use strict";(self.webpackChunkrouted=self.webpackChunkrouted||[]).push([[6194],{6091:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>d,default:()=>h,frontMatter:()=>s,metadata:()=>o,toc:()=>a});const o=JSON.parse('{"id":"routed/examples/config-demo","title":"Config & CLI Demo","description":"Demonstrates Routed\'s configuration loader, provider defaults, and CLI workflow.","source":"@site/docs/routed/examples/config-demo.mdx","sourceDirName":"routed/examples","slug":"/routed/examples/config-demo","permalink":"/docs/routed/examples/config-demo","draft":false,"unlisted":false,"editUrl":"https://github.com/kingwill101/routed/tree/main/docs/docs/routed/examples/config-demo.mdx","tags":[],"version":"current","sidebarPosition":6,"frontMatter":{"title":"Config & CLI Demo","description":"Demonstrates Routed\'s configuration loader, provider defaults, and CLI workflow.","sidebar_position":6},"sidebar":"tutorialSidebar","previous":{"title":"Route Grouping Demo","permalink":"/docs/routed/examples/route-grouping"},"next":{"title":"Route Event Hooks","permalink":"/docs/routed/examples/route-events"}}');var r=i(4848),t=i(8453);const s={title:"Config & CLI Demo",description:"Demonstrates Routed's configuration loader, provider defaults, and CLI workflow.",sidebar_position:6},d="Config & CLI Demo",c={},a=[{value:"What it covers",id:"what-it-covers",level:2},{value:"Running the example",id:"running-the-example",level:2},{value:"CLI workflow",id:"cli-workflow",level:2},{value:"http.yaml highlights",id:"httpyaml-highlights",level:3},{value:"Changing environments",id:"changing-environments",level:2}];function l(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"config--cli-demo",children:"Config & CLI Demo"})}),"\n",(0,r.jsxs)(n.p,{children:["A miniature application that lives under ",(0,r.jsx)(n.code,{children:"examples/config_demo/"})," showcases how\nconfiguration flows through Routed and how the CLI can manage config stubs and\ncache files."]}),"\n",(0,r.jsx)(n.h2,{id:"what-it-covers",children:"What it covers"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"ConfigLoaderOptions"})," with ",(0,r.jsx)(n.code,{children:".env"})," + ",(0,r.jsx)(n.code,{children:"config/"})," files and watch mode."]}),"\n",(0,r.jsxs)(n.li,{children:["Provider manifests via ",(0,r.jsx)(n.code,{children:"config/http.yaml"})," with a custom ",(0,r.jsx)(n.code,{children:"config_demo.mail"})," entry."]}),"\n",(0,r.jsxs)(n.li,{children:["Service providers that advertise defaults via ",(0,r.jsx)(n.code,{children:"ProvidesDefaultConfig"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["Request-scoped overrides using ",(0,r.jsx)(n.code,{children:"Config.runWith"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["The ",(0,r.jsx)(n.code,{children:"routed_cli"})," commands (",(0,r.jsx)(n.code,{children:"config:init"}),", ",(0,r.jsx)(n.code,{children:"config:publish"}),", ",(0,r.jsx)(n.code,{children:"config:cache"}),", ",(0,r.jsx)(n.code,{children:"config:clear"}),", ",(0,r.jsx)(n.code,{children:"provider:list"}),", ",(0,r.jsx)(n.code,{children:"provider:enable"}),", ",(0,r.jsx)(n.code,{children:"provider:disable"}),")."]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"running-the-example",children:"Running the example"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sh",children:"cd examples/config_demo\ndart pub get\n\ndart run bin/server.dart\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Visit ",(0,r.jsx)(n.code,{children:"http://127.0.0.1:8080/"})," to see the merged configuration. The response\nincludes app metadata, mail settings provided by ",(0,r.jsx)(n.code,{children:"MailProvider"}),", and feature\nflags read from ",(0,r.jsx)(n.code,{children:".env"}),"."]}),"\n",(0,r.jsxs)(n.p,{children:["The demo registers its custom provider with the global ",(0,r.jsx)(n.code,{children:"ProviderRegistry"}),"\nso the manifest entry ",(0,r.jsx)(n.code,{children:"config_demo.mail"})," can be resolved during bootstrap:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-dart",metastring:'title="bin/server.dart"',children:"ProviderRegistry.instance.register(\n  'config_demo.mail',\n  factory: () => MailProvider(),\n  description: 'Mail service provider for the config demo',\n);\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"MailProvider"})," opts into the same validation system as the built-in modules: if ",(0,r.jsx)(n.code,{children:"mail.port"})," isn\u2019t an integer or falls outside the valid TCP range, the provider throws a ",(0,r.jsx)(n.code,{children:"ProviderConfigException"})," during boot and the CLI surfaces the error when you run ",(0,r.jsx)(n.code,{children:"provider:list --config"}),"."]}),"\n",(0,r.jsxs)(n.p,{children:["Modify ",(0,r.jsx)(n.code,{children:".env"})," or files under ",(0,r.jsx)(n.code,{children:"config/"})," while the server is running; the engine\nwas constructed with ",(0,r.jsx)(n.code,{children:"ConfigLoaderOptions(watch: true)"}),", so changes queue a\n",(0,r.jsx)(n.code,{children:"ConfigReloadedEvent"})," and the next request sees the update."]}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"/override"})," route demonstrates ",(0,r.jsx)(n.code,{children:"Config.runWith"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-dart",metastring:'title="bin/server.dart"',children:"engine.get('/override', (ctx) async {\n  final snapshot = Map<String, dynamic>.from(Config.current.all());\n  snapshot['app'] = {\n    ...?snapshot['app'] as Map<String, dynamic>?,\n    'name': 'Scoped Override',\n  };\n\n  await Config.runWith(ConfigImpl(snapshot), () async {\n    ctx.response.write('Scoped app.name -> ${Config.current.get('app.name')}');\n  });\n\n  return ctx.response;\n});\n"})}),"\n",(0,r.jsx)(n.h2,{id:"cli-workflow",children:"CLI workflow"}),"\n",(0,r.jsx)(n.p,{children:"From the example directory:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-sh",children:"# Scaffold config/ and .env (already checked in for this sample)\ndart run routed_cli config:init\n\n# Publish stubs from dependencies (no-op unless a package ships config/stubs/)\ndart run routed_cli config:publish routed\n\n# Generate Dart + JSON caches for production builds\ndart run routed_cli config:cache\n\n# Also write configuration metadata (JSON) for tooling\ndart run routed_cli config:cache --docs --docs-output build/config_docs.json\n\n# Remove generated cache artifacts\ndart run routed_cli config:clear\n\n# Inspect or modify the provider manifest in config/http.yaml\ndart run routed_cli provider:list\ndart run routed_cli provider:list --config\ndart run routed_cli provider:disable config_demo.mail\ndart run routed_cli provider:enable config_demo.mail\n\nSample output from `provider:list --config`:\n\n```text\nProvider Manifest\nrouted.core               enabled: yes \u2014 Core services: config loader, engine bindings.\n    config source: CoreServiceProvider\n    defaults:\n      http:\n        providers:\n          - routed.core\n          - routed.routing\n      logging:\n        enabled: true\nrouted.static             enabled: yes \u2014 Static asset serving configuration defaults.\n    config source: StaticAssetsServiceProvider\n    defaults:\n      static:\n        enabled: false\n        mounts: []\n"})}),"\n",(0,r.jsxs)(n.p,{children:["If a manifest entry supplies an invalid value (for example a non-string ",(0,r.jsx)(n.code,{children:"uploads.allowed_extensions"})," entry or a malformed ",(0,r.jsx)(n.code,{children:"security.trusted_proxies"})," list) the CLI surfaces the same ",(0,r.jsx)(n.code,{children:"ProviderConfigException"})," you would see at runtime, including the precise configuration path. That makes it easy to fix bad overrides without booting the engine."]}),"\n",(0,r.jsxs)(n.p,{children:["Every config file generated by the CLI now starts with a ",(0,r.jsx)(n.strong,{children:"quick reference"})," comment block. The comments summarize the relevant provider docs (descriptions, types, and supported options) so teams can spot the important knobs directly inside ",(0,r.jsx)(n.code,{children:"config/*.yaml"}),". When you need to integrate with IDEs or external tooling, rerun ",(0,r.jsx)(n.code,{children:"config:cache --docs"})," to produce a JSON snapshot of the same metadata. It is perfect for surfacing hints in editor extensions or dashboards."]}),"\n",(0,r.jsx)(n.h3,{id:"httpyaml-highlights",children:"http.yaml highlights"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"config/http.yaml"})," complements provider defaults with app-specific toggles:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"logging:\n  extra_fields:\n    service: config_demo\n    deployment: demo\n  request_headers:\n    - X-Request-ID\nstatic:\n  enabled: true\n  mounts:\n    - route: /assets\n      disk: assets\n      path: ''\nstorage:\n  default: assets\n  disks:\n    assets:\n      driver: local\n      root: public/assets\nuploads:\n  allowed_extensions: [jpg, png, pdf]\nsecurity:\n  headers:\n    Referrer-Policy: strict-origin-when-cross-origin\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Visit ",(0,r.jsx)(n.code,{children:"/"})," to see the merged configuration; logging extras, static mounts, upload limits, and security headers now appear in the JSON payload alongside the mail provider settings."]}),"\n",(0,r.jsxs)(n.p,{children:["The cache command writes the merged configuration to\n",(0,r.jsx)(n.code,{children:"lib/generated/routed_config.dart"})," and a JSON snapshot under\n",(0,r.jsx)(n.code,{children:".dart_tool/routed/config_cache.json"}),", allowing production builds to boot\nwithout touching the filesystem at runtime."]}),"\n",(0,r.jsx)(n.h2,{id:"changing-environments",children:"Changing environments"}),"\n",(0,r.jsxs)(n.p,{children:["Set ",(0,r.jsx)(n.code,{children:"APP_ENV"})," in ",(0,r.jsx)(n.code,{children:".env"})," (e.g., ",(0,r.jsx)(n.code,{children:"testing"}),") to load ",(0,r.jsx)(n.code,{children:"config/{env}/*.yaml"}),".\nRestart the server (or touch the file if watch mode is on) and the mail port\nswitches to the environment-specific value."]}),"\n",(0,r.jsxs)(n.p,{children:["For a deeper breakdown of the configuration system, read the\n",(0,r.jsx)(n.a,{href:"/docs/routed/fundamentals/configuration",children:"Configuration fundamentals"})," guide."]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(l,{...e})}):l(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>s,x:()=>d});var o=i(6540);const r={},t=o.createContext(r);function s(e){const n=o.useContext(t);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:s(e.components),o.createElement(t.Provider,{value:n},e.children)}}}]);