---
title: Context Data
description: Store per-request values, retrieve configuration, and work with request IDs
sidebar_position: 5
---

# Context Data

Use the request context to stash small, per-request values and retrieve them later in the same pipeline. Data is cleared automatically at the end of the request.

## Basic Usage
Store small values in the per-request context and read them later in the same pipeline (handlers or middleware).

```dart
router.get('/example', (ctx) {
  // Store data (prefer namespaced keys to avoid collisions)
  ctx.set('user.id', 123);
  ctx.set('preferences', {'theme': 'dark'});

  // Retrieve data
  final userId = ctx.get<int>('user.id');
  final prefs = ctx.get<Map>('preferences');

  // Provide a default when a value may be absent
  final locale = ctx.get<String>('i18n.locale') ?? 'en';
});
```

## Request-Scoped Logging

Each request includes a structured logger; enrich it with context data as you handle work:

```dart
router.post('/jobs', (ctx) async {
  ctx.logger.info('job received', {
    'job_type': ctx.request.input('type'),
  });

  await LoggingContext.withValues({'job_id': 'abc123'}, (logger) async {
    logger.debug('queued job');
  });
});
```

The logger automatically includes request metadata (request ID, method, path). See [Structured logging](/docs/routed/fundamentals/logging) for more ways to customise the output.

## Type Safety

```dart
// Get with type checking
final count = ctx.get<int>('count');
final name = ctx.get<String>('name');
final settings = ctx.get<Map<String, dynamic>>('settings');

// Get with required value
final userId = ctx.mustGet<int>('user_id'); // Throws if not found
```

## Request Attributes
Use request-scoped attributes when you want a dedicated store separate from the generic context key/value map.

```dart
// Store request-scoped data
ctx.setContextData('transaction_id', 'txn_123');
ctx.setContextData('processed_at', DateTime.now());

// Retrieve request-scoped data
final txnId = ctx.getContextData<String>('transaction_id');
final timestamp = ctx.getContextData<DateTime>('processed_at');
```

## Engine & configuration access

```dart
router.get('/info', (ctx) {
  final appName = ctx.appConfig.get('app.name');
  final engine = ctx.engine; // Engine? (nullable in some tests)
  final requestId = ctx.request.id;

  return ctx.json({
    'app': appName,
    'request_id': requestId,
    'active_requests': engine?.activeRequestCount,
  });
});
```

## Middleware Example

```dart
// Authentication middleware
Future<Response> authMiddleware(EngineContext ctx, Next next) async {
  final token = ctx.requestHeader('Authorization');
  if (token != null) {
    final user = await validateToken(token);
    ctx.set('current_user', user);
  }
  return await next();
}

// Route handler
router.get('/profile', (ctx) {
  final user = ctx.get<User>('current_user');
  if (user == null) {
    return ctx.json({'error': 'Not authenticated'}, statusCode: 401);
  }
  return ctx.json({'profile': user.toJson()});
});
```

## Data Cleanup

```dart
// Clear all context data
ctx.clear();

// Clear specific attributes (set to null to remove)
ctx.set('temp_data', null);
```
