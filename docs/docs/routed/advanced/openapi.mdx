---
title: OpenAPI Specification
sidebar_position: 9
---

# OpenAPI Specification

Routed can generate [OpenAPI 3.1](https://spec.openapis.org/oas/v3.1.0) documents from your route graph. You describe endpoints with either a **fluent builder API** or **annotation classes**, then use the CLI to produce a JSON specification file.

## Quick Start

```bash
# Runtime introspection (boots your app, reads real routes)
dart run routed openapi generate

# Static analysis (no app boot, analyzes source files)
dart run routed openapi make
```

Both commands write to `.dart_tool/routed/openapi.json` by default.

## Route Builder API

The primary way to attach OpenAPI metadata is the `.openApi()` method on `RouteBuilder`. It receives a callback with an `OpenApiOperationBuilder`:

```dart
engine.get('/users/{id:int}', (ctx) async {
  final id = ctx.request.pathParameters['id'];
  return ctx.json({'id': id, 'name': 'Alice'});
}).openApi((op) {
  op.summary = 'Fetch a user by ID';
  op.description = 'Returns the user object for the given numeric ID.';
  op.operationId = 'getUserById';
  op.tags(['users', 'v1']);

  op.parameter(
    name: 'id',
    location: 'path',
    required: true,
    schema: {'type': 'integer'},
    description: 'Numeric user ID',
  );

  op.jsonResponse(
    status: '200',
    description: 'User found',
    schema: {
      'type': 'object',
      'properties': {
        'id': {'type': 'integer'},
        'name': {'type': 'string'},
      },
    },
  );

  op.jsonResponse(
    status: '404',
    description: 'User not found',
  );
});
```

### Builder Methods

| Method | Description |
|--------|-------------|
| `op.summary = '...'` | Short summary for the operation |
| `op.description = '...'` | Longer description |
| `op.operationId = '...'` | Explicit operation ID (auto-generated if omitted) |
| `op.tag(value)` | Add a single tag |
| `op.tags(values)` | Add multiple tags |
| `op.parameter(...)` | Add a parameter (`location`: `path`, `query`, `header`, `cookie`) |
| `op.requestBody(...)` | Define request body with raw `content` map |
| `op.jsonRequestBody(schema:)` | Shorthand for JSON request body |
| `op.response(...)` | Define a response with raw `content` map |
| `op.jsonResponse(status:, schema:)` | Shorthand for JSON response |

### Request Body Example

```dart
engine.post('/users', (ctx) async {
  // ...
}).openApi((op) {
  op.summary = 'Create a new user';
  op.tags(['users']);

  op.jsonRequestBody(
    schema: {
      'type': 'object',
      'required': ['name', 'email'],
      'properties': {
        'name': {'type': 'string'},
        'email': {'type': 'string', 'format': 'email'},
      },
    },
    description: 'User to create',
    required: true,
  );

  op.jsonResponse(status: '201', description: 'User created');
  op.jsonResponse(status: '422', description: 'Validation failed');
});
```

### Multiple Calls Merge

Calling `.openApi()` more than once on the same route **merges** the metadata — later calls overwrite conflicting keys:

```dart
engine.get('/items', handler)
  .openApi((op) {
    op.summary = 'List items';
    op.tags(['items']);
  })
  .openApi((op) {
    op.jsonResponse(status: '200', description: 'Item list');
  });
```

## Annotations

Routed also provides annotation classes that can decorate handler functions. These are available from `package:routed/routed.dart`:

```dart
@Summary('Get all products')
@Description('Returns a paginated list of products.')
@ApiTags(['products', 'catalog'])
@ApiResponse(200, description: 'Success', schema: {
  'type': 'array',
  'items': {'\$ref': '#/components/schemas/Product'},
})
@ApiResponse(404, description: 'Not found')
Future<void> getProducts(EngineContext ctx) async {
  // ...
}
```

### Available Annotations

| Annotation | Purpose |
|------------|---------|
| `@Summary(value)` | Short summary |
| `@Description(value)` | Longer description |
| `@ApiTags([...])` | Tags for grouping |
| `@ApiDeprecated([reason])` | Mark as deprecated |
| `@OperationId(value)` | Explicit operation ID |
| `@ApiResponse(status, ...)` | Response definition (`description`, `schema`, `example`, `contentType`) |
| `@RequestBody(...)` | Request body (`description`, `required`, `schema`, `example`, `contentType`) |
| `@RequestExample(value, ...)` | Example request body |
| `@ApiParameter(name:, ...)` | Parameter definition (`location`, `required`, `schema`, `example`) |
| `@ApiHidden()` | Exclude from documentation |

:::info Annotations vs Builder API
The **builder API** (`.openApi()`) attaches metadata directly to route constraints at runtime and is the primary mechanism used by both CLI commands.

**Annotations** are read by the `openapi make` command's static analyzer (`AnalyzerIntrospector`), which parses your source files without booting the application. If you use `openapi generate` (runtime introspection), annotations are not automatically picked up — use the builder API instead, or use `openapi make` for annotation-based projects.
:::

## CLI Commands

### `openapi generate`

Boots your application, extracts the route manifest at runtime, then enriches it with schema information from static analysis.

```bash
dart run routed openapi generate [options]
```

| Option | Default | Description |
|--------|---------|-------------|
| `--entry` | (auto-detect) | Dart entrypoint that prints a route manifest as JSON |
| `--output` | `.dart_tool/routed/openapi.json` | Output file path |
| `--title` | `Routed Service` | `info.title` value |
| `--version` | `1.0.0` | `info.version` value |
| `--description` | (none) | `info.description` value |
| `--server` | (none) | Server URL(s), repeatable. Format: `url` or `url\|Description` |
| `--[no-]pretty` | `true` | Pretty-print JSON output |

**Example:**

```bash
dart run routed openapi generate \
  --title "My API" \
  --version "2.0.0" \
  --description "REST API for the widget service" \
  --server "https://api.example.com|Production" \
  --server "http://localhost:8080|Development" \
  --output docs/openapi.json
```

### `openapi make`

Uses the Dart analyzer to statically introspect your source code — **no application boot required**. Reads route registrations, annotations, and doc comments directly from AST.

```bash
dart run routed openapi make [options]
```

| Option | Default | Description |
|--------|---------|-------------|
| `--entry` | `tool/spec_manifest.dart` | Entrypoint file for analysis (falls back to `lib/app.dart`) |
| `--output` | `.dart_tool/routed/openapi.json` | Output file path |
| `--[no-]pretty` | `true` | Pretty-print JSON output |

## Generator API

For programmatic use, `generateOpenApiDocument` is exported from `package:routed/routed.dart`:

```dart
import 'package:routed/routed.dart';

final engine = await Engine.create(providers: [...]);

// Register routes with OpenAPI metadata
engine.get('/health', (ctx) => ctx.json({'status': 'ok'})).openApi((op) {
  op.summary = 'Health check';
  op.jsonResponse(status: '200', description: 'Service is healthy');
});

// Build the manifest and generate the document
final manifest = engine.buildRouteManifest();
final document = generateOpenApiDocument(
  manifest,
  info: const OpenApiDocumentInfo(
    title: 'My Service',
    version: '1.0.0',
    description: 'An example API',
  ),
  servers: [
    const OpenApiServer(
      url: 'https://api.example.com',
      description: 'Production',
    ),
  ],
  components: {
    'schemas': {
      'User': {
        'type': 'object',
        'properties': {
          'id': {'type': 'integer'},
          'name': {'type': 'string'},
        },
      },
    },
  },
);

// `document` is a Map<String, Object?> — encode to JSON as needed
```

### Automatic Behaviors

The generator applies several defaults when metadata is incomplete:

- **Tags** — Derived from the first non-parameter path segment (e.g., `/users/{id}` → `['users']`). Falls back to `['default']` for root paths.
- **Summary** — Uses the route name if available, otherwise `"METHOD /path"` (e.g., `"GET /users/{id}"`).
- **Operation ID** — Generated from method and path: `get_users_id_int`. Suffixed with `_2`, `_3`, etc. if duplicates arise.
- **Path parameters** — Automatically extracted from `{param}` segments in the route path. Typed parameters like `{id:int}` produce the correct schema (`integer`, `number`, `boolean`, `string`, `uuid`, `date`, `date-time`).
- **Responses** — A default `200: Successful response.` is added if no responses are declared.

## Groups and Nested Routes

OpenAPI metadata works seamlessly with route groups. The full path is resolved before generation:

```dart
engine.group(path: '/api/v1', builder: (api) {
  api.group(path: '/users', builder: (users) {
    users
      .get('/{id:int}', showUser)
      .openApi((op) {
        op.summary = 'Get user';
        op.tags(['users', 'v1']);
        op.jsonResponse(
          status: '200',
          description: 'User object',
          schema: {'\$ref': '#/components/schemas/User'},
        );
      });

    users
      .post('/', createUser)
      .openApi((op) {
        op.summary = 'Create user';
        op.tags(['users', 'v1']);
        op.jsonRequestBody(schema: {
          '\$ref': '#/components/schemas/CreateUserRequest',
        });
        op.jsonResponse(status: '201', description: 'Created');
      });
  });
});
```

The generated document will contain paths `/api/v1/users/{id:int}` and `/api/v1/users/` with the correct metadata.

## Tips

- **Use the builder API** for routes registered at runtime — it's the most reliable path for both CLI commands.
- **Use annotations** when you prefer a declarative style and are using `openapi make` for static analysis.
- **Serve your spec** — pipe the generated JSON into tools like [Swagger UI](https://swagger.io/tools/swagger-ui/), [Redoc](https://redocly.com/redoc), or [Stoplight Elements](https://stoplight.io/open-source/elements) for interactive API documentation.
- **Components** — Pass reusable schemas via the `components` parameter of `generateOpenApiDocument()` and reference them with `$ref` in your route metadata.
- **Wildcard and optional parameters** — `{path:*}` (wildcard) and `{section?}` (optional) are correctly parsed. Optional parameters set `required: false` in the spec.
